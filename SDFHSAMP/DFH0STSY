      CBL CICS('COBOL3,SP') APOST
PROCESS MAP,XREF,TRUNC(BIN)
      *****************************************************************
      *                                                               *
      * MODULE NAME = DFH0STSY                                        *
      *                                                               *
      * DESCRIPTIVE NAME = Collect and Print Statistics Sample        *
      *                                                               *
      *                                                               *
      *                                                               *
      *     Licensed Materials - Property of IBM                      *
      *                                                               *
      *     "Restricted Materials of IBM"                             *
      *                                                               *
      *     5655-Y04                                                  *
      *                                                               *
      *     (C) Copyright IBM Corp. 1999, 2016"                       *
      *                                                               *
      *                                                               *
      *                                                               *
      *                                                               *
      * STATUS = 7.2.0                                                *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      * DESCRIPTION :                                                 *
      *                                                               *
      *     This set of programs illustrate ways of using the EXEC    *
      *     CICS INQUIRE, COLLECT and EXTRACT STATISTICS commands of  *
      *     CICS to produce information about a CICS system.          *
      *     The reports include a CICS and MVS storage analysis.      *
      *     Statistics obtained using these commands can be used to   *
      *     aid the specification of the DSA Size parameters.         *
      *     (See the CICS Performance Guide and CICS Data Areas       *
      *     manuals for more information, and the CICS System         *
      *     Programming Reference for use of commands)                *
      *                                                               *
      *     These programs can be invoked from the PLT at PLTSD or    *
      *     as a CICS transaction (conversationally).                 *
      *     The output is sent via the CICS JES SPOOL interface for   *
      *     which a number of default parameters can be changed by    *
      *     the user to specify the distribution of the report(s).    *
      *     These defaults are defined in the working-storage         *
      *     section of the DFH0STAT program under the 01 level        *
      *     "OUTPUT-DEFAULTS".                                        *
      *                                                               *
      *     Installation instructions:-                               *
      *     Require SIT parameters:-  SPOOL=YES                       *
      *     Required CICS definitions:-                               *
      *         Transactions:-  STAT -> DFH0STAT                      *
      *         Programs:-    DFH0STAT   IBM COBOL                    *
      *                       DFH0STDB       for OS/390 & VM          *
      *                       DFH0STEJ           2.1.1 or later       *
      *                       DFH0STEP       "   "   "                *
      *                       DFH0STGN       "   "   "                *
      *                       DFH0STLK       "   "   "                *
      *                       DFH0STPR       "   "   "                *
      *                       DFH0STSA       "   "   "                *
      *                       DFH0STSY       "   "   "                *
      *                       DFH0STTP       "   "   "                *
      *                       DFH0STTS       "   "   "                *
      *                       DFH0STWB       "   "   "                *
      *                       DFH$STAS   Assembler                    *
      *                       DFH$STCN   Assembler                    *
      *                       DFH$STTB   Assembler                    *
      *         Mapsets:-     DFH0STM                                 *
      *                       DFH0STS                                 *
      *                                                               *
      *     The CICS-supplied RDO group, DFH$STAT, contains all       *
      *     the necessary resource definitions for this sample.       *
      *                                                               *
      *     All programs are command level and run above the          *
      *     16Mb line. Note: that DFH0STAT, DFH0STDB, DFH0STEJ,       *
      *     DFH0STEP, DFH0STGN, DFH0STLK, DFH0STPR, DFH0STSA,         *
      *     DFH0STSY, DFH0STTP, DFH0STTS, and DFH0STWB must be        *
      *     translated with the Translator options "COBOL3 and SP".   *
      *                                                               *
      *   SPOOL errors.  If an EXEC CICS SPOOL .. command fails       *
      *   when the program is run as a transaction, an error message  *
      *   is displayed on the user's screen and the transaction will  *
      *   continue.  If the program is not being run from a terminal  *
      *   then a message will be sent to the console using EXEC       *
      *   CICS WRITE OPERATOR commands and the transaction will be    *
      *   terminated normally.                                        *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      * CHANGE ACTIVITY :                                             *
      * $SEG(DFH0STSY), COMP(SAMPLES) PROD(CICS)                      *
      *                                                               *
      *  PN= REASON REL YYMMDD HDXIII : REMARKS                       *
      * $D1= I07099 620 001013 HD1VCJB : Statistics Enhancements      *
      * $D4= I07345 630 030414 HD1VCJB : Additional Stats for SM MMSC *
      * $D5= I07345 630 030424 HD1VCJB : Additional Stats for DS MMSC *
      * $D7= I07552 640 050426 HD0JADT: More MVS WLM statistics       *
      * $D8= I07552 650 050506 HD1VCJB : Enhance MVSTCB Statistics    *
      * $D9= I07553 650 050506 HD1VCJB: Enhance Monitoring Global Stat*
      * $DA= I07610 650 050506 HD1VCJB: Clock/Timestamp Formatting    *
      * $DB= I07698 650 050713 HD1VCJB: Monitoring Record Compression *
      * $DD= I07910 660 080616 HD1VCJB: Monitor DPL Program Requests  *
      * $L0= 776    610 991110 HD1VCJB : Module creation              *
      * $L1= 795    610 991203 HD1VCJB : EJB Related Resources support*
      * $L2= 794    610 000502 HD1VCJB : Excess TCB Management Statis *
      * $L3= 773    620 000627 HD1VCJB : Statistics Support for ECI   *
      * $L4= 832    620 001212 HD1VCJB : Inquire/Set Dispatcher       *
      * $L5= 832    620 001218 HD1VCJB : Dispatcher Statistics Update *
      * $L7= 831    640 040213 HD1VCJB : New SSL TCBs Dispatcher Stats*
      * $L8= 857    640 040305 HD1VCJB: XPLink Dispatcher Statistics  *
      * $L9= 857    640 040402 HD1VCJB: XPLink MAXXPTCBS support      *
      * $LA= 880    650 051230 HD4PALS: INQUIRE IRC SPI for XCFGROUP  *
      * $LB= 891    650 060519 HD1VCJB: 64 Bit Domain Subpool Stats   *
      * $LC= 891    650 060522 HD1VCJB: 4 - 64-Bit Storage Manager Sta*
      * $LD= 710    650 060711 HD1VCJB: IPCONN Statistics             *
      * $LE= 897    650 061010 HD1VCJB: LIBRARY Stats Infrastructure  *
      * $LF= 891    650 061018 HD1VCJB: 64-Bit Storage Manager Stats  *
      * $LG= 897    650 070125 HD1VCJB: Dynamic Library Support       *
      * $LH= 937    660 080417 HD1VCJB: New TCB for JVM Threading     *
      * $LI= 923    660 080515 HD1VCJB: Atomservice Statistics Support*
      * $LJ= 927    660 080530 HD1VCJB: New TCB for Event Processing  *
      * $LK= 927    660 080604 HD1VCJB: Event Processing Support      *
      * $LL= 903    660 081117 HD1VCJB: Monitoring Identity Class     *
      *      R38042 690 130319 HDAFDRB: Use EXTRACT STATISTICS        *
      *      R38042 690 130404 HDAFDRB: Use EXTRACT STATISTICS        *
      *      R38042 690 130422 HDIDNCS: Use EXTRACT STATISTICS        *
      * $P1= M15351 610 000411 HD1VCJB : ACT/MAX Sockets moved to TCP *
      * $P2= M15441 610 000505 HD1VCJB : Statistics Consistency for T *
      * $P3= D02818 620 010919 HD1VCJB : Stats for TCB Attach Failure *
      * $P4= D02993 620 011008 HD1VCJB : Add the DB2 D2 TCB Mode      *
      * $P5= D03309 620 011026 HD1VCJB : Correct DS TCB Mismatch Stat *
      * $P6= D02825 620 011101 HD1VCJB : Correct Last-reset-time      *
      * $P7= D07646 630 030620 HDFXAB : Add DSST reset for MMSC sta   *
      * $P8= D07560 630 030626 HDHYJB  : correct field name           *
      * $P9= D16062 650 060714 HD1VCJB: Stats on MN Record Compression*
      * $PA= D18332 650 070323 HD1VCJB: increase size of searchpos    *
      * $PB= D18919 650 070501 HD1VCJB: Correct DFHRPL Usage in LD Rpt*
      * $PC= D19532 660 070927 HD1VCJB: Increase Concatenation Field  *
      * $PD= D25138 660 090310 HD1VCJB: New TCB Mode Page Overflow    *
      * $PE= D26833 670 090911 HD1VCJB: Correct Trace Table Size field*
      * $01= A63143 630 020923 HD1VCJB : Migrate PQ63143 from SPA R6  *
      * $02= A76701 630 030812 HD4PALS : Migrate PQ76701 from SPA     *
      * $03= A76702 630 030813 HD4PALS : Migrate PQ76702 from SPA     *
      * $04= A76703 630 030815 HD4PALS : Migrate PQ76703 from SPA     *
      * $05= A83258 640 040213 HD4PALS : Migrate PQ83258 from SPA     *
      * $06= A03360 650 050920 HD4PALS: Migrate PK03360 from SPA R640 *
      * $07= A26811 670 101214 HDBGSLS: Migrate PM26811 from SPA R660 *
      *      R33222 680 110990 HDIDNS: WLM Region Goal Mgmt in stats  *
      *      R37164 680 111117 HDIDNCS: "Both" region goal support    *
      *      R36728 680 111221 HDIADD : Add CEC Machine Type and Model*
      *      R38170 680 120201 HD1VCJB : Remove JVM TCB Pool Stats    *
      *      D53516 680 120615 HD1VCJB: SUBTSKS changes               *
      *      R74946 690 131011 HD1VCJB: Monitoring Performance Metrics*
      *      R74946 690 131028 HDFVGMB: Enhanced MXT statistics       *
      *      R74946 690 131111 HDFXAB : New dispatacher stats metrics *
      *      D98593 700 150106 HD3BADW: Fix comments                  *
      *     R116308 710 160411 HDGVJDT: Use LASTRESETABS              *
      *     D145415 720 171206 HDLHJJH: Fix elapsed time & tran rate  *
      *     R146209 720 180201 HDLHJJH: Urimap/webservice mon limits  *
      *     PH01158 680 180820 HD9RAJP: Handle VTAM=NO without INVREQ *
      *     D150786 720 181023 HDFVGMB: Add TRUNC(BIN) to PROCESS     *
      *                                                               *
      *****************************************************************
       ID DIVISION.
       PROGRAM-ID. DFH0STSY.

       ENVIRONMENT DIVISION.
           EJECT
       DATA DIVISION.
       WORKING-STORAGE SECTION.
       77  STAS-COMMAREA               PIC S9(4)  COMP.
       77  STCN-COMMAREA               PIC S9(4)  COMP.
       77  COLLECT-RESP                PIC S9(8)  COMP VALUE +0.
       77  INQUIRE-RESP                PIC S9(8)  COMP VALUE +0.

       77  MNGDS-DATA-PTR              USAGE IS POINTER.

       77  SUB1                        PIC S9(4)  COMP VALUE +0.
       77  SUB2                        PIC S9(4)  COMP VALUE +0.
       77  TCB-MODES-IN-THIS-POOL      PIC S9(4)  COMP VALUE +0.

       77  TCB-PTR                     USAGE IS POINTER.

       77  FIRST-MULTI-TCB-MODE        PIC S9(4)  COMP VALUE +11.

       77  PERCENTAGE-WORK             PIC 99V9999     VALUE 0.
       77  PERCENTAGE                  PIC 999V99      VALUE 0.
       77  RESULT                      PIC S9(8)  COMP VALUE +0.

       77  TOTAL-ACCUM-TRANSACTIONS    PIC S9(18) COMP VALUE +0.

       77  ALL-TASKS                   PIC S9(8)  COMP VALUE +0.
       77  RUNNING-TASKS               PIC S9(8)  COMP VALUE +0.
       77  DISPATCHABLE-TASKS          PIC S9(8)  COMP VALUE +0.
       77  SUSPENDED-TASKS             PIC S9(8)  COMP VALUE +0.
       77  SYSTEM-TASKS                PIC S9(8)  COMP VALUE +0.
       77  TRANSACTION-RATE            PIC 9(4)V99     VALUE 0.
       77  CURRENT-SECONDS             PIC S9(8)  COMP VALUE +0.
       77  UTIME                       PIC S9(15) COMP-3 VALUE +0.

       77  FORCE-QR-STATUS             PIC S9(8)  COMP VALUE +0.
       77  RTM-STORAGE-BELOW           PIC 9(8)   COMP VALUE 256000.
       77  SYSTEM-STORAGE-BELOW        PIC 9(8)   COMP VALUE 20480.
       77  TRACE-TABLE-SIZE            PIC S9(8)  COMP VALUE 0.
       77  AUX-STATUS                  PIC S9(8)  COMP VALUE 0.
       77  GTF-STATUS                  PIC S9(8)  COMP VALUE 0.
       77  INT-STATUS                  PIC S9(8)  COMP VALUE 0.
       77  SWITCH-STATUS               PIC S9(8)  COMP VALUE 0.
       77  CURRENT-AUX-DATASET         PIC X           VALUE SPACE.

       77  CICS-TS-LEVEL               PIC X(6)        VALUE SPACES.
       77  CICS-STARTUP                PIC S9(8)  COMP VALUE +0.
       77  COLD-STATUS                 PIC S9(8)  COMP VALUE +0.
       77  CICS-STATUS                 PIC S9(8)  COMP VALUE +0.
       77  INIT-STATUS                 PIC S9(8)  COMP VALUE +0.
       77  KEYPOINT-FREQUENCY          PIC S9(8)  COMP VALUE +0.
       77  LOGDEFER-INTERVAL           PIC S9(8)  COMP VALUE +0.
       77  STORAGE-PROTECTION          PIC S9(8)  COMP VALUE +0.
       77  COMMAND-PROTECTION          PIC S9(8)  COMP VALUE +0.
       77  TRANSACTION-ISOLATION       PIC S9(8)  COMP VALUE +0.
       77  PROGRAM-AUTOINSTALL         PIC S9(8)  COMP VALUE +0.
       77  PROGAUTO-CATLG              PIC S9(8)  COMP VALUE +0.
       77  RLS-STATUS                  PIC S9(8)  COMP VALUE +0.
       77  IRC-OPEN-STATUS             PIC S9(8)  COMP VALUE +0.
       77  RRMS-OPEN-STATUS            PIC S9(8)  COMP VALUE +0.
       77  TCPIP-OPEN-STATUS           PIC S9(8)  COMP VALUE +0.
       77  VTAM-OPEN-STATUS            PIC S9(8)  COMP VALUE +0.
       77  GENERIC-RESOURCE-NAME       PIC X(8)        VALUE SPACES.
       77  GENERIC-RESOURCE-STATUS     PIC S9(8)  COMP VALUE +0.
       77  IRC-XCFGROUP-NAME           PIC X(8)        VALUE SPACES.

       77  NUM-STG-ELEMENTS            PIC S9(8)  COMP VALUE +0.
           EJECT
       77  EXCEPTION-CLASS             PIC S9(8)  COMP VALUE +0.
       77  PERFORMANCE-CLASS           PIC S9(8)  COMP VALUE +0.
       77  RESOURCE-CLASS              PIC S9(8)  COMP VALUE +0.
       77  IDENTITY-CLASS              PIC S9(8)  COMP VALUE +0.
       77  MONITOR-STATUS              PIC S9(8)  COMP VALUE +0.
       77  CONVERSE-STATUS             PIC S9(8)  COMP VALUE +0.
       77  SYNCPOINT-STATUS            PIC S9(8)  COMP VALUE +0.
       77  MNTIME-SETTING              PIC S9(8)  COMP VALUE +0.

       77  APPLNAME-STATUS             PIC S9(8)  COMP VALUE +0.
       77  RMI-STATUS                  PIC S9(8)  COMP VALUE +0.
       77  COMPRESS-STATUS             PIC S9(8)  COMP VALUE +0.
       77  DPL-RESOURCE-LIMIT          PIC S9(4)  COMP VALUE +0.
       77  FILE-RESOURCE-LIMIT         PIC S9(4)  COMP VALUE +0.
       77  TSQUEUE-RESOURCE-LIMIT      PIC S9(4)  COMP VALUE +0.
       77  URIMAP-RESOURCE-LIMIT       PIC S9(4)  COMP VALUE +0.
       77  WEBSVC-RESOURCE-LIMIT       PIC S9(4)  COMP VALUE +0.

       77  EOD-COLLECTION-TIME         PIC S9(7)  COMP-3 VALUE +0.
       77  COLLECTION-INTERVAL         PIC S9(7)  COMP-3 VALUE +0.
       77  NEXT-COLLECTION-TIME        PIC S9(7)  COMP-3 VALUE +0.
       77  RECORDING-STATUS            PIC S9(8)  COMP VALUE +0.

       77  AUTOINSTALL-PROGRAM         PIC X(8)        VALUE SPACES.
       77  AUTOINSTALL-STATUS          PIC S9(8)  COMP VALUE +0.
       77  AUTOINSTALL-CONSOLES        PIC S9(8)  COMP VALUE +0.

       77  DB2-CONNECTION-NAME         PIC X(8)        VALUE SPACES.
       77  DB2-CONNECT-STATUS          PIC S9(8)  COMP VALUE +0.

       77  GARBAGE-COLLECTION-INT      PIC S9(8)  COMP VALUE +0.
       77  TERMINAL-INPUT-TIMEOUT-INT  PIC S9(8)  COMP VALUE +0.

       77  ACTIVE-SOCKETS              PIC S9(8)  COMP VALUE +0.
       77  MAX-SOCKETS                 PIC S9(8)  COMP VALUE +0.

       77  SUBPOOL-NAME                PIC X(8)        VALUE SPACES.

       77  CICSTCB-CPUTIME             PIC X(8)    VALUE LOW-VALUES.
       77  NONCICSTCB-CPUTIME          PIC X(8)    VALUE LOW-VALUES.

       77  TASK-ATTACHTIME             PIC S9(15) COMP-3 VALUE +0.
       77  TASK-RUNSTATUS              PIC S9(8)  COMP VALUE +0.
       77  TASK-SUSPENDTIME            PIC S9(8)  COMP VALUE +0.
       77  TASK-SUSPENDTYPE            PIC X(8)        VALUE SPACES.
       77  TASK-SUSPENDVALUE           PIC X(8)        VALUE SPACES.
       77  TASK-TASKDATAKEY            PIC S9(8)  COMP VALUE +0.
       77  TASK-TASKDATALOC            PIC S9(8)  COMP VALUE +0.
       77  TASK-TRANID                 PIC X(4)        VALUE SPACES.

       77  LAST-RESET-ABS              PIC S9(15) COMP-3 VALUE +0.
       77  ELAPSED-ABS                 PIC S9(15) COMP-3 VALUE +0.
      *****************************************************************
      ***  Total fields                                             ***
      *****************************************************************
       77  CURRENT-TCBS-ATTACHED       PIC S9(9)  COMP-3 VALUE +0.
       77  CURRENT-TCBS-IN-USE         PIC S9(9)  COMP-3 VALUE +0.
       77  TCBS-ATTACHED               PIC S9(9)  COMP-3 VALUE +0.
       77  TCB-ATTACH-FAILURES         PIC S9(9)  COMP-3 VALUE +0.
       77  TCBS-DETACHED-UNCLEAN       PIC S9(9)  COMP-3 VALUE +0.
       77  TCBS-DETACHED-STOLEN        PIC S9(9)  COMP-3 VALUE +0.
       77  TCBS-DETACHED-EXCESS        PIC S9(9)  COMP-3 VALUE +0.
       77  TCBS-DETACHED-OTHER         PIC S9(9)  COMP-3 VALUE +0.
       77  TCB-STEALS                  PIC S9(9)  COMP-3 VALUE +0.
       77  TCB-MISMATCHES              PIC S9(9)  COMP-3 VALUE +0.
       77  TCB-ALLOCATES               PIC S9(9)  COMP-3 VALUE +0.

       77  TCB-TOTAL                   PIC S9(9)  COMP-3 VALUE +0.
           EJECT
       01  DISPATCHER-TIME-TOTAL-FIELDS.
           03  DSGACT-TOTAL            PIC X(8).
           03  DSGACT-TOTAL-NUM REDEFINES DSGACT-TOTAL PIC 9(18) COMP.
           03  DSGTCT-TOTAL            PIC X(8).
           03  DSGTCT-TOTAL-NUM REDEFINES DSGTCT-TOTAL PIC 9(18) COMP.

      *****************************************************************
      *** Fields used by the CONVERT-HEX-TO-CHAR routine.           ***
      *****************************************************************
       01  CONVERT-HEX-TO-CHAR-FIELDS.
           03  HEX-CHAR-TABLE      PIC X(15)   VALUE '123456789ABCDEF'.
           03  FILLER REDEFINES HEX-CHAR-TABLE.
               05  HEX-CHAR        PIC X       OCCURS 15.
           03  HEX-INPUT.
               05  HEX-INPUT-PTR   USAGE IS POINTER.
           03  FILLER REDEFINES HEX-INPUT.
               05  HEX-INPUT-CHAR  PIC X       OCCURS 4.
           03  HEX-OUTPUT.
               05  HEX-OUTPUT-CHAR PIC X       OCCURS 8.
           03  BINARY-FIELD        PIC 9(4)    COMP    VALUE 0.
           03  FILLER REDEFINES BINARY-FIELD.
               05  FILLER          PIC X.
               05  BINARY-CHAR     PIC X.
           03  LEFT-OUTPUT         PIC 9(4)    COMP.
           03  RIGHT-OUTPUT        PIC 9(4)    COMP.

       01  NULL-FIELD-CONSTANTS.
           03  NULL-DATE-FIELD     PIC X(10)   VALUE '--/--/----'.
           03  NULL-TIME-FIELD     PIC X(15)   VALUE '--:--:--.------'.
           EJECT
      *****************************************************************
      *** Fields for data obtained from called program DFH$STAS     ***
      *** This structure must match the DSECT ASCB_FIELDS in the    ***
      *** called program DFH$STAS                                   ***
      *****************************************************************
       01  STATASCB-FIELDS.
           03  ASCB-STORAGE-FIELDS.
               05  MVS-PROD-NAME           PIC X(8)    VALUE SPACES.
               05  ADSP-TCTLWM             PIC 9(8)  COMP   VALUE 0.
               05  ADSP-TCTHWM             PIC 9(8)  COMP   VALUE 0.
               05  ADSP-TCTELWM            PIC 9(8)  COMP   VALUE 0.
               05  ADSP-TCTEHWM            PIC 9(8)  COMP   VALUE 0.
               05  REGION-SIZE-BELOW       PIC 9(8)  COMP   VALUE 0.
               05  REGION-SIZE-ABOVE       PIC 9(8)  COMP   VALUE 0.
               05  REGION-SIZE-ESTABLISHED PIC 9(8)  COMP   VALUE 0.
               05  FILLER                  PIC XX      VALUE SPACES.
               05  CPU-MODEL               PIC XX    VALUE LOW-VALUES.
               05  ADSP-CPU-TIME           PIC X(8)  VALUE LOW-VALUES.
               05  ADSP-SRB-TIME           PIC X(8)  VALUE LOW-VALUES.
               05  CURRENT-TOD-STCK        PIC X(8)  VALUE LOW-VALUES.
               05  FILLER                  PIC X(8)  VALUE LOW-VALUES.
               05  FILLER                  PIC X(8)  VALUE LOW-VALUES.
               05  EPVT-SIZE               PIC 9(8)  COMP   VALUE 0.
               05  ECSA-SIZE               PIC 9(8)  COMP   VALUE 0.
               05  ESQA-SIZE               PIC 9(8)  COMP   VALUE 0.
               05  SQA-SIZE                PIC 9(8)  COMP   VALUE 0.
               05  CSA-SIZE                PIC 9(8)  COMP   VALUE 0.
               05  PVT-SIZE                PIC 9(8)  COMP   VALUE 0.
               05  ECSA-ALLOCATED          PIC 9(8)  COMP   VALUE 0.
               05  ESQA-ALLOCATED          PIC 9(8)  COMP   VALUE 0.
               05  SQA-ALLOCATED           PIC 9(8)  COMP   VALUE 0.
               05  CSA-ALLOCATED           PIC 9(8)  COMP   VALUE 0.
               05  ECSA-CONVERTED-TO-ESQA  PIC 9(8)  COMP   VALUE 0.
               05  CSA-CONVERTED-TO-SQA    PIC 9(8)  COMP   VALUE 0.
               05  AVERAGE                 PIC 9(7)V99.
           EJECT
      *****************************************************************
      ***  Report print line definitions                            ***
      *****************************************************************
       01  PRINT-LINE.
           03  PRINT-CONTROL           PIC X.
           03  PP1-132.
               05  FILLER              PIC XX.
               05  PP3-33              PIC X(31).
               05  FILLER              PIC XX.
               05  PP36-49.
                   07  PP36-37         PIC Z9.
                   07  FILLER          PIC X(12).
               05  PP50                PIC X.
               05  FILLER              PIC X(16).
               05  PP67-76.
                   07  PP67-71         PIC X(5).
                   07  FILLER          PIC X(5).
               05  FILLER              PIC X(43).
               05  PP120-132           PIC Z,ZZZ,ZZZ,ZZ9.
           03 FILLER REDEFINES PP1-132.
               05  FILLER              PIC XX.
               05  PP3-58.
                   07  PP3-55          PIC X(53).
                   07  FILLER          PIC XXX.
               05  FILLER              PIC X(10).
               05  PP69-116            PIC X(48).
               05  FILLER              PIC X(16).
           03 FILLER REDEFINES PP1-132.
               05  PP1-20.
                   07  PP1-19          PIC X(19).
                   07  FILLER          PIC X.
               05  FILLER REDEFINES PP1-20.
                   07  PP1-13.
                       09  PP1-12.
                           11  PP1-10  PIC X(10).
                           11  FILLER  PIC XX.
                       09  FILLER      PIC X.
                   07  FILLER          PIC X(7).
               05  FILLER              PIC X(112).
           03 FILLER REDEFINES PP1-132.
               05  FILLER              PIC XX.
               05  PP3-10              PIC X(8).
               05  FILLER              PIC XX.
               05  PP13-20             PIC X(8).
               05  FILLER              PIC X(30).
               05  PP51-56             PIC ZZ9.99.
               05  FILLER              PIC X(51).
               05  PP108-124           PIC X(17).
               05  FILLER              PIC X(8).
           03 FILLER REDEFINES PP1-132.
               05  FILLER              PIC X(22).
               05  PP23-34.
                   07  PP23-33.
                       09  PP23-32     PIC X(10).
                       09  FILLER      PIC X.
                   07  FILLER          PIC X.
               05  FILLER              PIC X.
               05  PP36-46             PIC X(11).
               05  FILLER              PIC X(51).
               05  PP98-109.
                   07  PP98-108.
                       09  PP98-107    PIC X(10).
                       09  FILLER      PIC X.
                   07  FILLER          PIC X.
               05  FILLER              PIC X(23).
           03 FILLER REDEFINES PP1-132.
               05  PP1-21              PIC X(21).
               05  FILLER              PIC X(14).
               05  PP36-44N            PIC Z,ZZZ,ZZ9.
               05  PP45                PIC X.
               05  FILLER              PIC X(4).
               05  PP50-62             PIC Z,ZZZ,ZZZ,ZZ9.
               05  FILLER              PIC X(8).
               05  PP71-105            PIC X(35).
               05  FILLER              PIC XX.
               05  PP108-118.
                   07  PP108-115.
                       09  PP108-114   PIC X(7).
                       09  FILLER      PIC X.
                   07  FILLER          PIC XXX.
               05  FILLER              PIC X(14).
           03 FILLER REDEFINES PP1-132.
               05  FILLER              PIC XX.
               05  PP3-40              PIC X(38).
               05  FILLER              PIC XX.
               05  PP43-52             PIC ZZ,ZZZ,ZZ9.
               05  FILLER              PIC X(16).
               05  PP69-105            PIC X(37).
               05  FILLER              PIC XX.
               05  PP108-117X.
                   07  PP108-117       PIC ZZ,ZZZ,ZZ9.
               05  FILLER              PIC XX.
               05  PP120-132X          PIC X(13).
           03 FILLER REDEFINES PP1-132.
               05  FILLER              PIC XX.
               05  FILLER              PIC X(20).
               05  PP23-25             PIC XXX.
               05  FILLER              PIC XXX.
               05  PP29-42             PIC X(14).
               05  FILLER              PIC XX.
               05  PP45-49             PIC ZZ9.9.
               05  FILLER              PIC X.
               05  FILLER              PIC XX.
               05  FILLER              PIC ZZ,ZZZ,ZZ9.
               05  PP63                PIC X.
               05  FILLER              PIC XX.
               05  PP66-75             PIC ZZ,ZZZ,ZZ9.
               05  PP76                PIC X.
               05  FILLER              PIC X(31).
               05  PP108-110           PIC XXX.
               05  FILLER              PIC X(22).
           03 FILLER REDEFINES PP1-132.
               05  FILLER              PIC X(35).
               05  PP36-47.
                   07  PP36-40         PIC X(5).
                   07  FILLER          PIC X(7).
               05  FILLER              PIC X(60).
               05  PP108-115B          PIC 99B99B99.
               05  FILLER              PIC X(17).
           03 FILLER REDEFINES PP1-132.
               05  FILLER              PIC X(35).
               05  PP36-44.
                   07  PP36-43.
                       09  PP36-38.
                           11  PP36    PIC X.
                           11  FILLER  PIC XX.
                       09  FILLER      PIC X(5).
                   07  FILLER          PIC X.
               05  FILLER              PIC XX.
               05  PP47-60.
                   07  FILLER          PIC X.
                   07  PP48-60         PIC Z,ZZZ,ZZZ,ZZ9.
               05  FILLER              PIC X(47).
               05  PP108-113           PIC ZZ,ZZ9.
               05  FILLER              PIC X(19).
           03 FILLER REDEFINES PP1-132.
               05  FILLER              PIC X(26).
               05  PP27-29             PIC XXX.
               05  FILLER              PIC X(6).
               05  PP36-45             PIC ZZ,ZZZ,ZZ9.
               05  FILLER              PIC X.
               05  PP47-56             PIC ZZ,ZZZ,ZZ9.
               05  FILLER              PIC X(76).
           03 FILLER REDEFINES PP1-132.
               05  FILLER              PIC XX.
               05  PP3-44.
                   07  PP3-38.
                       09  PP3-24      PIC X(22).
                       09  FILLER      PIC X(14).
                   07  FILLER          PIC X(6).
               05  FILLER              PIC X(4).
               05  PP49-65.
                   07  FILLER          PIC XX.
                   07  PP51-65.
                       09  FILLER      PIC X(6).
                       09  PP57        PIC X.
                       09  FILLER      PIC X.
                       09  PP59-62     PIC X(4).
                       09  FILLER      PIC XXX.
               05  FILLER              PIC XX.
               05  PP68-78.
                   07  PP68-77         PIC X(10).
                   07  FILLER          PIC X.
               05  FILLER              PIC X(33).
               05  PP112-117           PIC ZZ9.99.
               05  PP118               PIC X.
               05  FILLER              PIC X(14).
           03 FILLER REDEFINES PP1-132.
               05  FILLER              PIC XX.
               05  PP3-46              PIC X(44).
               05  FILLER              PIC XX.
               05  PP49-62             PIC X(14).
               05  PP63-64             PIC XX.
               05  FILLER              PIC X(43).
               05  PP108-120.
                   07  PP108-111       PIC X(4).
                   07  FILLER          PIC X(9).
               05  FILLER              PIC X(12).
           03 FILLER REDEFINES PP1-132.
               05  FILLER              PIC X(52).
               05  PP53-62             PIC ZZ,ZZZ,ZZ9.
               05  FILLER              PIC X(70).
           03 FILLER REDEFINES PP1-132.
               05  FILLER              PIC XX.
               05  PP3-8               PIC X(6).
               05  FILLER              PIC X.
               05  PP10-16             PIC ZZZ,ZZ9.
               05  FILLER              PIC XX.
               05  PP19-25             PIC ZZZ,ZZ9.
               05  FILLER              PIC XX.
               05  PP28-37             PIC ZZ,ZZZ,ZZ9.
               05  FILLER              PIC X.
               05  FILLER              PIC ZZ,ZZZ,ZZ9.
               05  FILLER              PIC XX.
               05  PP51-60             PIC ZZ,ZZZ,ZZ9.
               05  FILLER              PIC XX.
               05  FILLER              PIC X(16).
               05  PP79-88             PIC ZZ,ZZZ,ZZ9.
               05  PP89                PIC X.
               05  FILLER              PIC XX.
               05  PP92-101            PIC ZZ,ZZZ,ZZ9.
               05  PP102               PIC X.
               05  FILLER              PIC XX.
               05  PP105-114           PIC ZZ,ZZZ,ZZ9.
               05  FILLER              PIC X(8).
               05  PP123-132N          PIC ZZ,ZZZ,ZZ9.
           03  FILLER REDEFINES PP1-132.
               05  FILLER              PIC X(4).
               05  PP5-6               PIC XX.
               05  FILLER              PIC X(4).
               05  PP11-13             PIC XXX.
               05  FILLER              PIC XX.
               05  PP16-19             PIC X(4).
               05  FILLER              PIC XX.
               05  PP22-28             PIC ZZZ,ZZ9.
               05  FILLER              PIC XX.
               05  PP31-37             PIC ZZZ,ZZ9.
               05  FILLER              PIC XX.
               05  PP40-46             PIC ZZZ,ZZ9.
               05  FILLER              PIC XX.
               05  PP49-55             PIC ZZZ,ZZ9.
               05  FILLER              PIC XX.
               05  PP58-67N            PIC ZZ,ZZZ,ZZ9.
               05  FILLER              PIC XX.
               05  PP70-79             PIC ZZ,ZZZ,ZZ9.
               05  FILLER              PIC XX.
               05  PP82-91             PIC ZZ,ZZZ,ZZ9.
               05  FILLER              PIC XX.
               05  PP94-103            PIC ZZ,ZZZ,ZZ9.
               05  FILLER              PIC XX.
               05  PP106-115           PIC ZZ,ZZZ,ZZ9.
               05  FILLER              PIC XX.
               05  PP118-127           PIC ZZ,ZZZ,ZZ9.
               05  FILLER              PIC X(5).
           03  FILLER REDEFINES PP1-132.
               05  FILLER              PIC X(27).
               05  PP28-34             PIC ZZZ,ZZ9.
               05  FILLER              PIC XX.
               05  PP37-43             PIC ZZZ,ZZ9.
               05  FILLER              PIC X(14).
               05  PP58-71.
                   07  FILLER          PIC X(4).
                   07  PP62-71         PIC ZZ,ZZZ,ZZ9.
               05  PP72                PIC X.
               05  FILLER              PIC X(60).
           03  FILLER REDEFINES PP1-132.
               05  FILLER              PIC X(21).
               05  PP22-31             PIC ZZ,ZZZ,ZZ9.
               05  FILLER              PIC XX.
               05  PP34-43             PIC ZZ,ZZZ,ZZ9.
               05  FILLER              PIC XX.
               05  PP46-55             PIC ZZ,ZZZ,ZZ9.
               05  FILLER              PIC X(63).
               05  PP119-132           PIC X(14).
           03  FILLER REDEFINES PP1-132.
               05  FILLER              PIC X(40).
               05  FILLER              PIC XXX.
               05  FILLER              PIC X(9).
               05  PP53-55             PIC XXX.
               05  FILLER              PIC X(9).
               05  PP65-67             PIC XXX.
               05  FILLER              PIC X(9).
               05  PP77-79             PIC XXX.
               05  FILLER              PIC X(9).
               05  PP89-91             PIC XXX.
               05  FILLER              PIC X(9).
               05  PP101-103           PIC XXX.
               05  FILLER              PIC X(9).
               05  PP113-115           PIC XXX.
               05  FILLER              PIC X(9).
               05  PP125-127           PIC XXX.
               05  FILLER              PIC X(5).
           03 FILLER REDEFINES PP1-132.
               05  FILLER              PIC X(40).
               05  PP41-57.
                   07  PP41-50         PIC ZZ,ZZZ,ZZ9.
                   07  FILLER          PIC X(7).
               05  FILLER              PIC XX.
               05  PP60-76             PIC X(17).
               05  FILLER              PIC XX.
               05  PP79-95             PIC X(17).
               05  FILLER              PIC XX.
               05  PP98-114            PIC X(17).
               05  FILLER              PIC X(5).
               05  PP120-124           PIC ZZ9.9.
               05  PP125               PIC X.
               05  FILLER              PIC X(7).
           03 FILLER REDEFINES PP1-132.
               05  FILLER              PIC X(28).
               05  PP29-36             PIC X(8).
               05  FILLER              PIC XX.
               05  PP39-46             PIC X(8).
               05  FILLER              PIC XX.
               05  PP49-56             PIC X(8).
               05  FILLER              PIC X(54).
               05  PP111-114           PIC X(4).
               05  FILLER              PIC XX.
               05  PP117-120           PIC X(4).
               05  FILLER              PIC X(3).
               05  PP124-126           PIC X(3).
               05  FILLER              PIC X(6).
           03 FILLER REDEFINES PP1-132.
               05  FILLER              PIC XX.
               05  PP3-132.
                   07  PP3-102.
                       09  PP3-72.
                           11  PP3-37  PIC X(35).
                           11  PP38-72 PIC X(35).
                       09  PP73-102    PIC X(30).
                   07  PP103-132       PIC X(30).
           03 FILLER REDEFINES PP1-132.
               05  FILLER              PIC X(106).
               05  PP107-113           PIC ZZZ9.99.
               05  FILLER              PIC X(19).
           03 FILLER REDEFINES PP1-132.
               05  FILLER              PIC X(47).
               05  PP48-64             PIC X(16).
               05  FILLER              PIC X(30).
               05  PP94-103X           PIC ZZ,ZZZ9.99.
               05  FILLER              PIC X(29).
           EJECT
       LINKAGE SECTION.
           EJECT
      *****************************************************************
      ***  Statistics Sample Programs Commarea.                     ***
      *****************************************************************
       01  DFHCOMMAREA.
           COPY DFH0STCM.
           EJECT
      *****************************************************************
      *** Data structures for DB2 Connection Global statistics      ***
      *** (See the CICS Data Areas manual)                          ***
      *****************************************************************
           COPY DFHD2GDS.
           EJECT
      *****************************************************************
      *** Data structures for Dispatcher Global statistics          ***
      *** (See the CICS Data Areas manual)                          ***
      *****************************************************************
           COPY DFHDSGDS.
           EJECT
      *****************************************************************
      *** Data structures for Dispatcher MVS TCB Resource statistics***
      *** (See the CICS Data Areas manual)                          ***
      *****************************************************************
           COPY DFHDSRDS.
           EJECT
      *****************************************************************
      *** Data structures for Dispatcher MVS TCB Global statistics  ***
      *** (See the CICS Data Areas manual)                          ***
      *****************************************************************
           COPY DFHDSTDS.
           EJECT
      *****************************************************************
      *** Data structures for Monitoring Global statistics          ***
      *** (See the CICS Data Areas manual)                          ***
      *****************************************************************
           COPY DFHMNGDS.

       01  MNGDS-DATA.
           03  MNG-DATA                    PIC X(268).
           EJECT
      *****************************************************************
      *** Data structures for System Dump Global statistics         ***
      *** (See the CICS Data Areas manual)                          ***
      *****************************************************************
           COPY DFHSDGDS.
           EJECT
      *****************************************************************
      *** Data structures for Storage Manager DSA                   ***
      *** (See the CICS Data Areas manual)                          ***
      *****************************************************************
           COPY DFHSMSDS.
           EJECT
      *****************************************************************
      *** Data structures for Statistics Global statistics          ***
      *** (See the CICS Data Areas manual)                          ***
      *****************************************************************
           COPY DFHSTGDS.
           EJECT
      *****************************************************************
      *** Data structures for Transaction Dump Global statistics    ***
      *** (See the CICS Data Areas manual)                          ***
      *****************************************************************
           COPY DFHTDGDS.
           EJECT
      *****************************************************************
      *** Data structures for Transaction Manager Global statistics ***
      *** (See the CICS Data Areas manual)                          ***
      *****************************************************************
           COPY DFHXMGDS.
           EJECT
      *****************************************************************
      ***                                                           ***
      ***           CICS Collect and print statistics               ***
      ***                                                           ***
      *****************************************************************
       PROCEDURE DIVISION.

      *****************************************************************
      *** MAIN-PROCESSING                                           ***
      ***     Initialise the totals fields                          ***
      ***     Get CICS system and MVS information                   ***
      ***     Print the following statistics reports:-              ***
      ***       - System Status                                     ***
      ***       - Transaction Manager                               ***
      ***       - Dispatcher                                        ***
      ***       - Dispatcher MVS TCBs                               ***
      ***     Return to DFH0STLK                                    ***
      *****************************************************************

       MAIN-PROCESSING SECTION.

           PERFORM TOTALS-INITIALISE.

           PERFORM COLLECT-SYSTEM.

           PERFORM PRINT-STATISTICS.

           EXEC CICS RETURN
           END-EXEC.

       MAIN-PROCESSING-EXIT.
           GOBACK.
           EJECT
      *****************************************************************
      *** COLLECT-SYSTEM                                            ***
      ***   Get required system information.                        ***
      ***   Format the version and release number.                  ***
      ***   Get monitoring, statistics and trace information.       ***
      *****************************************************************

       COLLECT-SYSTEM SECTION.

           EXEC CICS INQUIRE SYSTEM
               AKP(KEYPOINT-FREQUENCY) CICSSTATUS(CICS-STATUS)
               CICSTSLEVEL(CICS-TS-LEVEL)
               COLDSTATUS(COLD-STATUS) INITSTATUS(INIT-STATUS)
               LOGDEFER(LOGDEFER-INTERVAL)
               FORCEQR(FORCE-QR-STATUS)
               CMDPROTECT(COMMAND-PROTECTION)
               DB2CONN(DB2-CONNECTION-NAME)
               PROGAUTOCTLG(PROGAUTO-CATLG)
               PROGAUTOINST(PROGRAM-AUTOINSTALL)
               PROGAUTOEXIT(AUTOINSTALL-PROGRAM)
               RLSSTATUS(RLS-STATUS)
               STARTUP(CICS-STARTUP)
               STOREPROTECT(STORAGE-PROTECTION)
               TRANISOLATE(TRANSACTION-ISOLATION)
           END-EXEC.

           IF DB2-CONNECTION-NAME NOT = SPACES THEN
               EXEC CICS INQUIRE DB2CONN
                   CONNECTST(DB2-CONNECT-STATUS)
               END-EXEC
           END-IF.

           EXEC CICS INQUIRE AUTOINSTALL
               CONSOLES(AUTOINSTALL-CONSOLES)
               ENABLESTATUS(AUTOINSTALL-STATUS)
           END-EXEC.

           EXEC CICS INQUIRE IRC
               OPENSTATUS(IRC-OPEN-STATUS)
               XCFGROUP(IRC-XCFGROUP-NAME)
           END-EXEC.

      *****************************************************************
      *** INQUIRE VTAM.                                    @PH01158A***
      *** NOHANDLE and EIBRESP processing added by APAR    @PH01158A***
      *****************************************************************
           EXEC CICS INQUIRE VTAM
               OPENSTATUS(VTAM-OPEN-STATUS)
               GRNAME(GENERIC-RESOURCE-NAME)
               GRSTATUS(GENERIC-RESOURCE-STATUS)
               NOHANDLE
           END-EXEC.

           IF EIBRESP = DFHRESP(INVREQ) THEN
             MOVE DFHVALUE(NOTAPPLIC) TO VTAM-OPEN-STATUS
           END-IF.

           EXEC CICS INQUIRE RRMS
               OPENSTATUS(RRMS-OPEN-STATUS)
           END-EXEC.

           EXEC CICS INQUIRE TCPIP
               ACTSOCKETS(ACTIVE-SOCKETS)
               MAXSOCKETS(MAX-SOCKETS)
               OPENSTATUS(TCPIP-OPEN-STATUS)
           END-EXEC.

           EXEC CICS INQUIRE WEB
               GARBAGEINT(GARBAGE-COLLECTION-INT)
               TIMEOUTINT(TERMINAL-INPUT-TIMEOUT-INT)
           END-EXEC.
           EJECT
      *****************************************************************
      *** Get the monitoring information.                           ***
      *****************************************************************
           EXEC CICS INQUIRE MONITOR
               APPLNAMEST(APPLNAME-STATUS)
               COMPRESSST(COMPRESS-STATUS)
               CONVERSEST(CONVERSE-STATUS)
               DPLLIMIT(DPL-RESOURCE-LIMIT)
               EXCEPTCLASS(EXCEPTION-CLASS)
               FILELIMIT(FILE-RESOURCE-LIMIT)
               IDNTYCLASS(IDENTITY-CLASS)
               PERFCLASS(PERFORMANCE-CLASS)
               RESRCECLASS(RESOURCE-CLASS)
               RMIST(RMI-STATUS)
               STATUS(MONITOR-STATUS)
               SYNCPOINTST(SYNCPOINT-STATUS)
               TIME(MNTIME-SETTING)
               TSQUEUELIMIT(TSQUEUE-RESOURCE-LIMIT)
               URIMAPLIMIT(URIMAP-RESOURCE-LIMIT)
               WEBSERVLIMIT(WEBSVC-RESOURCE-LIMIT)
           END-EXEC.

      *****************************************************************
      *** Get the statistics information.                           ***
      *****************************************************************
           EXEC CICS INQUIRE STATISTICS
               ENDOFDAY(EOD-COLLECTION-TIME)
               INTERVAL(COLLECTION-INTERVAL)
               NEXTTIME(NEXT-COLLECTION-TIME)
               RECORDING(RECORDING-STATUS)
           END-EXEC.

           EXEC CICS EXTRACT STATISTICS TRANSACTION
               SET(ADDRESS OF DFHXMGDS)
               LASTRESETABS(LAST-RESET-ABS)
           END-EXEC.


      *    Calculate the elapsed time since statistics last reset
           EXEC CICS ASKTIME ABSTIME(UTIME)
           END-EXEC.

           COMPUTE ELAPSED-ABS = UTIME - LAST-RESET-ABS
           END-COMPUTE.

      *    Calculate the elapsed time in seconds
           COMPUTE LAST-RESET-SECONDS = ELAPSED-ABS / 1000
           END-COMPUTE.
           EJECT
      *****************************************************************
      *** Get size of internal trace table                          ***
      *****************************************************************
           EXEC CICS INQUIRE TRACEDEST
               AUXSTATUS(AUX-STATUS)
               CURAUXDS(CURRENT-AUX-DATASET)
               GTFSTATUS(GTF-STATUS)
               INTSTATUS(INT-STATUS)
               SWITCHSTATUS(SWITCH-STATUS)
               TABLESIZE(TRACE-TABLE-SIZE)
           END-EXEC.

      *****************************************************************
      ***   Initialize DFH$STAS-FIELDS                              ***
      ***   Collect MVS storage information                         ***
      *****************************************************************

           MOVE 0 TO ADSP-TCTLWM ADSP-TCTHWM
                     ADSP-TCTELWM ADSP-TCTEHWM
                     REGION-SIZE-BELOW REGION-SIZE-ABOVE
                     REGION-SIZE-ESTABLISHED.

      *****************************************************************
      *** Collect MVS storage information by calling program        ***
      *** DFH$STAS.  The storage information obtained is passed     ***
      *** back in the data structure  STATASCB-FIELDS               ***
      *****************************************************************

           MOVE LENGTH OF STATASCB-FIELDS TO STAS-COMMAREA

           EXEC CICS LINK PROGRAM('DFH$STAS')
               COMMAREA(STATASCB-FIELDS)
               LENGTH(STAS-COMMAREA)
           END-EXEC.

       COLLECT-SYSTEM-EXIT.
           EXIT.
           EJECT
      *****************************************************************
      *****************************************************************
      ***         Collect and Print the CICS Statistics             ***
      *****************************************************************
      *****************************************************************
      ***                                                           ***
      ***  Print the Statistics in the following order:-            ***
      ***    - System Status                                        ***
      ***    - Transaction Manager                                  ***
      ***    - Dispatcher                                           ***
      ***    - Dispatcher MVS TCBs                                  ***
      ***                                                           ***
      *****************************************************************
      *****************************************************************

       PRINT-STATISTICS SECTION.

           PERFORM SYSTEM-STATUS.

           IF SELECT-TRANMGR = 'Y' OR 'y' THEN
               PERFORM TRANSACTION-MGR-STATISTICS
           END-IF.

           IF SELECT-DISPATCHER = 'Y' OR 'y' THEN
               PERFORM DISPATCHER-STATISTICS
           END-IF.

           IF SELECT-MVS-TCBS = 'Y' OR 'y' THEN
               PERFORM MVS-TCB-STATISTICS
           END-IF.

       PRINT-STATISTICS-EXIT.
           EXIT.
           EJECT
      *****************************************************************
      *** SYSTEM-STATUS SECTION                                     ***
      *****************************************************************

       SYSTEM-STATUS SECTION.

      *****************************************************************
      ***   Print heading and system status                         ***
      *****************************************************************
           PERFORM PAGE-HEADINGS.
           MOVE PAGENO TO SYSTEM-STATUS-PAGENO.

           MOVE '-'             TO PRINT-CONTROL.
           MOVE 'System Status' TO PP1-13.
           PERFORM WRITE-OUTPUT.
           MOVE '+'      TO PRINT-CONTROL.
           MOVE ALL '_'  TO PP1-13.
           PERFORM WRITE-OUTPUT.

           MOVE '0' TO PRINT-CONTROL.
           MOVE 'MVS Product Name. . . . . . . :' TO PP3-33.
           STRING 'MVS/' MVS-PROD-NAME
               DELIMITED BY SIZE INTO PP36-47
           END-STRING.
           MOVE 'CICS Transaction Server Level . . :' TO PP71-105.
           MOVE CICS-TS-LEVEL                         TO PP108-115B.
           INSPECT PP108-115B REPLACING ALL ' ' BY '.'.
           PERFORM WRITE-OUTPUT.

      *****************************************************************
      *** Get the Monitoring Global Statistics.                     ***
      *****************************************************************
           EXEC CICS EXTRACT STATISTICS MONITOR
               SET(ADDRESS OF DFHMNGDS)
           END-EXEC.

           EXEC CICS GETMAIN
               LENGTH(MNGLEN) SET(MNGDS-DATA-PTR)
           END-EXEC.
           SET ADDRESS OF MNGDS-DATA TO MNGDS-DATA-PTR.
           MOVE DFHMNGDS(1:MNGLEN)   TO MNG-DATA(1:MNGLEN).

           SET ADDRESS OF DFHMNGDS   TO MNGDS-DATA-PTR.

           MOVE '0' TO PRINT-CONTROL.
           MOVE 'CICS Startup. . . . . . . . . :' TO PP3-33.
           EVALUATE CICS-STARTUP
               WHEN DFHVALUE(COLDSTART)
                   EVALUATE(COLD-STATUS)
                       WHEN DFHVALUE(COLD)
                           MOVE 'COLD     ' TO PP36-44
                       WHEN DFHVALUE(INITIAL)
                           MOVE 'INITIAL  ' TO PP36-44
                       WHEN OTHER
                           CONTINUE
                   END-EVALUATE
               WHEN DFHVALUE(WARMSTART)
                   MOVE 'WARM     ' TO PP36-44
               WHEN DFHVALUE(EMERGENCY)
                   MOVE 'EMERGENCY' TO PP36-44
               WHEN DFHVALUE(STANDBY)
                   MOVE 'STANDBY  ' TO PP36-44
               WHEN DFHVALUE(AUTOSTART)
                   MOVE 'AUTOSTART' TO PP36-44
               WHEN OTHER
                   CONTINUE
           END-EVALUATE.
           MOVE 'MVS Workload Manager (WLM) Mode . :' TO PP71-105.
           IF MNG-GOAL-MODE THEN
               MOVE 'Goal'                            TO PP108-111
           ELSE
               MOVE 'Compatibility'                   TO PP108-120
           END-IF.
           PERFORM WRITE-OUTPUT.

           MOVE 'CICS Status . . . . . . . . . :' TO PP3-33.
           EVALUATE CICS-STATUS
               WHEN DFHVALUE(STARTUP)
                   MOVE 'STARTUP     ' TO PP36-47
               WHEN DFHVALUE(ACTIVE)
                   MOVE 'ACTIVE      ' TO PP36-47
               WHEN DFHVALUE(FIRSTQUIESCE)
                   MOVE 'FIRSTQUIESCE' TO PP36-47
               WHEN DFHVALUE(FINALQUIESCE)
                   MOVE 'FINALQUIESCE' TO PP36-47
               WHEN OTHER
                   CONTINUE
           END-EVALUATE.

           MOVE 'WLM Server. . . . . . . . . . . . :' TO PP71-105.
           IF MNG-WLM-SERVER-YES THEN
               MOVE 'Yes'                             TO PP108-110
           ELSE
               MOVE 'No '                             TO PP108-110
           END-IF.
           PERFORM WRITE-OUTPUT.

           MOVE 'CEC Machine Type and Model. . :' TO PP3-33.
           STRING MNG-CEC-MACHINE-TYPE '-' MNG-CEC-MODEL-NUMBER
               DELIMITED BY SIZE INTO PP36-47
           END-STRING.

           MOVE 'WLM Manage Region Using Goals of. :' TO PP71-105.
           EVALUATE TRUE
               WHEN MNG-WLM-AS-GOAL-MGT-TRAN
                   MOVE 'TRANSACTION' TO PP108-118
               WHEN MNG-WLM-AS-GOAL-MGT-RGN
                   MOVE 'REGION     ' TO PP108-118
               WHEN MNG-WLM-AS-GOAL-MGT-BOTH
                   MOVE 'BOTH       ' TO PP108-118
               WHEN OTHER
                   CONTINUE
           END-EVALUATE.
           PERFORM WRITE-OUTPUT.


           MOVE 'WLM Workload Name . . . . . . . . :' TO PP71-105.
           MOVE MNG-WORKLOAD-NAME                     TO PP108-115.
           PERFORM WRITE-OUTPUT.

           MOVE 'VTAM Open Status. . . . . . . :'     TO PP3-33.
           EVALUATE VTAM-OPEN-STATUS
               WHEN DFHVALUE(OPEN)
                   MOVE 'OPEN       '                 TO PP36-46
               WHEN DFHVALUE(CLOSED)
                   MOVE 'CLOSED     '                 TO PP36-46
               WHEN DFHVALUE(IMMCLOSE)
                   MOVE 'IMMCLOSED  '                 TO PP36-46
               WHEN DFHVALUE(FORCECLOSE)
                   MOVE 'FORCECLOSED'                 TO PP36-46
               WHEN DFHVALUE(NOTAPPLIC)
                   MOVE 'VTAM=NO    '                 TO PP36-46
               WHEN OTHER
                   CONTINUE
           END-EVALUATE.
           MOVE 'WLM Service Class . . . . . . . . :' TO PP71-105.
           MOVE MNG-SERVICE-CLASS                     TO PP108-115.
           PERFORM WRITE-OUTPUT.

           MOVE 'IRC Status. . . . . . . . . . :'     TO PP3-33.
           EVALUATE IRC-OPEN-STATUS
               WHEN DFHVALUE(OPEN)
                   MOVE 'OPEN       '                 TO PP36-46
               WHEN DFHVALUE(CLOSED)
                   MOVE 'CLOSED     '                 TO PP36-46
               WHEN DFHVALUE(CLOSING)
                   MOVE 'CLOSING    '                 TO PP36-46
               WHEN DFHVALUE(IMMCLOSING)
                   MOVE 'IMMCLOSING '                 TO PP36-46
               WHEN OTHER
                   CONTINUE
           END-EVALUATE.
           MOVE 'WLM Report Class. . . . . . . . . :' TO PP71-105.
           MOVE MNG-REPORT-CLASS                      TO PP108-115.
           PERFORM WRITE-OUTPUT.

           MOVE 'IRC XCF Group Name. . . . . . :'     TO PP3-33.
           MOVE IRC-XCFGROUP-NAME                     TO PP36-43.
           MOVE 'WLM Resource Group. . . . . . . . :' TO PP71-105.
           MOVE MNG-RESOURCE-GROUP                    TO PP108-115.
           PERFORM WRITE-OUTPUT.

           MOVE 'WLM Goal Type . . . . . . . . . . :' TO PP71-105.
           EVALUATE TRUE
               WHEN MNG-WLM-AS-GOAL-VELOCITY
                   MOVE 'Velocity   ' TO PP108-118
               WHEN MNG-WLM-AS-GOAL-DISCRETIONARY
                   MOVE 'Discretionary ' TO PP108-120
               WHEN MNG-WLM-AS-GOAL-SYSTEM
                   MOVE 'System ' TO PP108-114
               WHEN OTHER
                    CONTINUE
           END-EVALUATE.
           PERFORM WRITE-OUTPUT.

      *****************************************************************
      *** Get the Storage Manager DSA statistics.                   ***
      *****************************************************************
           EXEC CICS EXTRACT STATISTICS STORAGE
               SET(ADDRESS OF DFHSMSDS)
           END-EXEC.

           MOVE 'Storage Protection. . . . . . :' TO PP3-33.
           EVALUATE STORAGE-PROTECTION
               WHEN DFHVALUE(ACTIVE)
                   MOVE 'ACTIVE  ' TO PP36-43
               WHEN DFHVALUE(INACTIVE)
                   MOVE 'INACTIVE' TO PP36-43
               WHEN OTHER
                   CONTINUE
           END-EVALUATE.
           MOVE 'WLM Goal Value. . . . . . . . . . :' TO PP71-105.
           EVALUATE TRUE
               WHEN MNG-WLM-AS-GOAL-VELOCITY
                   MOVE MNG-WLM-AS-GOAL-VALUE TO PP108-113
               WHEN OTHER
                   MOVE 'N/A    '             TO PP108-114
           END-EVALUATE.
           PERFORM WRITE-OUTPUT.

           MOVE 'Transaction Isolation . . . . :' TO PP3-33.
           EVALUATE TRANSACTION-ISOLATION
               WHEN DFHVALUE(ACTIVE)
                   MOVE 'ACTIVE  ' TO PP36-43
               WHEN DFHVALUE(INACTIVE)
                   MOVE 'INACTIVE' TO PP36-43
               WHEN OTHER
                   CONTINUE
           END-EVALUATE.
           MOVE 'WLM Goal Importance . . . . . . . :' TO PP71-105.
           MOVE MNG-WLM-AS-GOAL-IMPORTANCE            TO PP108-113.
           PERFORM WRITE-OUTPUT.

           MOVE 'Reentrant Programs. . . . . . :' TO PP3-33.
           EVALUATE TRUE
               WHEN SMSRENTPGMP
                   MOVE 'PROTECT  ' TO PP36-44
               WHEN SMSRENTPGMNP
                   MOVE 'NOPROTECT' TO PP36-44
           END-EVALUATE.
           MOVE 'WLM CPU Critical. . . . . . . . . :' TO PP71-105.
           EVALUATE TRUE
               WHEN MNG-WLM-AS-CPU-CRIT-YES
                   MOVE 'Yes    ' TO PP108-114
               WHEN MNG-WLM-AS-CPU-CRIT-NO
                   MOVE 'No     ' TO PP108-114
               WHEN OTHER
                   CONTINUE
           END-EVALUATE.
           PERFORM WRITE-OUTPUT.

           MOVE 'Exec storage command checking :' TO PP3-33.
           EVALUATE COMMAND-PROTECTION
               WHEN DFHVALUE(CMDPROT)
                   MOVE 'ACTIVE  ' TO PP36-43
               WHEN DFHVALUE(NOCMDPROT)
                   MOVE 'INACTIVE' TO PP36-43
               WHEN OTHER
                   CONTINUE
           END-EVALUATE.
           MOVE 'WLM Storage Critical. . . . . . . :' TO PP71-105.
           EVALUATE TRUE
               WHEN MNG-WLM-AS-STG-CRIT-YES
                   MOVE 'Yes    ' TO PP108-114
               WHEN MNG-WLM-AS-STG-CRIT-NO
                   MOVE 'No     ' TO PP108-114
               WHEN OTHER
                   CONTINUE
           END-EVALUATE.
           PERFORM WRITE-OUTPUT.

           PERFORM WRITE-OUTPUT.

           MOVE 'Force Quasi-Reentrant . . . . :' TO PP3-33.
           EVALUATE FORCE-QR-STATUS
               WHEN DFHVALUE(FORCE)
                   MOVE 'Yes' TO PP36-38
               WHEN DFHVALUE(NOFORCE)
                   MOVE 'No ' TO PP36-38
               WHEN OTHER
                   CONTINUE
           END-EVALUATE
           PERFORM WRITE-OUTPUT.

           PERFORM WRITE-OUTPUT.

           MOVE 'Program Autoinstall . . . . . :' TO PP3-33.
           EVALUATE PROGRAM-AUTOINSTALL
               WHEN DFHVALUE(AUTOACTIVE)
                   MOVE 'ACTIVE  ' TO PP36-43
               WHEN DFHVALUE(AUTOINACTIVE)
                   MOVE 'INACTIVE' TO PP36-43
               WHEN OTHER
                   CONTINUE
           END-EVALUATE.
           PERFORM WRITE-OUTPUT.

           MOVE 'Terminal Autoinstall. . . . . :' TO PP3-33.
           EVALUATE AUTOINSTALL-STATUS
               WHEN DFHVALUE(ENABLED)
                   MOVE 'ENABLED ' TO PP36-43
               WHEN DFHVALUE(DISABLED)
                   MOVE 'DISABLED' TO PP36-43
               WHEN OTHER
                   CONTINUE
           END-EVALUATE.
           MOVE 'TCP/IP Status . . . . . . . . . . :' TO PP71-105.
           EVALUATE TCPIP-OPEN-STATUS
               WHEN DFHVALUE(OPEN)
                   MOVE 'OPEN       ' TO PP108-118
               WHEN DFHVALUE(CLOSED)
                   MOVE 'CLOSED     ' TO PP108-118
               WHEN DFHVALUE(CLOSING)
                   MOVE 'CLOSING    ' TO PP108-118
               WHEN DFHVALUE(IMMCLOSING)
                   MOVE 'IMMCLOSING ' TO PP108-118
               WHEN OTHER
                   CONTINUE
           END-EVALUATE.
           PERFORM WRITE-OUTPUT.

           PERFORM WRITE-OUTPUT.

           MOVE 'Activity Keypoint Frequency. . . . :' TO PP3-38.
           MOVE KEYPOINT-FREQUENCY                     TO PP41-50.
           MOVE 'Max IP Sockets. . . . . . . . . . :'  TO PP71-105.
           MOVE MAX-SOCKETS                            TO PP108-113.
           PERFORM WRITE-OUTPUT.

           MOVE 'Logstream Deferred Force Interval. :' TO PP3-38.
           MOVE LOGDEFER-INTERVAL                      TO PP41-50.
           MOVE 'Active IP Sockets.. . . . . . . . :'  TO PP71-105.
           MOVE ACTIVE-SOCKETS                         TO PP108-113.
           PERFORM WRITE-OUTPUT.

           PERFORM WRITE-OUTPUT.

           MOVE 'RLS Status. . . . . . . . . . :' TO PP3-33.
           EVALUATE RLS-STATUS
               WHEN DFHVALUE(RLSACTIVE)
                   MOVE 'ACTIVE  ' TO PP36-43
               WHEN DFHVALUE(RLSINACTIVE)
                   MOVE 'INACTIVE' TO PP36-43
               WHEN DFHVALUE(NOTAPPLIC)
                   MOVE 'RLS=NO  ' TO PP36-43
               WHEN OTHER
                   CONTINUE
           END-EVALUATE.
           MOVE 'WEB Garbage Collection Interval . :'  TO PP71-105.
           MOVE GARBAGE-COLLECTION-INT                 TO PP108-113.
           PERFORM WRITE-OUTPUT.

           MOVE 'RRMS/MVS Status . . . . . . . :' TO PP3-33.
           EVALUATE RRMS-OPEN-STATUS
               WHEN DFHVALUE(OPEN)
                   MOVE 'OPEN    ' TO PP36-43
               WHEN DFHVALUE(CLOSED)
                   MOVE 'CLOSED  ' TO PP36-43
               WHEN DFHVALUE(NOTAPPLIC)
                   MOVE 'RRMS=NO ' TO PP36-43
               WHEN OTHER
                   CONTINUE
           END-EVALUATE.
           MOVE 'Terminal Input Timeout Interval . :'  TO PP71-105.
           MOVE TERMINAL-INPUT-TIMEOUT-INT             TO PP108-113.
           PERFORM WRITE-OUTPUT.

           PERFORM WRITE-OUTPUT.

           MOVE 'DB2 Connection Name . . . . . :'      TO PP3-33.
           MOVE DB2-CONNECTION-NAME                    TO PP36-43.
           PERFORM WRITE-OUTPUT.

           IF DB2-CONNECTION-NAME NOT = SPACES THEN
               MOVE 'DB2 Connection Status . . . . :'  TO PP3-33
               EVALUATE DB2-CONNECT-STATUS
                   WHEN DFHVALUE(CONNECTED)
                       MOVE 'CONNECTED     ' TO PP36-49
                   WHEN DFHVALUE(NOTCONNECTED)
                       MOVE 'NOTCONNECTED  ' TO PP36-49
                   WHEN DFHVALUE(CONNECTING)
                       MOVE 'CONNECTING    ' TO PP36-49
                   WHEN DFHVALUE(DISCONNING)
                       MOVE 'DISCONNECTING ' TO PP36-49
                   WHEN OTHER
                       CONTINUE
               END-EVALUATE
           END-IF.
           PERFORM WRITE-OUTPUT.

           EXEC CICS FREEMAIN DATAPOINTER(MNGDS-DATA-PTR)
           END-EXEC.

           MOVE '0'     TO PRINT-CONTROL.
           MOVE ALL '-' TO PP1-132.
           PERFORM WRITE-OUTPUT.
           EJECT
      *****************************************************************
      ***   Print headings and Monitoring and Statistics Status     ***
      *****************************************************************

           PERFORM PAGE-HEADINGS.

           MOVE '-' TO PRINT-CONTROL.
           MOVE 'Monitoring' TO PP1-10.
           MOVE 'Statistics' TO PP67-76.
           PERFORM WRITE-OUTPUT.
           MOVE '+'     TO PRINT-CONTROL.
           MOVE ALL '_' TO PP1-10.
           MOVE ALL '_' TO PP67-76.
           PERFORM WRITE-OUTPUT.

      *****************************************************************
      *** Get the Statistics Global Statistics.                     ***
      *****************************************************************
           EXEC CICS EXTRACT STATISTICS STATS
               SET(ADDRESS OF DFHSTGDS)
               LASTRESETABS(LAST-RESET-ABS)
           END-EXEC.

           MOVE '0' TO PRINT-CONTROL.
           MOVE 'Monitoring . . . . . :'                TO PP3-24.
           EVALUATE MONITOR-STATUS
               WHEN DFHVALUE(ON)
                   MOVE 'ON ' TO PP27-29
               WHEN DFHVALUE(OFF)
                   MOVE 'OFF' TO PP27-29
               WHEN OTHER
                   CONTINUE
           END-EVALUATE.
           MOVE 'Statistics Recording. . . . . . . . :' TO PP69-105.
           EVALUATE RECORDING-STATUS
               WHEN DFHVALUE(OFF)
                   MOVE 'OFF' TO PP108-110
               WHEN DFHVALUE(ON)
                   MOVE 'ON ' TO PP108-110
               WHEN OTHER
                   CONTINUE
           END-EVALUATE.
           PERFORM WRITE-OUTPUT.
           MOVE 'Exception Class. . . :'                TO PP3-24.
           EVALUATE EXCEPTION-CLASS
               WHEN DFHVALUE(EXCEPT)
                   MOVE 'ON ' TO PP27-29
               WHEN DFHVALUE(NOEXCEPT)
                   MOVE 'OFF' TO PP27-29
               WHEN OTHER
                   CONTINUE
           END-EVALUATE.
           MOVE 'Statistics Last Reset Date and Time :' TO PP69-105.
           EXEC CICS FORMATTIME ABSTIME(LAST-RESET-ABS)
               MMDDYYYY(PP108-117X) DATESEP
               TIME(PP120-132) TIMESEP
           END-EXEC.

           PERFORM WRITE-OUTPUT.
           MOVE 'Performance Class. . :'                TO PP3-24.
           EVALUATE PERFORMANCE-CLASS
               WHEN DFHVALUE(PERF)
                   MOVE 'ON ' TO PP27-29
               WHEN DFHVALUE(NOPERF)
                   MOVE 'OFF' TO PP27-29
               WHEN OTHER
                   CONTINUE
           END-EVALUATE.

           MOVE 'Elapsed Time Since Reset. . . . . . :' TO PP69-105.
           EXEC CICS FORMATTIME ABSTIME(ELAPSED-ABS)
               TIME(PP108-115) TIMESEP
           END-EXEC.

           PERFORM WRITE-OUTPUT.

           MOVE 'Resource Class . . . :'                TO PP3-24.
           EVALUATE RESOURCE-CLASS
               WHEN DFHVALUE(RESRCE)
                   MOVE 'ON ' TO PP27-29
               WHEN DFHVALUE(NORESRCE)
                   MOVE 'OFF' TO PP27-29
               WHEN OTHER
                   CONTINUE
           END-EVALUATE.
           PERFORM WRITE-OUTPUT.

           MOVE 'Identity Class . . . :' TO PP3-24.
           EVALUATE IDENTITY-CLASS
               WHEN DFHVALUE(IDNTY)
                   MOVE 'ON ' TO PP27-29
               WHEN DFHVALUE(NOIDNTY)
                   MOVE 'OFF' TO PP27-29
               WHEN OTHER
                   CONTINUE
           END-EVALUATE.
           MOVE 'Statistics Interval . . . . . . . . :' TO PP69-105.
           MOVE COLLECTION-INTERVAL                     TO PP108-115B.
           INSPECT PP108-115B REPLACING ALL ' ' BY ':'.
           PERFORM WRITE-OUTPUT.

           MOVE 'Next Statistics Collection. . . . . :' TO PP69-105.
           MOVE NEXT-COLLECTION-TIME                    TO PP108-115B.
           INSPECT PP108-115B REPLACING ALL ' ' BY ':'.
           PERFORM WRITE-OUTPUT.

           MOVE 'Data Compression Option . . . :'       TO PP3-33.
           EVALUATE COMPRESS-STATUS
               WHEN DFHVALUE(COMPRESS)
                   MOVE 'YES' TO PP36-38
               WHEN DFHVALUE(NOCOMPRESS)
                   MOVE 'NO ' TO PP36-38
               WHEN OTHER
                   CONTINUE
           END-EVALUATE.
           MOVE 'Statistics End-of-Day Time. . . . . :' TO PP69-105.
           MOVE EOD-COLLECTION-TIME                     TO PP108-115B.
           INSPECT PP108-115B REPLACING ALL ' ' BY ':'.
           PERFORM WRITE-OUTPUT.

           PERFORM WRITE-OUTPUT.

           MOVE 'Application Naming. . . . . . :'       TO PP3-33.
           EVALUATE APPLNAME-STATUS
               WHEN DFHVALUE(APPLNAME)
                   MOVE 'YES' TO PP36-38
               WHEN DFHVALUE(NOAPPLNAME)
                   MOVE 'NO ' TO PP36-38
               WHEN OTHER
                   CONTINUE
           END-EVALUATE.
           MOVE 'Statistics Start Date and Time. . . :' TO PP69-105.
           MOVE STGCSTRT  TO CLOCK-FIELD.
           PERFORM TIMESTAMP-CONVERT.
           MOVE MMDDYYYY  TO PP108-117X.
           MOVE STOPWATCH TO PP120-132X
           PERFORM WRITE-OUTPUT.

           MOVE 'RMI Option. . . . . . . . . . :'       TO PP3-33.
           EVALUATE RMI-STATUS
               WHEN DFHVALUE(RMI)
                   MOVE 'YES' TO PP36-38
               WHEN DFHVALUE(NORMI)
                   MOVE 'NO ' TO PP36-38
               WHEN OTHER
                   CONTINUE
           END-EVALUATE.
           PERFORM WRITE-OUTPUT.

           MOVE 'Statistics SMF Records. . . . . . . :' TO PP69-105.
           MOVE STGSMFW                                 TO PP108-117.
           PERFORM WRITE-OUTPUT.

           MOVE 'Converse Option . . . . . . . :'       TO PP3-33.
           EVALUATE CONVERSE-STATUS
               WHEN DFHVALUE(CONVERSE)
                   MOVE 'YES' TO PP36-38
               WHEN DFHVALUE(NOCONVERSE)
                   MOVE 'NO ' TO PP36-38
               WHEN OTHER
                   CONTINUE
           END-EVALUATE.
           MOVE 'Statistics SMF Writes Suppressed. . :' TO PP69-105.
           MOVE STGSMFS                                 TO PP108-117.
           PERFORM WRITE-OUTPUT.

           MOVE 'Syncpoint Option. . . . . . . :'       TO PP3-33.
           EVALUATE SYNCPOINT-STATUS
               WHEN DFHVALUE(SYNCPOINT)
                   MOVE 'YES' TO PP36-38
               WHEN DFHVALUE(NOSYNCPOINT)
                   MOVE 'NO ' TO PP36-38
               WHEN OTHER
                   CONTINUE
           END-EVALUATE.
           MOVE 'Statistics SMF Errors . . . . . . . :' TO PP69-105.
           MOVE STGSMFE                                 TO PP108-117.
           PERFORM WRITE-OUTPUT.

           MOVE 'Time Option . . . . . . . . . :'       TO PP3-33.
           EVALUATE MNTIME-SETTING
               WHEN DFHVALUE(GMT)
                   MOVE 'GMT  ' TO PP36-40
               WHEN DFHVALUE(LOCAL)
                   MOVE 'LOCAL' TO PP36-40
               WHEN OTHER
                   CONTINUE
           END-EVALUATE.
           PERFORM WRITE-OUTPUT.

      *****************************************************************
      *** Get the Monitoring Global Statistics.                     ***
      *****************************************************************
           EXEC CICS EXTRACT STATISTICS MONITOR
               SET(ADDRESS OF DFHMNGDS)
           END-EXEC.

           MOVE 'Current tasks at last attach. . . . :' TO PP69-105.
           MOVE MNGCAUTA                                TO PP108-117.
           PERFORM WRITE-OUTPUT.

           MOVE 'DPL Resource Limit. . . . . . :'       TO PP3-33.
           MOVE DPL-RESOURCE-LIMIT                      TO PP36-37.
           MOVE 'MXT value at last attach. . . . . . :' TO PP69-105.
           MOVE MNGMXUTA                                TO PP108-117.
           PERFORM WRITE-OUTPUT.

           MOVE 'File Resource Limit . . . . . :'       TO PP3-33.
           MOVE FILE-RESOURCE-LIMIT                     TO PP36-37.
           PERFORM WRITE-OUTPUT.

           MOVE 'Tsqueue Resource Limit. . . . :'       TO PP3-33.
           MOVE TSQUEUE-RESOURCE-LIMIT                  TO PP36-37.
           MOVE 'Time last user transaction attached :' TO PP69-105.
           IF MNGLUTAT NOT = LOW-VALUES THEN
               MOVE MNGLUTAT        TO CLOCK-FIELD
               PERFORM TIMESTAMP-CONVERT
               MOVE MMDDYYYY        TO PP108-117X
               MOVE STOPWATCH       TO PP120-132X
           ELSE
               MOVE NULL-DATE-FIELD TO PP108-117X
               MOVE NULL-TIME-FIELD TO PP120-132X
           END-IF.
           PERFORM WRITE-OUTPUT.

           MOVE 'Urimap Resource Limit. . . . .:'       TO PP3-33.
           MOVE URIMAP-RESOURCE-LIMIT                   TO PP36-37.
           MOVE 'Time last user transaction ended. . :' TO PP69-105.
           IF MNGLUTCL NOT = LOW-VALUES THEN
               MOVE MNGLUTCL      TO CLOCK-FIELD
               PERFORM TIMESTAMP-CONVERT
               MOVE MMDDYYYY        TO PP108-117X
               MOVE STOPWATCH       TO PP120-132X
           ELSE
               MOVE NULL-DATE-FIELD TO PP108-117X
               MOVE NULL-TIME-FIELD TO PP120-132X
           END-IF.
           PERFORM WRITE-OUTPUT.

           MOVE 'Webservice Resource Limit. . .:'       TO PP3-33.
           MOVE WEBSVC-RESOURCE-LIMIT                   TO PP36-37.
           PERFORM WRITE-OUTPUT.

           MOVE 'System transactions ended . . . . . :'  TO PP69-105.
           MOVE MNGSTNUM                                 TO PP108-117.
           PERFORM WRITE-OUTPUT.

           MOVE 'Exception Class Records. . . . . . . :' TO PP3-40.
           MOVE MNGER                                    TO PP43-52.
           MOVE 'User transactions ended . . . . . . :'  TO PP69-105.
           MOVE MNGUTNUM                                 TO PP108-117.
           PERFORM WRITE-OUTPUT.

           MOVE 'Exception Records Suppressed . . . . :' TO PP3-40.
           MOVE MNGERS                                   TO PP43-52.
           MOVE 'Total transactions ended. . . . . . :'  TO PP69-105.
           COMPUTE RESULT = (MNGUTNUM + MNGSTNUM)
           END-COMPUTE.
           MOVE RESULT                                   TO PP108-117.
           PERFORM WRITE-OUTPUT.

           MOVE 'Performance Class Records. . . . . . :' TO PP3-40.
           MOVE MNGPR                                    TO PP43-52.
           PERFORM WRITE-OUTPUT.

           MOVE 'Performance Records Suppressed . . . :' TO PP3-40.
           MOVE MNGPRS                                   TO PP43-52.
           MOVE 'Average user transaction resp time. :'  TO PP69-105.
           MOVE MNGAUTRT              TO CLOCK-FIELD.
           PERFORM STOPWATCH-CONVERT.
           MOVE CLOCK-EXTENDED-FORMAT TO PP108-124.
           PERFORM WRITE-OUTPUT.

           MOVE 'Resource Class Records . . . . . . . :' TO PP3-40.
           MOVE MNGRR                                    TO PP43-52.
           MOVE 'Peak user transaction resp time . . :'  TO PP69-105.
           MOVE MNGPUTRT              TO CLOCK-FIELD.
           PERFORM STOPWATCH-CONVERT.
           MOVE CLOCK-EXTENDED-FORMAT TO PP108-124.
           PERFORM WRITE-OUTPUT.

           MOVE 'Resource Records Suppressed. . . . . :' TO PP3-40.
           MOVE MNGRRS                                   TO PP43-52.
           MOVE 'Peak user transaction resp time at. :'  TO PP69-105.
           IF MNGLUTRT NOT = LOW-VALUES THEN
               MOVE MNGLUTRT        TO CLOCK-FIELD
               PERFORM TIMESTAMP-CONVERT
               MOVE MMDDYYYY        TO PP108-117X
               MOVE STOPWATCH       TO PP120-132X
           ELSE
               MOVE NULL-DATE-FIELD TO PP108-117X
               MOVE NULL-TIME-FIELD TO PP120-132X
           END-IF.
           PERFORM WRITE-OUTPUT.

           MOVE 'Identity Class Records . . . . . . . :' TO PP3-40.
           MOVE MNGIR                                    TO PP43-52.
           PERFORM WRITE-OUTPUT.

           MOVE 'Identity Records Suppressed. . . . . :' TO PP3-40.
           MOVE MNGIRS                                   TO PP43-52.
           MOVE 'Total transaction CPU time. . . . . :'  TO PP69-105.
           MOVE MNGCPUT               TO CLOCK-FIELD.
           PERFORM STOPWATCH-CONVERT.
           MOVE CLOCK-EXTENDED-FORMAT TO PP108-124.
           PERFORM WRITE-OUTPUT.

           MOVE 'Total transaction CPU time on CP. . :'  TO PP69-105.
           MOVE MNGTONCP              TO CLOCK-FIELD.
           PERFORM STOPWATCH-CONVERT.
           MOVE CLOCK-EXTENDED-FORMAT TO PP108-124.
           PERFORM WRITE-OUTPUT.

           MOVE 'Monitoring SMF Records . . . . . . . :' TO PP3-40.
           MOVE MNGSMFR                                  TO PP43-52.
           MOVE 'Total transaction CPU offload on CP :'  TO PP69-105.
           MOVE MNGOFLCP              TO CLOCK-FIELD.
           PERFORM STOPWATCH-CONVERT.
           MOVE CLOCK-EXTENDED-FORMAT TO PP108-124.
           PERFORM WRITE-OUTPUT.

           MOVE 'Monitoring SMF Errors. . . . . . . . :' TO PP3-40.
           MOVE MNGSMFE                                  TO PP43-52.
           PERFORM WRITE-OUTPUT.

           MOVE 'Monitoring SMF Records Compressed. . . . :'
                                                        TO PP3-44.
           MOVE MNGSMFCM                                TO PP47-56.
           MOVE 'Average Compressed Record Length. . :' TO PP69-105.
           MOVE MNGAVCRL                                TO PP108-117.
           PERFORM WRITE-OUTPUT.

           MOVE 'Monitoring SMF Records Not Compressed. . :'
                                                        TO PP3-44.
           MOVE MNGSMFNC                                TO PP47-56.
           MOVE 'Average Uncompressed Record Length. :' TO PP69-105.
           MOVE MNGAVURL                                TO PP108-117.
           PERFORM WRITE-OUTPUT.

           MOVE 'Percentage of SMF Records Compressed . . :'
                                                        TO PP3-44.
           IF MNGSMFCM > 0 OR MNGSMFNC > 0 THEN
               COMPUTE PERCENTAGE-WORK ROUNDED =
                           (MNGSMFCM / (MNGSMFCM + MNGSMFNC))
               END-COMPUTE
               COMPUTE PERCENTAGE = (PERCENTAGE-WORK * 100)
               END-COMPUTE
           ELSE
               MOVE 0 TO PERCENTAGE
           END-IF.
           MOVE PERCENTAGE TO PP51-56.
           MOVE '%'        TO PP57.
           MOVE 'Average Record Compression Percent. :' TO PP69-105
           IF MNGAVURL > 0 THEN
               COMPUTE PERCENTAGE-WORK ROUNDED =
                           ((MNGAVURL - MNGAVCRL) / MNGAVURL)
               END-COMPUTE
               COMPUTE PERCENTAGE = (PERCENTAGE-WORK * 100)
               END-COMPUTE
           ELSE
               MOVE 0 TO PERCENTAGE
           END-IF.
           MOVE PERCENTAGE TO PP112-117.
           MOVE '%'        TO PP118.
           PERFORM WRITE-OUTPUT.

           MOVE '0'     TO PRINT-CONTROL.
           MOVE ALL '-' TO PP1-132.
           PERFORM WRITE-OUTPUT.
           EJECT
      *****************************************************************
      ***   Print headings, Trace status and Number of Dumps.       ***
      *****************************************************************
           MOVE '0' TO PRINT-CONTROL.
           MOVE 'Trace Status' TO PP1-12.
           MOVE 'Dumps'        TO PP67-71.
           PERFORM WRITE-OUTPUT.
           MOVE '+'     TO PRINT-CONTROL.
           MOVE ALL '_' TO PP1-12.
           MOVE ALL '_' TO PP67-71.
           PERFORM WRITE-OUTPUT.

           EXEC CICS EXTRACT STATISTICS SYSDUMPCODE
               SET(ADDRESS OF DFHSDGDS)
           END-EXEC.

           MOVE '0' TO PRINT-CONTROL.
           MOVE 'Internal Trace Status . . . . :'       TO PP3-33.
           EVALUATE INT-STATUS
               WHEN DFHVALUE(INTSTART)
                   MOVE 'STARTED '                      TO PP36-43
               WHEN DFHVALUE(INTSTOP)
                   MOVE 'STOPPED '                      TO PP36-43
               WHEN OTHER
                   CONTINUE
           END-EVALUATE.
           MOVE 'System Dumps. . . . . . . . . . . . :' TO PP69-105.
           MOVE SDGSDREQ                                TO PP108-117.
           PERFORM WRITE-OUTPUT.

           MOVE 'Auxiliary Trace Status. . . . :'       TO PP3-33.
           EVALUATE AUX-STATUS
               WHEN DFHVALUE(AUXSTART)
                   MOVE 'STARTED '                      TO PP36-43
               WHEN DFHVALUE(AUXSTOP)
                   MOVE 'STOPPED '                      TO PP36-43
               WHEN DFHVALUE(AUXPAUSE)
                   MOVE 'PAUSED  '                      TO PP36-43
               WHEN OTHER
                   CONTINUE
           END-EVALUATE.
           MOVE 'System Dumps Suppressed . . . . . . :' TO PP69-105.
           MOVE SDGSDSUP                                TO PP108-117.
           PERFORM WRITE-OUTPUT.

           MOVE 'GTF Trace Status. . . . . . . :'       TO PP3-33.
           EVALUATE GTF-STATUS
               WHEN DFHVALUE(GTFSTART)
                   MOVE 'STARTED '                      TO PP36-43
               WHEN DFHVALUE(GTFSTOP)
                   MOVE 'STOPPED '                      TO PP36-43
               WHEN OTHER
                   CONTINUE
           END-EVALUATE.
           PERFORM WRITE-OUTPUT.

           EXEC CICS EXTRACT STATISTICS TRANDUMPCODE
               SET(ADDRESS OF DFHTDGDS)
           END-EXEC.

           MOVE 'Transaction Dumps . . . . . . . . . :' TO PP69-105.
           MOVE SDGTDREQ                                TO PP108-117.
           PERFORM WRITE-OUTPUT.

           MOVE 'Internal Trace Table Size . . :'       TO PP3-33.
           MOVE TRACE-TABLE-SIZE                        TO PP36-44N.
           MOVE 'K'                                     TO PP45.
           MOVE 'Transaction Dumps Suppressed. . . . :' TO PP69-105.
           MOVE SDGTDSUP                                TO PP108-117.
           PERFORM WRITE-OUTPUT.

           MOVE 'Current Auxiliary Dataset . . :'       TO PP3-33.
           MOVE CURRENT-AUX-DATASET                     TO PP36.
           PERFORM WRITE-OUTPUT.
           MOVE 'Auxiliary Switch Status . . . :'       TO PP3-33.
           EVALUATE SWITCH-STATUS
               WHEN DFHVALUE(NOSWITCH)
                   MOVE 'NOSWITCH'                      TO PP36-43
               WHEN DFHVALUE(SWITCHNEXT)
                   MOVE 'NEXT    '                      TO PP36-43
               WHEN DFHVALUE(SWITCHALL)
                   MOVE 'ALL     '                      TO PP36-43
               WHEN OTHER
                   CONTINUE
           END-EVALUATE.
           PERFORM WRITE-OUTPUT.

           MOVE '0'     TO PRINT-CONTROL.
           MOVE ALL '-' TO PP1-132.
           PERFORM WRITE-OUTPUT.

       SYSTEM-STATUS-EXIT.
           EXIT.
           EJECT
      *****************************************************************
      *** TRANSACTION-MGR-STATISTICS SECTION                        ***
      ***   Collect the transaction manager statistics              ***
      ***   Print heading and transaction manager statistics        ***
      *****************************************************************
       TRANSACTION-MGR-STATISTICS SECTION.

      *****************************************************************
      *** Get number of User and System transactions                ***
      *****************************************************************
           EXEC CICS INQUIRE TASK LIST
               LISTSIZE(ALL-TASKS)
           END-EXEC.

      *****************************************************************
      *** Get number of running User and System transactions        ***
      *****************************************************************
           EXEC CICS INQUIRE TASK LIST RUNNING
               LISTSIZE(RUNNING-TASKS)
           END-EXEC.

      *****************************************************************
      *** Get number of dispatchable User and System transactions   ***
      *****************************************************************
           EXEC CICS INQUIRE TASK LIST DISPATCHABLE
               LISTSIZE(DISPATCHABLE-TASKS)
           END-EXEC.

      *****************************************************************
      *** Get number of suspended User and System transactions      ***
      *****************************************************************
           EXEC CICS INQUIRE TASK LIST SUSPENDED
               LISTSIZE(SUSPENDED-TASKS)
           END-EXEC.

           PERFORM PAGE-HEADINGS.
           MOVE PAGENO TO TRANSACTION-MGR-PAGENO.

      *****************************************************************
      *** Collect Transaction Manager (Global) statistics           ***
      *****************************************************************
           EXEC CICS EXTRACT STATISTICS TRANSACTION
               SET(ADDRESS OF DFHXMGDS)
           END-EXEC.

      *****************************************************************
      ***   Print heading and transaction manager statistics.       ***
      *****************************************************************
           MOVE '-'     TO PRINT-CONTROL.
           MOVE 'Transaction Manager' TO PP1-19.
           PERFORM WRITE-OUTPUT.
           MOVE '+'     TO PRINT-CONTROL.
           MOVE ALL '_' TO PP1-19.
           PERFORM WRITE-OUTPUT.

           MOVE '0' TO PRINT-CONTROL.
           MOVE 'Total Accumulated transactions so far. . :'
                          TO PP3-44.
           COMPUTE TOTAL-ACCUM-TRANSACTIONS = (XMGTNUM + XMGNUM).
           MOVE TOTAL-ACCUM-TRANSACTIONS TO PP48-60.
           PERFORM WRITE-OUTPUT.

           MOVE '0' TO PRINT-CONTROL.
           MOVE 'Accumulated transactions (since reset) . :'
                          TO PP3-44.
           MOVE XMGNUM    TO PP48-60.
           MOVE 'Transaction Rate per second . . . . :' TO PP69-105.

           COMPUTE TRANSACTION-RATE = (XMGNUM / LAST-RESET-SECONDS)
           END-COMPUTE
           MOVE TRANSACTION-RATE                   TO PP107-113.
           PERFORM WRITE-OUTPUT.

           MOVE '0' TO PRINT-CONTROL.
           MOVE 'Maximum transactions allowed (MXT) . . . :'
                          TO PP3-44.
           MOVE XMGMXT    TO PP51-60.
           MOVE 'Time MXT last changed . . . . . . . :' TO PP69-105.
           MOVE XMGLSMXT  TO CLOCK-FIELD.
           PERFORM TIMESTAMP-CONVERT.
           MOVE MMDDYYYY        TO PP108-117X.
           MOVE STOPWATCH       TO PP120-132X.
           PERFORM WRITE-OUTPUT.
           MOVE 'Times at MXT . . . . . . . . . . . . . . :'
                          TO PP3-44.
           MOVE XMGTAMXT  TO PP51-60.
           MOVE 'Time MXT last reached . . . . . . . :' TO PP69-105.
           IF XMGLAMXT NOT = LOW-VALUES
               MOVE XMGLAMXT        TO CLOCK-FIELD
               PERFORM TIMESTAMP-CONVERT
               MOVE MMDDYYYY        TO PP108-117X
               MOVE STOPWATCH       TO PP120-132X
           ELSE
               MOVE NULL-DATE-FIELD TO PP108-117X
               MOVE NULL-TIME-FIELD TO PP120-132X
           END-IF.
           PERFORM WRITE-OUTPUT.
           MOVE 'Current Active User transactions . . . . :'
                          TO PP3-44.
           MOVE XMGCAT    TO PP51-60.
           MOVE 'Currently at MXT. . . . . . . . . . :' TO PP69-105.
           IF  XMGCAMXT
               MOVE 'Yes' TO PP108-110
           ELSE
               MOVE 'No'   TO PP108-110
           END-IF.
           PERFORM WRITE-OUTPUT.
           MOVE 'Peak Active User transactions. . . . . . :'
                          TO PP3-44.
           MOVE XMGPAT    TO PP51-60.
           PERFORM WRITE-OUTPUT.
           MOVE 'Total Active User transactions . . . . . :'
                          TO PP3-44.
           MOVE XMGTAT    TO PP48-60.
           MOVE 'Time last transaction attached. . . :' TO PP69-105.
           IF XMGLTAT NOT = LOW-VALUES
               MOVE XMGLTAT        TO CLOCK-FIELD
               PERFORM TIMESTAMP-CONVERT
               MOVE MMDDYYYY        TO PP108-117X
               MOVE STOPWATCH       TO PP120-132X
           ELSE
               MOVE NULL-DATE-FIELD TO PP108-117X
               MOVE NULL-TIME-FIELD TO PP120-132X
           END-IF.
           PERFORM WRITE-OUTPUT.

           MOVE '0' TO PRINT-CONTROL.
           MOVE 'Current Running transactions . . . . . . :'
                                   TO PP3-44.
           MOVE RUNNING-TASKS      TO PP51-60.
           PERFORM WRITE-OUTPUT.

           MOVE 'Current Dispatchable transactions. . . . :'
                                   TO PP3-44.
           MOVE DISPATCHABLE-TASKS TO PP51-60.
           PERFORM WRITE-OUTPUT.

           MOVE 'Current Suspended transactions . . . . . :'
                                   TO PP3-44.
           MOVE SUSPENDED-TASKS    TO PP51-60.
           PERFORM WRITE-OUTPUT.

           MOVE 'Current System transactions. . . . . . . :'
                                   TO PP3-44.
           COMPUTE SYSTEM-TASKS = (ALL-TASKS - XMGCAT).
           MOVE SYSTEM-TASKS       TO PP51-60.
           PERFORM WRITE-OUTPUT.

           MOVE '0' TO PRINT-CONTROL.
           MOVE 'Transactions Delayed by MXT. . . . . . . :'
                          TO PP3-44.
           MOVE XMGTDT    TO PP51-60.
           PERFORM WRITE-OUTPUT.
           MOVE 'Total MXT queueing time. . . . . . . . . :'
                          TO PP3-44.
           MOVE XMGTQTME  TO CLOCK-FIELD.
           PERFORM STOPWATCH-CONVERT.
           MOVE STOPWATCH TO PP47-60.
           PERFORM WRITE-OUTPUT.
           MOVE 'Average MXT queueing time. . . . . . . . :'
                          TO PP3-44.
           IF XMGTDT > 0 THEN
               MOVE XMGTQTME TO CLOCK-WORK-FIELD
               COMPUTE CLOCK-FIELD-S = (CLOCK-WORK-FIELD-S / XMGTDT)
           ELSE
               MOVE 0 TO CLOCK-FIELD-S
           END-IF.
           PERFORM STOPWATCH-CONVERT.
           MOVE STOPWATCH TO PP47-60.
           PERFORM WRITE-OUTPUT.

           MOVE '0' TO PRINT-CONTROL.
           MOVE 'Current Queued User transactions . . . . :'
                          TO PP3-44.
           MOVE XMGCQT    TO PP51-60.
           PERFORM WRITE-OUTPUT.
           MOVE 'Peak Queued User transactions. . . . . . :'
                          TO PP3-44.
           MOVE XMGPQT    TO PP51-60.
           PERFORM WRITE-OUTPUT.
           MOVE 'Total Queueing time for current queued . :'
                          TO PP3-44.
           MOVE XMGCQTME  TO CLOCK-FIELD.
           PERFORM STOPWATCH-CONVERT.
           MOVE STOPWATCH TO PP47-60.
           PERFORM WRITE-OUTPUT.
           MOVE 'Average Queueing time for current queued :'
                          TO PP3-44.
           IF XMGCQT > 0 THEN
               MOVE XMGCQTME TO CLOCK-WORK-FIELD
               COMPUTE CLOCK-FIELD-S = (CLOCK-WORK-FIELD-S / XMGCQT)
           ELSE
               MOVE 0 TO CLOCK-FIELD-S
           END-IF.
           PERFORM STOPWATCH-CONVERT.
           MOVE STOPWATCH TO PP47-60.
           PERFORM WRITE-OUTPUT.

       TRANSACTION-MGR-STATS-EXIT.
           EXIT.
           EJECT
      *****************************************************************
      *** DISPATCHER-STATISTICS SECTION                             ***
      ***   Get dispatcher statistics                               ***
      ***   Print heading and dispatcher statistics                 ***
      *****************************************************************
       DISPATCHER-STATISTICS SECTION.

           PERFORM PAGE-HEADINGS.
           MOVE PAGENO TO DISPATCHER-PAGENO.

      *****************************************************************
      *** Get dispatcher statistics                                 ***
      *****************************************************************
           EXEC CICS EXTRACT STATISTICS DISPATCHER
               SET(ADDRESS OF DFHDSGDS)
           END-EXEC.

      *****************************************************************
      ***   Print the headings for the Dispatcher statistics.       ***
      *****************************************************************
           MOVE '-'          TO PRINT-CONTROL.
           MOVE 'Dispatcher' TO PP1-10.
           PERFORM WRITE-OUTPUT.
           MOVE '+'     TO PRINT-CONTROL.
           MOVE ALL '_' TO PP1-10.
           PERFORM WRITE-OUTPUT.

      *****************************************************************
      ***   Print the Dispatcher statistics                         ***
      *****************************************************************

           MOVE '0' TO PRINT-CONTROL.
           MOVE 'Current ICV time . . . . . . . . . . . . . :'
                              TO PP3-46.
           MOVE DSGICVT       TO PP53-62.
           MOVE 'ms'          TO PP63-64.
           PERFORM WRITE-OUTPUT.

           MOVE 'Current ICVR time. . . . . . . . . . . . . :'
                              TO PP3-46.
           MOVE DSGICVRT      TO PP53-62.
           MOVE 'ms'          TO PP63-64.
           PERFORM WRITE-OUTPUT.

           MOVE 'Current ICVTSD time. . . . . . . . . . . . :'
                              TO PP3-46.
           MOVE DSGICVSD      TO PP53-62.
           MOVE 'ms'          TO PP63-64.
           PERFORM WRITE-OUTPUT.

           MOVE 'Current PRTYAGING time . . . . . . . . . . :'
                              TO PP3-46.
           MOVE DSGPRIAG      TO PP53-62.
           MOVE 'ms'          TO PP63-64.
           PERFORM WRITE-OUTPUT.

           MOVE '0' TO PRINT-CONTROL.
           MOVE 'MRO (QR) Batching (MROBTCH) value. . . . . :'
                              TO PP3-46.
           MOVE DSGMBTCH      TO PP53-62.
           PERFORM WRITE-OUTPUT.

           MOVE '0' TO PRINT-CONTROL.
           MOVE 'Concurrent Subtasking value. . . . . . . . :'
                              TO PP3-46.
           MOVE DSGSTSKS      TO PP53-62.
           PERFORM WRITE-OUTPUT.

           MOVE '-' TO PRINT-CONTROL.
           MOVE 'Current number of CICS Dispatcher tasks. . :'
                              TO PP3-46.
           MOVE DSGCNT        TO PP53-62.
           PERFORM WRITE-OUTPUT.

           MOVE 'Peak number of CICS Dispatcher tasks . . . :'
                              TO PP3-46.
           MOVE DSGPNT        TO PP53-62.
           PERFORM WRITE-OUTPUT.

           MOVE 1 TO SUB1.
           PERFORM WITH TEST BEFORE
               UNTIL SUB1 > DSGASIZE
                   ADD DSGTCBCA(SUB1) TO CURRENT-TCBS-ATTACHED
                   ADD DSGTCBCU(SUB1) TO CURRENT-TCBS-IN-USE
                   ADD 1 TO SUB1
           END-PERFORM.

           MOVE '0' TO PRINT-CONTROL.
           MOVE 'Current number of TCBs attached. . . . . . :'
                                      TO PP3-46.
           MOVE CURRENT-TCBS-ATTACHED TO PP53-62.
           PERFORM WRITE-OUTPUT.
           MOVE 'Current number of TCBs in use. . . . . . . :'
                                      TO PP3-46.
           MOVE CURRENT-TCBS-IN-USE   TO PP53-62.
           PERFORM WRITE-OUTPUT.

           MOVE '0' TO PRINT-CONTROL.
           MOVE 'Last Excess TCB Scan . . . . . . . . . . . :'
                         TO PP3-46.
           IF DSGLXSCN NOT = LOW-VALUES THEN
             MOVE DSGLXSCN     TO CLOCK-FIELD
             PERFORM TIMESTAMP-CONVERT
             MOVE STOPWATCH    TO PP48-64
             MOVE MMDDYYYY     TO PP67-76
           ELSE
             MOVE NULL-TIME-FIELD TO PP48-64
             MOVE NULL-DATE-FIELD TO PP67-76
           END-IF.
           PERFORM WRITE-OUTPUT.

           MOVE 'Number of Excess TCB Scans . . . . . . . . :'
                         TO PP3-46.
           MOVE DSGXSCNS TO PP53-62.
           PERFORM WRITE-OUTPUT.

           MOVE 'Last Excess TCB Scan - No TCB Detached . . :'
                         TO PP3-46.
           IF DSGLXSND NOT = LOW-VALUES THEN
             MOVE DSGLXSND     TO CLOCK-FIELD
             PERFORM TIMESTAMP-CONVERT
             MOVE STOPWATCH    TO PP48-64
             MOVE MMDDYYYY     TO PP67-76
           ELSE
             MOVE NULL-TIME-FIELD TO PP48-64
             MOVE NULL-DATE-FIELD TO PP67-76
           END-IF.
           PERFORM WRITE-OUTPUT.

           MOVE 'Excess TCB Scans - No TCB Detached . . . . :'
                         TO PP3-46.
           MOVE DSGXSCNN TO PP53-62.
           PERFORM WRITE-OUTPUT.
           MOVE 'Number of Excess TCBs Detached . . . . . . :'
                         TO PP3-46.
           MOVE DSGXTCBD TO PP53-62.
           PERFORM WRITE-OUTPUT.
           MOVE 'Average Excess TCBs Detached per Scan. . . :'
                         TO PP3-46.
           IF DSGXSCNS > 0 THEN
               COMPUTE RESULT = (DSGXTCBD / DSGXSCNS)
               END-COMPUTE
           ELSE
               MOVE 0 TO RESULT
           END-IF.
           MOVE RESULT   TO PP53-62.
           PERFORM WRITE-OUTPUT.

           MOVE '-' TO PRINT-CONTROL.
           MOVE 'Number of CICS TCB MODEs . . . . . . . . . :'
                              TO PP3-46.
           MOVE DSGASIZE      TO PP53-62.
           PERFORM WRITE-OUTPUT.

           MOVE '0' TO PRINT-CONTROL.
           MOVE 'Number of CICS TCB POOLs . . . . . . . . . :'
                              TO PP3-46.
           MOVE DSGPSIZE      TO PP53-62.
           PERFORM WRITE-OUTPUT.

      *****************************************************************
      ***  Print the Dispatcher Address Space timing details along  ***
      ***  with the related TCB Mode timing information.            ***
      *****************************************************************
           PERFORM PAGE-HEADINGS.
           MOVE PAGENO TO DISPATCHER-TCB-MODES-PAGENO.

           MOVE '-'     TO PRINT-CONTROL.
           MOVE 'Dispatcher TCB Modes' TO PP1-20.
           PERFORM WRITE-OUTPUT.
           MOVE '+'     TO PRINT-CONTROL.
           MOVE ALL '_' TO PP1-20.
           PERFORM WRITE-OUTPUT.

           MOVE '0' TO PRINT-CONTROL.
           MOVE 'Dispatcher Start Time and Date . . . . . . :'
                          TO PP3-46.
           MOVE DSGLSTRT  TO CLOCK-FIELD.
           PERFORM TIMESTAMP-CONVERT.
           MOVE STOPWATCH TO PP51-65.
           MOVE MMDDYYYY  TO PP68-77.
           PERFORM WRITE-OUTPUT.

           MOVE '0' TO PRINT-CONTROL.
           MOVE 'Address Space Accumulated CPU Time . . . . :'
                              TO PP3-46.
           MOVE ADSP-CPU-TIME TO CLOCK-FIELD.
           PERFORM STOPWATCH-CONVERT.
           MOVE CLOCK-EXTENDED-FORMAT TO PP49-65.
           MOVE '(Not Reset)'         TO PP68-78.
           PERFORM WRITE-OUTPUT.
           MOVE 'Address Space Accumulated SRB Time . . . . :'
                              TO PP3-46.
           MOVE ADSP-SRB-TIME TO CLOCK-FIELD.
           PERFORM STOPWATCH-CONVERT.
           MOVE CLOCK-EXTENDED-FORMAT TO PP49-65.
           MOVE '(Not Reset)'         TO PP68-78.
           PERFORM WRITE-OUTPUT.

           MOVE '0' TO PRINT-CONTROL.
           MOVE 'Address Space CPU Time (Since Reset) . . . :'
                              TO PP3-46.
           MOVE DSGEJST       TO CLOCK-FIELD.
           PERFORM STOPWATCH-CONVERT.
           MOVE CLOCK-EXTENDED-FORMAT TO PP49-65.
           PERFORM WRITE-OUTPUT.
           MOVE 'Address Space SRB Time (Since Reset) . . . :'
                              TO PP3-46.
           MOVE DSGSRBT       TO CLOCK-FIELD.
           PERFORM STOPWATCH-CONVERT.
           MOVE CLOCK-EXTENDED-FORMAT TO PP49-65.
           PERFORM WRITE-OUTPUT.

      *****************************************************************
           PERFORM TCB-SUB-HEADINGS-3.

           MOVE 1 TO SUB1.
           PERFORM WITH TEST BEFORE
               UNTIL SUB1 > DSGASIZE
                   MOVE DSGTCBNM(SUB1)  TO PP5-6

                   MOVE DSGTCBCA(SUB1)  TO PP10-16
                   MOVE DSGTCBPA(SUB1)  TO PP19-25

                   MOVE DSGSYSW(SUB1)   TO PP28-37

                   MOVE DSGTWT(SUB1)          TO CLOCK-FIELD
                   PERFORM STOPWATCH-CONVERT
                   MOVE CLOCK-EXTENDED-FORMAT TO PP41-57

                   MOVE DSGTDT(SUB1)          TO CLOCK-FIELD
                   PERFORM STOPWATCH-CONVERT
                   MOVE CLOCK-EXTENDED-FORMAT TO PP60-76

                   MOVE DSGACT(SUB1)    TO STCK-WORK-A
                   ADD  STCK-WORK-NUM-A TO DSGACT-TOTAL-NUM
                       ON SIZE ERROR CONTINUE
                   END-ADD

                   MOVE DSGACT(SUB1)          TO CLOCK-FIELD
                   PERFORM STOPWATCH-CONVERT
                   MOVE CLOCK-EXTENDED-FORMAT TO PP79-95

                   MOVE DSGTCT(SUB1)    TO STCK-WORK-A
                   ADD  STCK-WORK-NUM-A TO DSGTCT-TOTAL-NUM
                       ON SIZE ERROR CONTINUE
                   END-ADD

                   MOVE DSGTCT(SUB1)          TO CLOCK-FIELD
                   PERFORM STOPWATCH-CONVERT
                   MOVE CLOCK-EXTENDED-FORMAT TO PP98-114

                   IF DSGTCBNM(SUB1) = 'QR' THEN
                       MOVE DSGACT(SUB1) TO STCK-WORK-A
                       MOVE DSGTDT(SUB1) TO STCK-WORK-B
                       IF STCK-WORK-NUM-B > 0 THEN
                           COMPUTE PERCENTAGE-WORK =
                               (STCK-WORK-NUM-A / STCK-WORK-NUM-B)
                               ON SIZE ERROR CONTINUE
                           END-COMPUTE
                           COMPUTE PERCENTAGE = (PERCENTAGE-WORK * 100)
                               ON SIZE ERROR CONTINUE
                           END-COMPUTE
                       ELSE
                           MOVE 0         TO PERCENTAGE
                       END-IF
                       MOVE PERCENTAGE    TO PP120-124
                       MOVE '%'           TO PP125
                   END-IF

                   PERFORM WRITE-OUTPUT

                   ADD 1 TO SUB1
           END-PERFORM.

           MOVE '+'     TO PRINT-CONTROL.
           MOVE ALL '_' TO PP3-37
                           PP38-72
                           PP73-102.
           MOVE '__________________________    '      TO PP103-132.
           PERFORM WRITE-OUTPUT.
           MOVE 'Totals'     TO PP3-8.

           MOVE CURRENT-TCBS-ATTACHED TO PP10-16.

           MOVE DSGACT-TOTAL          TO CLOCK-FIELD.
           PERFORM STOPWATCH-CONVERT.
           MOVE CLOCK-EXTENDED-FORMAT TO PP79-95.

           MOVE DSGTCT-TOTAL          TO CLOCK-FIELD.
           PERFORM STOPWATCH-CONVERT.
           MOVE CLOCK-EXTENDED-FORMAT TO PP98-114.
           PERFORM WRITE-OUTPUT.

      *****************************************************************
      ***   Print headings for the Dispatcher TCB Mode statistics.  ***
      *****************************************************************
           PERFORM PAGE-HEADINGS.

           MOVE '0'     TO PRINT-CONTROL.
           MOVE 'Dispatcher TCB Modes' TO PP1-20.
           PERFORM WRITE-OUTPUT.
           MOVE '+'     TO PRINT-CONTROL.
           MOVE ALL '_' TO PP1-20.
           PERFORM WRITE-OUTPUT.

      *****************************************************************
      ***  Print the Dispatch TCB Mode Statistics - Pass 1.         ***
      *****************************************************************
           PERFORM TCB-SUB-HEADINGS-1.

           MOVE 1 TO SUB1.
           PERFORM WITH TEST BEFORE
               UNTIL SUB1 > DSGASIZE
                   MOVE DSGTCBNM(SUB1)  TO PP5-6
                   EVALUATE TRUE
                       WHEN DSG-TCB-MODE-UNKNOWN(SUB1)
                            MOVE 'Unk' TO PP11-13
                       WHEN DSG-TCB-MODE-NOT-OPEN(SUB1)
                            MOVE 'No ' TO PP11-13
                       WHEN DSG-TCB-MODE-OPEN(SUB1)
                            MOVE 'Yes' TO PP11-13
                       WHEN OTHER
                           CONTINUE
                   END-EVALUATE
                   EVALUATE TRUE
                       WHEN DSG-TCB-POOL-NOT-APPLIC(SUB1)
                           MOVE 'N/A '         TO PP16-19
                       WHEN DSG-TCB-POOL-OPEN-TCBS(SUB1)
                           MOVE 'OPEN'         TO PP16-19
                       WHEN DSG-TCB-POOL-XP-TCBS(SUB1)
                           MOVE 'XP  '         TO PP16-19
                       WHEN DSG-TCB-POOL-SSL-TCBS(SUB1)
                           MOVE 'SSL '         TO PP16-19
                       WHEN DSG-TCB-POOL-THRD-TCBS(SUB1)
                           MOVE 'THRD'         TO PP16-19
                       WHEN OTHER
                           CONTINUE
                   END-EVALUATE

                   MOVE DSGTCBCA(SUB1)  TO PP22-28
                   MOVE DSGTCBPA(SUB1)  TO PP31-37
                   MOVE DSGTCBCU(SUB1)  TO PP40-46
                   MOVE DSGTCBPU(SUB1)  TO PP49-55
                   EVALUATE TRUE
                       WHEN DSG-TCB-MODE-OPEN(SUB1)
                           MOVE DSGTCBAL(SUB1)  TO PP58-67N
                       WHEN OTHER
                           MOVE 'N/A' TO PP65-67
                   END-EVALUATE

                   ADD DSGTCBAL(SUB1) TO TCB-ALLOCATES

                   IF SUB1 < FIRST-MULTI-TCB-MODE THEN
                     MOVE DSGTMCDQ(SUB1)  TO PP70-79
                     MOVE DSGTMPDQ(SUB1)  TO PP82-91
                     COMPUTE AVERAGE = DSGTMADQ(SUB1) / 100
                     MOVE AVERAGE         TO PP94-103X
                   END-IF

                   PERFORM WRITE-OUTPUT

                   ADD 1 TO SUB1
           END-PERFORM.

           MOVE '+'     TO PRINT-CONTROL.
           MOVE ALL '_' TO PP3-37.
           MOVE '___________________________________' TO PP38-72.
           MOVE '______________________________'      TO PP73-102.
           MOVE '_                             '      TO PP103-132.
           PERFORM WRITE-OUTPUT.
           MOVE 'Totals' TO PP3-8.
           MOVE CURRENT-TCBS-ATTACHED TO PP22-28.
           MOVE CURRENT-TCBS-IN-USE   TO PP40-46.
           MOVE TCB-ALLOCATES         TO PP58-67N.
           PERFORM WRITE-OUTPUT.

      *****************************************************************
      ***   Print headings for the Dispatcher TCB Mode statistics.  ***
      *****************************************************************
           PERFORM PAGE-HEADINGS.

           MOVE '0'     TO PRINT-CONTROL.
           MOVE 'Dispatcher TCB Modes' TO PP1-20.
           PERFORM WRITE-OUTPUT.
           MOVE '+'     TO PRINT-CONTROL.
           MOVE ALL '_' TO PP1-20.
           PERFORM WRITE-OUTPUT.

      *****************************************************************
      ***  Print the Dispatch TCB Mode Statistics - Pass 2.         ***
      *****************************************************************
           PERFORM TCB-SUB-HEADINGS-2.

           MOVE 1 TO SUB1.
           PERFORM WITH TEST BEFORE
               UNTIL SUB1 > DSGASIZE
                   MOVE DSGTCBNM(SUB1)  TO PP5-6
                   EVALUATE TRUE
                       WHEN DSG-TCB-MODE-UNKNOWN(SUB1)
                            MOVE 'Unk' TO PP11-13
                       WHEN DSG-TCB-MODE-NOT-OPEN(SUB1)
                            MOVE 'No ' TO PP11-13
                       WHEN DSG-TCB-MODE-OPEN(SUB1)
                            MOVE 'Yes' TO PP11-13
                       WHEN OTHER
                           CONTINUE
                   END-EVALUATE
                   EVALUATE TRUE
                       WHEN DSG-TCB-POOL-NOT-APPLIC(SUB1)
                           MOVE 'N/A '         TO PP16-19
                       WHEN DSG-TCB-POOL-OPEN-TCBS(SUB1)
                           MOVE 'OPEN'         TO PP16-19
                       WHEN DSG-TCB-POOL-XP-TCBS(SUB1)
                           MOVE 'XP  '         TO PP16-19
                       WHEN DSG-TCB-POOL-SSL-TCBS(SUB1)
                           MOVE 'SSL '         TO PP16-19
                       WHEN DSG-TCB-POOL-THRD-TCBS(SUB1)
                           MOVE 'THRD'         TO PP16-19
                       WHEN OTHER
                           CONTINUE
                   END-EVALUATE

                   MOVE DSGNTCBA(SUB1)  TO PP22-31
                   MOVE DSGTCBAF(SUB1)  TO PP34-43
                   EVALUATE TRUE
                       WHEN DSG-TCB-MODE-OPEN(SUB1)
                           MOVE DSGTCBDU(SUB1)  TO PP46-55
                           MOVE DSGTCBDS(SUB1)  TO PP58-67N
                           MOVE DSGTCBDX(SUB1)  TO PP70-79
                           MOVE DSGTCBDO(SUB1)  TO PP82-91
                           MOVE DSGTCBST(SUB1)  TO PP94-103
                           MOVE DSGTCBMM(SUB1)  TO PP106-115
                       WHEN DSG-TCB-MODE-NOT-OPEN(SUB1)
                           IF SUB1 NOT < FIRST-MULTI-TCB-MODE THEN
                               MOVE DSGTCBDO(SUB1)  TO PP82-91
                           ELSE
                               MOVE 'N/A' TO PP89-91
                           END-IF
                           MOVE 'N/A' TO PP53-55
                           MOVE 'N/A' TO PP65-67
                           MOVE 'N/A' TO PP77-79
                           MOVE 'N/A' TO PP101-103
                           MOVE 'N/A' TO PP113-115
                       WHEN OTHER
                           MOVE 'N/A' TO PP53-55
                           MOVE 'N/A' TO PP65-67
                           MOVE 'N/A' TO PP77-79
                           MOVE 'N/A' TO PP89-91
                           MOVE 'N/A' TO PP101-103
                           MOVE 'N/A' TO PP113-115
                   END-EVALUATE

                   ADD DSGNTCBA(SUB1) TO TCBS-ATTACHED
                   ADD DSGTCBAF(SUB1) TO TCB-ATTACH-FAILURES
                   ADD DSGTCBDU(SUB1) TO TCBS-DETACHED-UNCLEAN
                   ADD DSGTCBDS(SUB1) TO TCBS-DETACHED-STOLEN
                   ADD DSGTCBDX(SUB1) TO TCBS-DETACHED-EXCESS
                   ADD DSGTCBDO(SUB1) TO TCBS-DETACHED-OTHER
                   ADD DSGTCBST(SUB1) TO TCB-STEALS
                   ADD DSGTCBMM(SUB1) TO TCB-MISMATCHES

                   PERFORM WRITE-OUTPUT

                   ADD 1 TO SUB1
           END-PERFORM.

           MOVE '+'     TO PRINT-CONTROL.
           MOVE ALL '_' TO PP3-37
                           PP38-72
                           PP73-102.
           MOVE '_____________                 '      TO PP103-132.
           PERFORM WRITE-OUTPUT.
           MOVE 'Totals' TO PP3-8.
           MOVE TCBS-ATTACHED         TO PP22-31.
           MOVE TCB-ATTACH-FAILURES   TO PP34-43.
           MOVE TCBS-DETACHED-UNCLEAN TO PP46-55.
           MOVE TCBS-DETACHED-STOLEN  TO PP58-67N.
           MOVE TCBS-DETACHED-EXCESS  TO PP70-79.
           MOVE TCBS-DETACHED-OTHER   TO PP82-91.
           MOVE TCB-STEALS            TO PP94-103.
           MOVE TCB-MISMATCHES        TO PP106-115.
           PERFORM WRITE-OUTPUT.

      *****************************************************************
      ***   Print headings for the Dispatcher TCB Pool statistics.  ***
      *****************************************************************
           PERFORM PAGE-HEADINGS.
           MOVE PAGENO TO DISPATCHER-TCB-POOLS-PAGENO.

           MOVE '-'     TO PRINT-CONTROL.
           MOVE 'Dispatcher TCB Pools' TO PP1-20.
           PERFORM WRITE-OUTPUT.
           MOVE '+'     TO PRINT-CONTROL.
           MOVE ALL '_' TO PP1-20.
           PERFORM WRITE-OUTPUT.

      *****************************************************************
      ***  Print the Dispatch TCB Pool Statistics.                  ***
      *****************************************************************

           MOVE 1 TO SUB1.
           PERFORM WITH TEST BEFORE
               UNTIL SUB1 > DSGPSIZE

      *
                   IF SUB1 > 1 THEN
                       PERFORM PAGE-HEADINGS
                   END-IF

                   MOVE '0' TO PRINT-CONTROL
                   MOVE 'TCB Pool . . . . . . . . . . . . . . . . . :'
                                               TO PP3-46
                   EVALUATE DSGTCBPN(SUB1)
                       WHEN 1
                           MOVE 'OPEN'         TO PP59-62
                       WHEN 2
                           MOVE '  XP'         TO PP59-62
                       WHEN 3
                           MOVE ' SSL'         TO PP59-62
                       WHEN 4
                           MOVE 'THRD'         TO PP59-62
                       WHEN OTHER
                           MOVE '????'         TO PP59-62
                   END-EVALUATE
                   PERFORM WRITE-OUTPUT

                   MOVE '0' TO PRINT-CONTROL
                   MOVE 'Current TCBs attached in this TCB Pool . . :'
                                               TO PP3-46
                   MOVE DSGCNUAT(SUB1)         TO PP53-62
                   MOVE 'Current TCBs in use in this TCB Pool . . . . .
      -    ':'                                 TO PP69-116
                   MOVE DSGCNUUS(SUB1)         TO PP123-132N
                   PERFORM WRITE-OUTPUT
                   MOVE 'Peak TCBs attached in this TCB Pool. . . . :'
                                               TO PP3-46
                   MOVE DSGPNUAT(SUB1)         TO PP53-62
                   MOVE 'Peak TCBs in use in this TCB Pool. . . . . . .
      -    ':'                                 TO PP69-116
                   MOVE DSGPNUUS(SUB1)         TO PP123-132N
                   PERFORM WRITE-OUTPUT

                   MOVE '0' TO PRINT-CONTROL
                   MOVE 'Max TCB Pool Limit ( . . . . . . . . . . . :'
                                               TO PP3-46
                   MOVE 'Times at Max TCB Pool Limit (. . . . . . . . .
      -    ':'                                 TO PP69-116
                   EVALUATE SUB1
                       WHEN 1
                           MOVE 'MAXOPENTCBS)' TO PP23-34
                           MOVE 'MAXOPENTCBS)' TO PP98-109
                       WHEN 2
                           MOVE 'MAXXPTCBS)'   TO PP23-32
                           MOVE 'MAXXPTCBS)'   TO PP98-107
                       WHEN 3
                           MOVE 'MAXSSLTCBS)'  TO PP23-33
                           MOVE 'MAXSSLTCBS)'  TO PP98-108
                       WHEN 4
                           MOVE 'MAXTHRDTCBS)' TO PP23-34
                           MOVE 'MAXTHRDTCBS)' TO PP98-109
                       WHEN OTHER
                           MOVE '???????????)' TO PP23-34
                           MOVE '???????????)' TO PP98-109
                   END-EVALUATE
                   MOVE DSGMXTCB(SUB1)         TO PP53-62
                   MOVE DSGNTCBL(SUB1)         TO PP120-132
                   PERFORM WRITE-OUTPUT

                   MOVE 'Time Pool Limit last reached . . . . . . . :'
                                               TO PP3-46
                   IF DSGLTCBL(SUB1) NOT = LOW-VALUES THEN
                     MOVE DSGLTCBL(SUB1)       TO CLOCK-FIELD
                     PERFORM TIMESTAMP-CONVERT
                     MOVE STOPWATCH            TO PP49-62
                   ELSE
                     MOVE NULL-TIME-FIELD TO PP49-62
                   END-IF
                   PERFORM WRITE-OUTPUT

                   MOVE '0' TO PRINT-CONTROL
                   MOVE 'Requests Delayed by Max TCB Pool Limit . . :'
                                               TO PP3-46
                   MOVE DSGTOTNW(SUB1)         TO PP50-62
                   MOVE 'Current Requests Delayed by Max TCB Pool Limit
      -    ':'                                 TO PP69-116
                   MOVE DSGCURNW(SUB1)         TO PP123-132N
                   PERFORM WRITE-OUTPUT

                   MOVE 'Total Max TCB Pool Limit delay time. . . . :'
                                               TO PP3-46
                   MOVE DSGTOTWL(SUB1)         TO CLOCK-FIELD
                   PERFORM STOPWATCH-CONVERT
                   MOVE STOPWATCH              TO PP49-62
                   MOVE 'Peak Requests Delayed by Max TCB Pool Limit. .
      -    ':'                                 TO PP69-116
                   MOVE DSGPEANW(SUB1)         TO PP123-132N
                   PERFORM WRITE-OUTPUT

                   MOVE 'Average Max TCB Pool Limit delay time. . . :'
                                               TO PP3-46
                   IF DSGTOTNW(SUB1) > 0 THEN
                       MOVE DSGTOTWL(SUB1)     TO CLOCK-WORK-FIELD
                       COMPUTE CLOCK-FIELD-S =
                              (CLOCK-WORK-FIELD-S / DSGTOTNW(SUB1))
                   ELSE
                       MOVE 0 TO CLOCK-FIELD-S
                   END-IF
                   PERFORM STOPWATCH-CONVERT
                   MOVE STOPWATCH              TO PP49-62
                   MOVE 'Total Delay time for current delayed . . . . .
      -    ':'                                 TO PP69-116
                   MOVE DSGCURWT(SUB1)         TO CLOCK-FIELD
                   PERFORM STOPWATCH-CONVERT
                   MOVE STOPWATCH              TO PP119-132
                   PERFORM WRITE-OUTPUT

                   MOVE 'Average Delay time for current delayed . . . .
      -    ':'                                 TO PP69-116
                   IF DSGCURNW(SUB1) > 0 THEN
                       MOVE DSGCURWT(SUB1) TO CLOCK-WORK-FIELD
                       COMPUTE CLOCK-FIELD-S =
                               (CLOCK-WORK-FIELD-S / DSGCURNW(SUB1))
                   ELSE
                       MOVE 0 TO CLOCK-FIELD-S
                   END-IF
                   PERFORM STOPWATCH-CONVERT
                   MOVE STOPWATCH              TO PP119-132
                   PERFORM WRITE-OUTPUT

                   MOVE 'Total number of TCB Mismatch Waits . . . . :'
                                               TO PP3-46
                   MOVE DSGMMWTS(SUB1)         TO PP53-62
                   MOVE 'Current TCB Mismatch waits . . . . . . . . . .
      -    ':'                                 TO PP69-116
                   MOVE DSGCMMWS(SUB1)         TO PP123-132N
                   PERFORM WRITE-OUTPUT

                   MOVE 'Total TCB Mismatch wait time . . . . . . . :'
                                               TO PP3-46
                   MOVE DSGMMWTM(SUB1)         TO CLOCK-FIELD
                   PERFORM STOPWATCH-CONVERT
                   MOVE STOPWATCH              TO PP49-62
                   MOVE 'Peak TCB Mismatch waits. . . . . . . . . . . .
      -    ':'                                 TO PP69-116
                   MOVE DSGPMMWS(SUB1)         TO PP123-132N
                   PERFORM WRITE-OUTPUT

                   MOVE 'Average TCB Mismatch wait time . . . . . . :'
                                               TO PP3-46
                   IF DSGMMWTS(SUB1) > 0 THEN
                       MOVE DSGMMWTM(SUB1) TO CLOCK-WORK-FIELD
                       COMPUTE CLOCK-FIELD-S =
                               (CLOCK-WORK-FIELD-S / DSGMMWTS(SUB1))
                   ELSE
                       MOVE 0 TO CLOCK-FIELD-S
                   END-IF
                   PERFORM STOPWATCH-CONVERT
                   MOVE STOPWATCH              TO PP49-62
                   MOVE 'Total Wait time for current Mismatch Waits . .
      -    ':'                                 TO PP69-116
                   MOVE DSGCMMWT(SUB1)         TO CLOCK-FIELD
                   PERFORM STOPWATCH-CONVERT
                   MOVE STOPWATCH              TO PP119-132
                   PERFORM WRITE-OUTPUT

                   MOVE 'Average Wait time for current Mismatch Waits .
      -    ':'                                 TO PP69-116
                   IF DSGCMMWS(SUB1) > 0 THEN
                       MOVE DSGCMMWT(SUB1) TO CLOCK-WORK-FIELD
                       COMPUTE CLOCK-FIELD-S =
                               (CLOCK-WORK-FIELD-S / DSGCMMWS(SUB1))
                   ELSE
                       MOVE 0 TO CLOCK-FIELD-S
                   END-IF
                   PERFORM STOPWATCH-CONVERT
                   MOVE STOPWATCH              TO PP119-132
                   PERFORM WRITE-OUTPUT

                   MOVE 'Requests Delayed by MVS storage constraint :'
                                               TO PP3-46
                   MOVE DSGTOTMW(SUB1)         TO PP53-62
                   PERFORM WRITE-OUTPUT
                   MOVE 'Total MVS storage constraint delay time. . :'
                                               TO PP3-46
                   MOVE DSGTOTMT(SUB1)         TO CLOCK-FIELD
                   PERFORM STOPWATCH-CONVERT
                   MOVE STOPWATCH              TO PP49-62
                   PERFORM WRITE-OUTPUT
                   MOVE 'Average MVS storage constraint delay time. :'
                                               TO PP3-46
                   IF DSGTOTMW(SUB1) > 0 THEN
                       MOVE DSGTOTMT(SUB1) TO CLOCK-WORK-FIELD
                       COMPUTE CLOCK-FIELD-S =
                               (CLOCK-WORK-FIELD-S / DSGTOTMW(SUB1))
                   ELSE
                       MOVE 0 TO CLOCK-FIELD-S
                   END-IF
                   PERFORM STOPWATCH-CONVERT
                   MOVE STOPWATCH              TO PP49-62
                   PERFORM WRITE-OUTPUT

      *****************************************************************
      ***          Print the TCB Modes in this TCB Pool             ***
      *****************************************************************
                   PERFORM PRINT-TCB-POOL-MODES

                   MOVE '0' TO PRINT-CONTROL
                   MOVE ALL '-' TO PP1-132
                   PERFORM WRITE-OUTPUT

                   ADD 1 TO SUB1
           END-PERFORM.

       DISPATCHER-STATISTICS-EXIT.
           EXIT.
           EJECT
      *****************************************************************
      ***  Print the TCB Mode statistics for a TCB Pool.            ***
      *****************************************************************
       PRINT-TCB-POOL-MODES SECTION.

           PERFORM TCB-MODE-SUB-HEADINGS.

           MOVE 0 TO CURRENT-TCBS-ATTACHED CURRENT-TCBS-IN-USE
                     TCBS-ATTACHED TCB-ATTACH-FAILURES
                     TCBS-DETACHED-UNCLEAN TCBS-DETACHED-STOLEN
                     TCBS-DETACHED-EXCESS  TCBS-DETACHED-OTHER
                     TCB-STEALS            TCB-MISMATCHES.

           MOVE 0 TO TCB-MODES-IN-THIS-POOL.
           MOVE 1 TO SUB2.

           PERFORM WITH TEST BEFORE
               UNTIL SUB2 > DSGASIZE

      *****************************************************************
      *** If this TCB Pool number matches the TCB Modes Pool Number ***
      *****************************************************************
                   IF DSGTCBPN(SUB1) = DSGTCBMP(SUB2) THEN

                       ADD 1 TO TCB-MODES-IN-THIS-POOL

                       MOVE DSGTCBNM(SUB2)  TO PP5-6
                       MOVE DSGTCBCA(SUB2)  TO PP10-16
                       MOVE DSGTCBPA(SUB2)  TO PP19-25
                       MOVE DSGTCBCU(SUB2)  TO PP28-34
                       MOVE DSGTCBPU(SUB2)  TO PP37-43
                       MOVE DSGNTCBA(SUB2)  TO PP46-55
                       EVALUATE TRUE
                           WHEN DSG-TCB-MODE-NOT-OPEN(SUB2)
                               MOVE 'N/A' TO PP65-67
                               MOVE 'N/A' TO PP77-79
                               MOVE 'N/A' TO PP89-91
                               MOVE 'N/A' TO PP101-103
                               MOVE 'N/A' TO PP113-115
                               MOVE 'N/A' TO PP125-127
                           WHEN OTHER
                               MOVE DSGTCBDU(SUB2)  TO PP58-67N
                               MOVE DSGTCBDS(SUB2)  TO PP70-79
                               MOVE DSGTCBDX(SUB2)  TO PP82-91
                               MOVE DSGTCBDO(SUB2)  TO PP94-103
                               MOVE DSGTCBST(SUB2)  TO PP106-115
                               MOVE DSGTCBMM(SUB2)  TO PP118-127
                       END-EVALUATE

                       ADD DSGTCBCA(SUB2) TO CURRENT-TCBS-ATTACHED
                       ADD DSGTCBCU(SUB2) TO CURRENT-TCBS-IN-USE
                       ADD DSGNTCBA(SUB2) TO TCBS-ATTACHED
                       ADD DSGTCBAF(SUB2) TO TCB-ATTACH-FAILURES
                       ADD DSGTCBDU(SUB2) TO TCBS-DETACHED-UNCLEAN
                       ADD DSGTCBDS(SUB2) TO TCBS-DETACHED-STOLEN
                       ADD DSGTCBDX(SUB2) TO TCBS-DETACHED-EXCESS
                       ADD DSGTCBDO(SUB2) TO TCBS-DETACHED-OTHER
                       ADD DSGTCBST(SUB2) TO TCB-STEALS
                       ADD DSGTCBMM(SUB2) TO TCB-MISMATCHES

                       PERFORM WRITE-OUTPUT
                   END-IF

                   ADD 1 TO SUB2
           END-PERFORM.

      *****************************************************************
      ***  If there are TCB Modes in this TCB Pool, print the TCB   ***
      ***  Mode totals otherwise print a message saying that there  ***
      ***  are no TCB Modes currently active in this TCB Pool.      ***
      *****************************************************************
           IF TCB-MODES-IN-THIS-POOL > 0 THEN
               MOVE '+'     TO PRINT-CONTROL
               MOVE ALL '_' TO PP3-37
                               PP38-72
                               PP73-102
               MOVE '_________________________     '      TO PP103-132
               PERFORM WRITE-OUTPUT
               MOVE 'TOTALS'              TO PP3-8
               MOVE CURRENT-TCBS-ATTACHED TO PP10-16
               MOVE CURRENT-TCBS-IN-USE   TO PP28-34
               MOVE TCBS-ATTACHED         TO PP46-55
               MOVE TCBS-DETACHED-UNCLEAN TO PP58-67N
               MOVE TCBS-DETACHED-STOLEN  TO PP70-79
               MOVE TCBS-DETACHED-EXCESS  TO PP82-91
               MOVE TCBS-DETACHED-OTHER   TO PP94-103
               MOVE TCB-STEALS            TO PP106-115
               MOVE TCB-MISMATCHES        TO PP118-127
               PERFORM WRITE-OUTPUT
           ELSE
               MOVE '0' TO PRINT-CONTROL
               MOVE 'There are no TCB Modes currently active in this TCB
      -    ' Pool' TO PP3-58
               PERFORM WRITE-OUTPUT
           END-IF.

       PRINT-TCB-POOL-MODES-EXIT.
           EXIT.
           EJECT
       TCB-SUB-HEADINGS-1 SECTION.

           MOVE '0' TO PRINT-CONTROL.
           PERFORM WRITE-OUTPUT.

           MOVE ' TCB         TCB    TCBs Attached  ' TO PP3-37.
           MOVE '  < TCBs In Use ->      TCB        ' TO PP38-72.
           MOVE '<---- Dispatchable Queue ----'       TO PP73-102.
           MOVE '>                            '       TO PP103-132.
           PERFORM WRITE-OUTPUT.
           MOVE ' Mode  Open  Pool  Current    Peak ' TO PP3-37.
           MOVE '  Current    Peak    Allocates     ' TO PP38-72.
           MOVE 'Current        Peak     Averag'      TO PP73-102.
           MOVE 'e                             '      TO PP103-132.
           PERFORM WRITE-OUTPUT.
           MOVE '+'     TO PRINT-CONTROL.
           MOVE ALL '_' TO PP3-37.
           MOVE '___________________________________' TO PP38-72.
           MOVE '______________________________'      TO PP73-102.
           MOVE '_                             '      TO PP103-132.
           PERFORM WRITE-OUTPUT.

           MOVE '0'     TO PRINT-CONTROL.
           MOVE 'N'     TO SUB-HEADINGS.

       TCB-SUB-HEADINGS-1-EXIT.
           EXIT.
           EJECT
       TCB-SUB-HEADINGS-2 SECTION.

           MOVE '0' TO PRINT-CONTROL.
           PERFORM WRITE-OUTPUT.

           MOVE ' TCB         TCB       TCB       At' TO PP3-37.
           MOVE 'tach    <--------------- TCBs Detac' TO PP38-72.
           MOVE 'hed -------------->           '      TO PP73-102.
           MOVE '      TCB                     '      TO PP103-132.
           PERFORM WRITE-OUTPUT.
           MOVE ' Mode  Open  Pool   Attaches    Fai' TO PP3-37.
           MOVE 'lures   | Unclean     Stolen      E' TO PP38-72.
           MOVE 'xcess       Other |  TCB Steal'      TO PP73-102.
           MOVE 's  Mismatches                 '      TO PP103-132.
           PERFORM WRITE-OUTPUT.
           MOVE '+'     TO PRINT-CONTROL.
           MOVE ALL '_' TO PP3-37
                           PP38-72
                           PP73-102.
           MOVE '_____________                 '      TO PP103-132.
           PERFORM WRITE-OUTPUT.

           MOVE '0'     TO PRINT-CONTROL.
           MOVE 'N'     TO SUB-HEADINGS.

       TCB-SUB-HEADINGS-2-EXIT.
           EXIT.
           EJECT
       TCB-SUB-HEADINGS-3 SECTION.

           MOVE '0' TO PRINT-CONTROL.
           PERFORM WRITE-OUTPUT.
           MOVE ' TCB    TCBs Attached    Op. System' TO PP3-37.
           MOVE '       Op. System        Total TCB ' TO PP38-72.
           MOVE '          Total TCB           '      TO PP73-102.
           MOVE ' DS TCB       TCB CPU/Disp    '      TO PP103-132.
           PERFORM WRITE-OUTPUT.
           MOVE ' Mode  Current    Peak     Waits   ' TO PP3-37.
           MOVE '        Wait Time       Dispatch Ti' TO PP38-72.
           MOVE 'me         CPU Time           '      TO PP73-102.
           MOVE 'CPU Time          Ratio       '      TO PP103-132.
           PERFORM WRITE-OUTPUT.
           MOVE '+'     TO PRINT-CONTROL.
           MOVE ALL '_' TO PP3-37
                           PP38-72
                           PP73-102.
           MOVE '__________________________    '      TO PP103-132.
           PERFORM WRITE-OUTPUT.

           MOVE '0'     TO PRINT-CONTROL.
           MOVE 'N'     TO SUB-HEADINGS.

       TCB-SUB-HEADINGS-3-EXIT.
           EXIT.
           EJECT
       TCB-MODE-SUB-HEADINGS SECTION.

           MOVE '0' TO PRINT-CONTROL.
           PERFORM WRITE-OUTPUT.

           MOVE ' TCB    TCBs Attached    < TCBs In ' TO PP3-37.
           MOVE 'Use ->      TCB     <--------------' TO PP38-72.
           MOVE '- TCBs Detached --------------'      TO PP73-102.
           MOVE '>                 TCB         '      TO PP103-132.
           PERFORM WRITE-OUTPUT.
           MOVE ' Mode  Current    Peak   Current   ' TO PP3-37.
           MOVE ' Peak    Attaches   | Unclean     S' TO PP38-72.
           MOVE 'tolen      Excess       Other '      TO PP73-102.
           MOVE '|  TCB Steals  Mismatches     '      TO PP103-132.
           PERFORM WRITE-OUTPUT.
           MOVE '+'     TO PRINT-CONTROL.
           MOVE ALL '_' TO PP3-37
                           PP38-72
                           PP73-102.
           MOVE '_________________________     '      TO PP103-132.
           PERFORM WRITE-OUTPUT.

           MOVE '0'     TO PRINT-CONTROL.
           MOVE 'N'     TO SUB-HEADINGS.

       TCB-MODE-SUB-HEADINGS-EXIT.
           EXIT.
           EJECT
      *****************************************************************
      *** MVS-TCB-STATISTICS SECTION                                ***
      ***   Get Dispatcher MVS TCB Global and Resource statistics   ***
      ***   Print heading and dispatcher statistics                 ***
      *****************************************************************
       MVS-TCB-STATISTICS SECTION.

           PERFORM PAGE-HEADINGS.
           MOVE PAGENO TO DISPATCHER-MVS-TCB-PAGENO.

      *****************************************************************
      ***   Print the headings for the Dispatcher statistics.       ***
      *****************************************************************
           MOVE '-'                     TO PRINT-CONTROL.
           MOVE 'Dispatcher - MVS TCBs' TO PP1-21.
           PERFORM WRITE-OUTPUT.
           MOVE '+'     TO PRINT-CONTROL.
           MOVE ALL '_' TO PP1-21.
           PERFORM WRITE-OUTPUT.

      *****************************************************************
      *** Get dispatcher statistics                                 ***
      *****************************************************************
           EXEC CICS EXTRACT STATISTICS DISPATCHER
               SET(ADDRESS OF DFHDSGDS)
           END-EXEC.

           MOVE '0' TO PRINT-CONTROL.
           MOVE 'Dispatcher Start Time and Date . . . . . . :'
                          TO PP3-46.
           MOVE DSGLSTRT  TO CLOCK-FIELD.
           PERFORM TIMESTAMP-CONVERT.
           MOVE STOPWATCH TO PP51-65.
           MOVE MMDDYYYY  TO PP68-77.
           PERFORM WRITE-OUTPUT.

           MOVE '0' TO PRINT-CONTROL.
           MOVE 'Address Space Accumulated CPU Time . . . . :'
                              TO PP3-46.
           MOVE ADSP-CPU-TIME TO CLOCK-FIELD.
           PERFORM STOPWATCH-CONVERT.
           MOVE CLOCK-EXTENDED-FORMAT TO PP49-65.
           MOVE '(Not Reset)'         TO PP68-78.
           PERFORM WRITE-OUTPUT.
           MOVE 'Address Space Accumulated SRB Time . . . . :'
                              TO PP3-46.
           MOVE ADSP-SRB-TIME TO CLOCK-FIELD.
           PERFORM STOPWATCH-CONVERT.
           MOVE CLOCK-EXTENDED-FORMAT TO PP49-65.
           MOVE '(Not Reset)'         TO PP68-78.
           PERFORM WRITE-OUTPUT.

           MOVE '0' TO PRINT-CONTROL.
           MOVE 'Address Space CPU Time (Since Reset) . . . :'
                              TO PP3-46.
           MOVE DSGEJST       TO CLOCK-FIELD.
           PERFORM STOPWATCH-CONVERT.
           MOVE CLOCK-EXTENDED-FORMAT TO PP49-65.
           PERFORM WRITE-OUTPUT.
           MOVE 'Address Space SRB Time (Since Reset) . . . :'
                              TO PP3-46.
           MOVE DSGSRBT       TO CLOCK-FIELD.
           PERFORM STOPWATCH-CONVERT.
           MOVE CLOCK-EXTENDED-FORMAT TO PP49-65.
           PERFORM WRITE-OUTPUT.

      *****************************************************************
      *** Get Dispatcher Global TCB statistics                      ***
      *****************************************************************
           EXEC CICS EXTRACT STATISTICS MVSTCB
               SET(ADDRESS OF DFHDSTDS)
           END-EXEC.

      *****************************************************************
      ***   Print the Dispatcher Global TCB statistics              ***
      *****************************************************************

           MOVE '0' TO PRINT-CONTROL.
           PERFORM WRITE-OUTPUT.
           MOVE '0' TO PRINT-CONTROL.
           MOVE 'Current number of CICS TCBs . . . . . . . . . . . . :'
                                      TO PP3-55.
           MOVE DSTDS-CICSTCB-COUNT   TO PP62-71.
           PERFORM WRITE-OUTPUT.
           MOVE 'Current CICS TCB CPU time . . . . . . . . . . . . . :'
                                      TO PP3-55.
           MOVE DSTDS-CICSTCB-CPUTIME TO CLOCK-FIELD.
           PERFORM STOPWATCH-CONVERT.
           MOVE STOPWATCH             TO PP58-71.
           PERFORM WRITE-OUTPUT.

           MOVE 'Current CICS TCB Private Stg below 16MB . . . . . . :'
                                      TO PP3-55.
           COMPUTE RESULT = (DSTDS-CICSTCB-STG-BELOW / 1024).
           MOVE RESULT                TO PP62-71.
           MOVE 'K'                   TO PP72.
           PERFORM WRITE-OUTPUT.
           MOVE 'Current CICS TCB Private Stg below 16MB in use  . . :'
                                      TO PP3-55.
           COMPUTE RESULT = (DSTDS-CICSTCB-STG-BELOW-IU / 1024).
           MOVE RESULT                TO PP62-71.
           MOVE 'K'                   TO PP72.
           PERFORM WRITE-OUTPUT.

           MOVE 'Current CICS TCB Private Stg above 16MB . . . . . . :'
                                      TO PP3-55.
           COMPUTE RESULT = (DSTDS-CICSTCB-STG-ABOVE / 1024).
           MOVE RESULT                TO PP62-71.
           MOVE 'K'                   TO PP72.
           PERFORM WRITE-OUTPUT.
           MOVE 'Current CICS TCB Private Stg above 16MB in use  . . :'
                                      TO PP3-55.
           COMPUTE RESULT = (DSTDS-CICSTCB-STG-ABOVE-IU / 1024).
           MOVE RESULT                TO PP62-71.
           MOVE 'K'                   TO PP72.
           PERFORM WRITE-OUTPUT.


           MOVE '0' TO PRINT-CONTROL.
           MOVE 'Current number of non-CICS TCBs . . . . . . . . . . :'
                                         TO PP3-55.
           MOVE DSTDS-NONCICSTCB-COUNT   TO PP62-71.
           PERFORM WRITE-OUTPUT.
           MOVE 'Current non-CICS TCB CPU time . . . . . . . . . . . :'
                                         TO PP3-55.
           MOVE DSTDS-NONCICSTCB-CPUTIME TO CLOCK-FIELD.
           PERFORM STOPWATCH-CONVERT.
           MOVE STOPWATCH                TO PP58-71.
           PERFORM WRITE-OUTPUT.

           MOVE 'Current non-CICS TCB Private Stg below 16MB . . . . :'
                                      TO PP3-55.
           COMPUTE RESULT = (DSTDS-NONCICSTCB-STG-BELOW / 1024).
           MOVE RESULT                TO PP62-71.
           MOVE 'K'                   TO PP72.
           PERFORM WRITE-OUTPUT.
           MOVE 'Current non-CICS TCB Private Stg below 16MB in use  :'
                                      TO PP3-55.
           COMPUTE RESULT = (DSTDS-NONCICSTCB-STG-BELOW-IU / 1024).
           MOVE RESULT                TO PP62-71.
           MOVE 'K'                   TO PP72.
           PERFORM WRITE-OUTPUT.

           MOVE 'Current non-CICS TCB Private Stg above 16MB . . . . :'
                                      TO PP3-55.
           COMPUTE RESULT = (DSTDS-NONCICSTCB-STG-ABOVE / 1024).
           MOVE RESULT                TO PP62-71.
           MOVE 'K'                   TO PP72.
           PERFORM WRITE-OUTPUT.
           MOVE 'Current non-CICS TCB Private Stg above 16MB in use  :'
                                      TO PP3-55.
           COMPUTE RESULT = (DSTDS-NONCICSTCB-STG-ABOVE-IU / 1024).
           MOVE RESULT                TO PP62-71.
           MOVE 'K'                   TO PP72.
           PERFORM WRITE-OUTPUT.

           MOVE DSTDS-CICSTCB-CPUTIME    TO CICSTCB-CPUTIME.
           MOVE DSTDS-NONCICSTCB-CPUTIME TO NONCICSTCB-CPUTIME.

      *****************************************************************
      ***   Print the Dispatcher TCB Resource statistics            ***
      *****************************************************************
           PERFORM PAGE-HEADINGS.

           MOVE '0'     TO PRINT-CONTROL.

           EXEC CICS INQUIRE MVSTCB START
           END-EXEC.

           EXEC CICS INQUIRE MVSTCB(TCB-PTR) NEXT
               RESP(INQUIRE-RESP)
           END-EXEC.

           PERFORM WITH TEST BEFORE
               UNTIL INQUIRE-RESP = DFHRESP(END)

               IF LINE-COUNT > LINES-PER-PAGE THEN
                   PERFORM PAGE-HEADINGS
               END-IF

               IF SUB-HEADINGS = 'Y' THEN
                   PERFORM MVSTCB-SUB-HEADINGS
               END-IF

               EXEC CICS EXTRACT STATISTICS MVSTCB
                   RESID(TCB-PTR)
                   SET(ADDRESS OF DFHDSRDS)
                   RESP(COLLECT-RESP)
               END-EXEC

               EVALUATE COLLECT-RESP
                   WHEN DFHRESP(NORMAL)
                       PERFORM PRINT-MVSTCB-STATISTICS
                   WHEN OTHER
                       CONTINUE
               END-EVALUATE

               EXEC CICS INQUIRE MVSTCB(TCB-PTR) NEXT
                   RESP(INQUIRE-RESP)
               END-EXEC

           END-PERFORM.

           EXEC CICS INQUIRE MVSTCB END
           END-EXEC.

           MOVE '+' TO PRINT-CONTROL.
           MOVE ALL '_' TO PP3-37
                           PP38-72
                           PP73-102.
           MOVE '__________________________    '      TO PP103-132.
           PERFORM WRITE-OUTPUT.

           IF LINE-COUNT > (LINES-PER-PAGE - 5) THEN
               PERFORM PAGE-HEADINGS
           END-IF.

           MOVE '-' TO PRINT-CONTROL.
           MOVE 'Total number of TCBs. . . . . :' TO PP3-33.
           MOVE TCB-TOTAL                         TO PP36-45.
           PERFORM WRITE-OUTPUT.

      *****************************************************************
      ***   Print the Dispatcher TCB Resource statistics 2nd pass   ***
      *****************************************************************
           MOVE 0   TO TCB-TOTAL.

           PERFORM PAGE-HEADINGS.
           MOVE '0' TO PRINT-CONTROL.

           EXEC CICS INQUIRE MVSTCB START
           END-EXEC.

           EXEC CICS INQUIRE MVSTCB(TCB-PTR) NEXT
               RESP(INQUIRE-RESP)
           END-EXEC.

           PERFORM WITH TEST BEFORE
               UNTIL INQUIRE-RESP = DFHRESP(END)

               IF LINE-COUNT > LINES-PER-PAGE THEN
                   PERFORM PAGE-HEADINGS
               END-IF

               IF SUB-HEADINGS = 'Y' THEN
                   PERFORM MVSTCB-SUB-HEADINGS2
               END-IF

               EXEC CICS EXTRACT STATISTICS MVSTCB
                   RESID(TCB-PTR)
                   SET(ADDRESS OF DFHDSRDS)
                   RESP(COLLECT-RESP)
               END-EXEC

               EVALUATE COLLECT-RESP
                   WHEN DFHRESP(NORMAL)
                       PERFORM PRINT-MVSTCB-STATISTICS2
                   WHEN OTHER
                       CONTINUE
               END-EVALUATE

               EXEC CICS INQUIRE MVSTCB(TCB-PTR) NEXT
                   RESP(INQUIRE-RESP)
               END-EXEC

           END-PERFORM.

           EXEC CICS INQUIRE MVSTCB END
           END-EXEC.

           MOVE '+' TO PRINT-CONTROL.
           MOVE ALL '_' TO PP3-37.
           MOVE '___________________                ' TO PP38-72.
           PERFORM WRITE-OUTPUT.

           IF LINE-COUNT > (LINES-PER-PAGE - 5) THEN
               PERFORM PAGE-HEADINGS
           END-IF.

           MOVE '-' TO PRINT-CONTROL.
           MOVE 'Total number of TCBs. . . . . :' TO PP3-33.
           MOVE TCB-TOTAL                         TO PP36-45.
           PERFORM WRITE-OUTPUT.

       MVS-TCB-STATISTICS-EXIT.
           EXIT.
           EJECT
       PRINT-MVSTCB-STATISTICS SECTION.

           ADD 1 TO TCB-TOTAL.

           SET HEX-INPUT-PTR TO DSRDS-TCB-ADDRESS.
           PERFORM CONVERT-HEX-TO-CHAR.
           MOVE HEX-OUTPUT   TO PP3-10.

           MOVE DSRDS-TCB-NAME    TO PP13-20.
           EVALUATE DSRDS-TCB-TYPE
               WHEN 'C'
                   MOVE 'Yes'     TO PP23-25
                   MOVE CICSTCB-CPUTIME    TO STCK-WORK-B
               WHEN 'N'
                   MOVE 'No '     TO PP23-25
                   MOVE NONCICSTCB-CPUTIME TO STCK-WORK-B
               WHEN OTHER
                   MOVE '???'     TO PP23-25
                   MOVE 0         TO STCK-WORK-NUM-B
           END-EVALUATE.
           MOVE DSRDS-TCB-CPUTIME TO CLOCK-FIELD.
           PERFORM STOPWATCH-CONVERT.
           MOVE STOPWATCH         TO PP29-42.
           MOVE DSRDS-TCB-CPUTIME TO STCK-WORK-A
           PERFORM CALC-MVSTCB-PERCENTAGE.
           MOVE PERCENTAGE        TO PP45-49.
           MOVE '%'               TO PP50.

           COMPUTE RESULT = (DSRDS-TCB-STG-BELOW / 1024)
           END-COMPUTE.
           MOVE RESULT            TO PP53-62.
           MOVE 'K'               TO PP63.
           COMPUTE RESULT = (DSRDS-TCB-STG-BELOW-INUSE / 1024)
           END-COMPUTE.
           MOVE RESULT            TO PP66-75.
           MOVE 'K'               TO PP76.

           COMPUTE RESULT = (DSRDS-TCB-STG-ABOVE / 1024)
           END-COMPUTE.
           MOVE RESULT            TO PP79-88.
           MOVE 'K'               TO PP89.
           COMPUTE RESULT = (DSRDS-TCB-STG-ABOVE / 1024)
           END-COMPUTE.
           MOVE RESULT            TO PP92-101.
           MOVE 'K'               TO PP102.

           IF DSRDS-TCB-CICS-TASK NOT = 0 THEN
               EXEC CICS INQUIRE TASK(DSRDS-TCB-CICS-TASK)
                   ATTACHTIME(TASK-ATTACHTIME)
                   RUNSTATUS(TASK-RUNSTATUS)
                   SUSPENDTIME(TASK-SUSPENDTIME)
                   SUSPENDTYPE(TASK-SUSPENDTYPE)
                   SUSPENDVALUE(TASK-SUSPENDVALUE)
                   TASKDATAKEY(TASK-TASKDATAKEY)
                   TASKDATALOC(TASK-TASKDATALOC)
                   TRANSACTION(TASK-TRANID)
                   NOHANDLE
               END-EXEC
               EVALUATE EIBRESP
                  WHEN DFHRESP(NORMAL)
                     MOVE DSRDS-TCB-CICS-TASK TO PP105-114
                     MOVE TASK-TRANID         TO PP117-120
                     EVALUATE TASK-RUNSTATUS
                         WHEN DFHVALUE(DISPATCHABLE)
                             MOVE 'Dis'       TO PP124-126
                         WHEN DFHVALUE(RUNNING)
                             MOVE 'Run'       TO PP124-126
                         WHEN DFHVALUE(SUSPENDED)
                             MOVE 'Sus'       TO PP124-126
                         WHEN OTHER
                             CONTINUE
                     END-EVALUATE
                  WHEN OTHER
                     MOVE 'None'        TO PP111-114
              END-EVALUATE
           ELSE
               MOVE 'None'              TO PP111-114
           END-IF.

           PERFORM WRITE-OUTPUT.

       PRINT-MVSTCB-STATISTICS-EXIT.
           EXIT.

       CALC-MVSTCB-PERCENTAGE SECTION.

           IF STCK-WORK-NUM-B > 0 THEN
               COMPUTE PERCENTAGE-WORK =
                           (STCK-WORK-NUM-A / STCK-WORK-NUM-B)
                   ON SIZE ERROR CONTINUE
               END-COMPUTE
               COMPUTE PERCENTAGE = (PERCENTAGE-WORK * 100)
                   ON SIZE ERROR CONTINUE
               END-COMPUTE
           ELSE
               MOVE 0 TO PERCENTAGE
           END-IF.

       CALC-MVSTCB-PERCENTAGE-EXIT.
           EXIT.
           EJECT
       MVSTCB-SUB-HEADINGS SECTION.

           MOVE '0' TO PRINT-CONTROL.
           MOVE '  TCB               CICS       Curr' TO PP3-37.
           MOVE 'ent TCB        -Private Stg Below 1' TO PP38-72.
           MOVE '6MB-  -Private Stg Above 16MB-'      TO PP73-102.
           MOVE '       Task   Tran   Task     '      TO PP103-132.
           PERFORM WRITE-OUTPUT.
           MOVE 'Address   TCB Name  TCB   <--- TCB ' TO PP3-37.
           MOVE 'CPU Time --->    Allocated       In' TO PP38-72.
           MOVE ' Use    Allocated       In Use'      TO PP73-102.
           MOVE '      Number   ID   Status    '      TO PP103-132.
           PERFORM WRITE-OUTPUT.
           MOVE '+'     TO PRINT-CONTROL.
           MOVE ALL '_' TO PP3-37
                           PP38-72
                           PP73-102.
           MOVE '__________________________    '      TO PP103-132.
           PERFORM WRITE-OUTPUT.

           MOVE '0'     TO PRINT-CONTROL.
           MOVE 'N'     TO SUB-HEADINGS.

       MVSTCB-SUB-HEADINGS-EXIT.
           EXIT.
           EJECT
       PRINT-MVSTCB-STATISTICS2 SECTION.

           ADD 1 TO TCB-TOTAL.

           SET HEX-INPUT-PTR TO DSRDS-TCB-ADDRESS.
           PERFORM CONVERT-HEX-TO-CHAR.
           MOVE HEX-OUTPUT   TO PP3-10.

           MOVE DSRDS-TCB-NAME    TO PP13-20.
           EVALUATE DSRDS-TCB-TYPE
               WHEN 'C'
                   MOVE 'Yes'     TO PP23-25
                   MOVE CICSTCB-CPUTIME    TO STCK-WORK-B
               WHEN 'N'
                   MOVE 'No '     TO PP23-25
                   MOVE NONCICSTCB-CPUTIME TO STCK-WORK-B
               WHEN OTHER
                   MOVE '???'     TO PP23-25
                   MOVE 0         TO STCK-WORK-NUM-B
           END-EVALUATE.

           SET HEX-INPUT-PTR TO DSRDS-TCB-MOTHER.
           PERFORM CONVERT-HEX-TO-CHAR.
           MOVE HEX-OUTPUT   TO PP29-36.

           SET HEX-INPUT-PTR TO DSRDS-TCB-SISTER.
           PERFORM CONVERT-HEX-TO-CHAR.
           MOVE HEX-OUTPUT   TO PP39-46.

           SET HEX-INPUT-PTR TO DSRDS-TCB-DAUGHTER.
           PERFORM CONVERT-HEX-TO-CHAR.
           MOVE HEX-OUTPUT   TO PP49-56.

           PERFORM WRITE-OUTPUT.

       PRINT-MVSTCB-STATISTICS2-EXIT.
           EXIT.

       MVSTCB-SUB-HEADINGS2 SECTION.

           MOVE '0' TO PRINT-CONTROL.
           MOVE '  TCB               CICS   Mother  ' TO PP3-37.
           MOVE '  Sister   Daughter                ' TO PP38-72.
           PERFORM WRITE-OUTPUT.
           MOVE 'Address   TCB Name  TCB     TCB    ' TO PP3-37.
           MOVE '   TCB       TCB                   ' TO PP38-72.
           PERFORM WRITE-OUTPUT.
           MOVE '+'     TO PRINT-CONTROL.
           MOVE ALL '_' TO PP3-37.
           MOVE '___________________                ' TO PP38-72.
           PERFORM WRITE-OUTPUT.

           MOVE '0'     TO PRINT-CONTROL.
           MOVE 'N'     TO SUB-HEADINGS.

       MVSTCB-SUB-HEADINGS2-EXIT.
           EXIT.
           EJECT
      *****************************************************************
      *** TOTALS-INITIALISE                                         ***
      *****************************************************************
       TOTALS-INITIALISE SECTION.

           MOVE 0 TO CURRENT-TCBS-ATTACHED CURRENT-TCBS-IN-USE
                     TCBS-ATTACHED TCB-ATTACH-FAILURES
                     TCBS-DETACHED-UNCLEAN TCBS-DETACHED-STOLEN
                     TCBS-DETACHED-EXCESS  TCBS-DETACHED-OTHER
                     TCB-STEALS TCB-MISMATCHES TCB-ALLOCATES
                     TCB-TOTAL.

           MOVE 0 TO DSGACT-TOTAL-NUM DSGTCT-TOTAL-NUM.

       TOTALS-INITIALISE-EXIT.
           EXIT.
           EJECT
      *****************************************************************
      *** PAGE-HEADINGS                                             ***
      ***   Increment page                                          ***
      ***   Write new heading line to spool                         ***
      *****************************************************************
       PAGE-HEADINGS SECTION.

           ADD 1       TO PAGENO.
           MOVE PAGENO TO PAGE-NUMBER.
           MOVE 1      TO LINE-COUNT.

           MOVE '1'          TO PRINT-CONTROL.
           MOVE HEADING-LINE TO PP1-132.
           PERFORM WRITE-OUTPUT.
           MOVE '+'          TO PRINT-CONTROL.
           MOVE ALL '_'      TO PP1-132.
           PERFORM WRITE-OUTPUT.

           MOVE 'Y' TO SUB-HEADINGS.

       PAGE-HEADINGS-EXIT.
           EXIT.
           EJECT
      *****************************************************************
      *** STOPWATCH-CONVERT                                         ***
      *** Call program DFH$STCN to convert S/370 format TOD to      ***
      ***   EBCDIC date and time                                    ***
      *****************************************************************
       STOPWATCH-CONVERT SECTION.

           MOVE 'S'    TO CLOCK-TYPE.
           MOVE SPACES TO CLOCK-OUTPUT.

           MOVE LENGTH OF CLOCK-FIELDS TO STCN-COMMAREA.

           EXEC CICS LINK PROGRAM('DFH$STCN')
               COMMAREA(CLOCK-FIELDS)
               LENGTH(STCN-COMMAREA)
           END-EXEC.

           MOVE LOW-VALUES TO CLOCK-FIELD.

       STOPWATCH-CONVERT-EXIT.
           EXIT.

      *****************************************************************
      *** TIMESTAMP-CONVERT                                         ***
      *** Call program DFH$STCN to convert S/370 format TOD to      ***
      ***   EBCDIC date and time                                    ***
      *****************************************************************
       TIMESTAMP-CONVERT SECTION.

           MOVE 'T'    TO CLOCK-TYPE.
           MOVE SPACES TO CLOCK-OUTPUT.

           MOVE LENGTH OF CLOCK-FIELDS TO STCN-COMMAREA.

           EXEC CICS LINK PROGRAM('DFH$STCN')
               COMMAREA(CLOCK-FIELDS)
               LENGTH(STCN-COMMAREA)
           END-EXEC.

           MOVE LOW-VALUES TO CLOCK-FIELD.

       TIMESTAMP-CONVERT-EXIT.
           EXIT.
           EJECT
      *****************************************************************
      ***  Convert a 4-byte binary value into an 8-character        ***
      *** printable representation.                                 ***
      *****************************************************************
       CONVERT-HEX-TO-CHAR SECTION.

           IF HEX-INPUT = LOW-VALUES THEN
               MOVE SPACES     TO HEX-OUTPUT
           ELSE
               MOVE 1 TO SUB1
               MOVE 0 TO SUB2

               PERFORM WITH TEST BEFORE
                   UNTIL SUB1 > 4

                       MOVE HEX-INPUT-CHAR(SUB1) TO BINARY-CHAR
                       DIVIDE BINARY-FIELD BY 16
                           GIVING LEFT-OUTPUT
                               REMAINDER RIGHT-OUTPUT
                       END-DIVIDE
                       ADD 1 TO SUB2
                       IF LEFT-OUTPUT NOT = 0 THEN
                           MOVE HEX-CHAR(LEFT-OUTPUT) TO
                                           HEX-OUTPUT-CHAR(SUB2)
                       ELSE
                           MOVE '0' TO HEX-OUTPUT-CHAR(SUB2)
                       END-IF
                       ADD 1 TO SUB2
                       IF RIGHT-OUTPUT NOT = 0 THEN
                           MOVE HEX-CHAR(RIGHT-OUTPUT) TO
                                           HEX-OUTPUT-CHAR(SUB2)
                       ELSE
                           MOVE '0' TO HEX-OUTPUT-CHAR(SUB2)
                       END-IF

                   ADD 1 TO SUB1
               END-PERFORM
           END-IF.

       CONVERT-HEX-TO-CHAR-EXIT.
           EXIT.
           EJECT
      *****************************************************************
      *** WRITE-OUTPUT                                              ***
      ***   Write current print line to report output destination.  ***
      *****************************************************************
       WRITE-OUTPUT SECTION.

           PERFORM WRITE-SPOOL.

       WRITE-OUTPUT-EXIT.
           EXIT.
           EJECT
      *****************************************************************
      *** WRITE-SPOOL                                               ***
      *** Write current print line to spool                         ***
      *** Increment line-count                                      ***
      *** IF CICS exceptional condition is raised THEN              ***
      ***    call error routine                                     ***
      *****************************************************************
       WRITE-SPOOL SECTION.

           EXEC CICS SPOOLWRITE TOKEN(OUTPUT-TOKEN)
               FROM(PRINT-LINE) FLENGTH(LINE-LENGTH)
               LINE
               NOHANDLE
           END-EXEC.

           EVALUATE PRINT-CONTROL
               WHEN ' '
                   ADD 1 TO LINE-COUNT
               WHEN '0'
                   ADD 2 TO LINE-COUNT
               WHEN '-'
                   ADD 3 TO LINE-COUNT
               WHEN '+'
                   ADD 0 TO LINE-COUNT
               WHEN '1'
                   MOVE 1 TO LINE-COUNT
           END-EVALUATE.

      *                                       Check return code
           IF EIBRESP NOT = DFHRESP(NORMAL) THEN
               MOVE 'SPOOLWRITE' TO CICS-COMMAND
               PERFORM ERROR-ROUTINE
           ELSE
               MOVE ' '    TO PRINT-CONTROL
               MOVE SPACES TO PP1-132
           END-IF.

       WRITE-SPOOL-EXIT.
           EXIT.
           EJECT
      *****************************************************************
      ***  ERROR ROUTINE                                            ***
      ***  Error routine produces appropriate responses to CICS     ***
      ***  spool commands. To ensure this the resp and resp2 values ***
      ***  are returned to the main program DFH0STAT for appropriate***
      ***  outputing of the messages.                               ***
      *****************************************************************
       ERROR-ROUTINE SECTION.

      *  If an error occurs which is not due to the users input or if
      *  the program is not being run from a terminal then a general
      *  message is sent to the screen/console and the RESP and RESP2
      *  fields are given along with the spool command which failed.
           MOVE 'Y'      TO ERROR-FOUND.
           MOVE EIBRESP  TO STCM-RESP.
           MOVE EIBRESP2 TO STCM-RESP2.

      *  Whatever happens ensure we return to DFH0STAT quickly.
           EXEC CICS RETURN
           END-EXEC.

       ERROR-ROUTINE-EXIT.
           EXIT.
