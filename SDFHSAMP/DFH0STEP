      CBL CICS('COBOL3,SP') APOST
PROCESS MAP,XREF,TRUNC(BIN)
      *****************************************************************
      *                                                               *
      *                                                               *
      * MODULE NAME = DFH0STEP                                        *
      *                                                               *
      * DESCRIPTIVE NAME = Collect and Print Statistics Sample        *
      *                                                               *
      *                                                               *
      *                                                               *
      *                                                               *
      *      Licensed Materials - Property of IBM                     *
      *                                                               *
      *      "Restricted Materials of IBM"                            *
      *                                                               *
      *      5655-Y04                                                 *
      *                                                               *
      *      (C) Copyright IBM Corp. 2008, 2017"                      *
      *                                                               *
      *                                                               *
      *                                                               *
      *                                                               *
      * STATUS = 7.2.0                                                8
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      * DESCRIPTION :                                                 *
      *                                                               *
      *     This set of programs illustrate ways of using the EXEC    *
      *     CICS INQUIRE, COLLECT and EXTRACT STATISTICS commands of  *
      *     CICS to produce information about a CICS system.          *
      *     The reports include a CICS and MVS storage analysis.      *
      *     Statistics obtained using these commands can be used to   *
      *     aid the specification of the DSA Size parameters.         *
      *     (See the CICS Performance Guide and CICS Data Areas       *
      *      manuals for more information, and the CICS System        *
      *      Programming Reference for use of commands)               *
      *                                                               *
      *     These programs can be invoked from the PLT at PLTSD or    *
      *     as a CICS transaction (conversationally).                 *
      *     The output is sent via the CICS JES SPOOL interface for   *
      *     which a number of default parameters can be changed by    *
      *     the user to specify the distribution of the report(s).    *
      *     These defaults are defined in the working-storage         *
      *     section of the DFH0STAT program under the 01 level        *
      *     "OUTPUT-DEFAULTS".                                        *
      *                                                               *
      *     Installation instructions:-                               *
      *     Require SIT parameters:-  SPOOL=YES                       *
      *     Required CICS definitions:-                               *
      *         Transactions:-  STAT -> DFH0STAT                      *
      *         Programs:-    DFH0STAT   IBM COBOL                    *
      *                       DFH0STDB       for OS/390 & VM          *
      *                       DFH0STEJ           2.1.1 or later       *
      *                       DFH0STEP       "   "   "                *
      *                       DFH0STGN       "   "   "                *
      *                       DFH0STLK       "   "   "                *
      *                       DFH0STPR       "   "   "                *
      *                       DFH0STSA       "   "   "                *
      *                       DFH0STSY       "   "   "                *
      *                       DFH0STTP       "   "   "                *
      *                       DFH0STTS       "   "   "                *
      *                       DFH0STWB       "   "   "                *
      *                       DFH$STAS   Assembler                    *
      *                       DFH$STCN   Assembler                    *
      *                       DFH$STTB   Assembler                    *
      *         Mapsets:-     DFH0STM                                 *
      *                       DFH0STS                                 *
      *                                                               *
      *     The CICS-supplied RDO group, DFH$STAT, contains all       *
      *     the necessary resource definitions for this sample.       *
      *                                                               *
      *     All programs are command level and run above the          *
      *     16Mb line. Note: that DFH0STAT, DFH0STDB, DFH0STEJ,       *
      *     DFH0STEP, DFH0STGN, DFH0STLK, DFH0STPR, DFH0STSA,         *
      *     DFH0STSY, DFH0STTP, DFH0STTS, and DFH0STWB must be        *
      *     translated with the Translator options "COBOL3 and SP".   *
      *                                                               *
      *   SPOOL errors.  If an EXEC CICS SPOOL .. command fails       *
      *   when the program is run as a transaction, an error message  *
      *   is displayed on the users screen and the transaction will   *
      *   continue.  If the program is not being run from a terminal  *
      *   then a message will be sent to the console using EXEC       *
      *   CICS WRITE OPERATOR commands and the transaction will be    *
      *   terminated normally.                                        *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      * CHANGE ACTIVITY :                                             *
      *      $SEG(DFH0STEP),COMP(SAMPLES),PROD(CICS TS ):             *
      *                                                               *
      *   PN= REASON REL YYMMDD HDXXIII : REMARKS                     *
      *  $L0= 927    660 080605 HD1VCJB : Module created for DFH0STAT *
      *  $L1= 927    660 080625 HD1VCJB : Event Processing Statistics *
      *  $L2= 927    660 081123 HD1VCJB : CAPTURESPEC Statistics      *
      *  $L3= 927    660 090102 HD4PALS : capturespec next translate e*
      *  $L4= 927    660 090106 HD1VCJB : TS Q EP adapter statistics  *
      *  $L5= R00230 670 091215 HDIMJAH : Assured events              *
      *  $L6= R00256 670 100721 HD4IAEC : EPADAPTER statistics        *
      *  $L7= R00249 670 100920 HD3BADW : Exploit new CAPTUREPSEC opti*
      *  $L8= R00246 670 101119 HD3BADW : System event statistics     *
      *  $P2= D24718 660 090309 HD1VCJB : Accounting for lost events  *
      *  $P3= D25534 660 090323 HD1VCJB : Correct Transactional Headin*
      *  $P4= D26797 670 091001 HDIMJAH : Lost events counted twice   *
      *  $P5= D28185 670 110316 HD3BADW : Fix refs to WMQ             *
      *       D55170 680 120711 HDLHJJH : Display adapter set name    *
      *       D54269 680 120801 HD3BADW : Fix text for disp attaches  *
      *       D98593 700 150106 HD3BADW : Fix comments                *
      *      R112532 710 160104 HD3BADW : Add TDQ EP adapter support  *
      *      R131367 710 161105 HDLHJJH : Add ASYNCSERVICE support    *
      *      R134517 710 170120 HDLGJCH : Support for FREE CHILD      *
      *      R134521 710 170214 HDLHJJH : Add running children stats  *
      *      D150786 720 181023 HDFVGMB : Add TRUNC(BIN) to PROCESS   *
      *                                                               *
      *****************************************************************
       ID DIVISION.
       PROGRAM-ID. DFH0STEP.

       ENVIRONMENT DIVISION.
           EJECT
       DATA DIVISION.
       WORKING-STORAGE SECTION.
       77  STCN-COMMAREA               PIC S9(4)  COMP.
       77  INQUIRE-RESP                PIC S9(8)  COMP VALUE +0.
       77  INQUIRE-EVENTBINDING-RESP   PIC S9(8)  COMP VALUE +0.
       77  INQUIRE-CAPTURESPEC-RESP    PIC S9(8)  COMP VALUE +0.

       77  EVENT-PROCESS-STATUS        PIC S9(8)  COMP VALUE +0.
       77  EPADAPTER-NAME              PIC X(32)       VALUE SPACES.
       77  EPADAPTER-ENABLE-STATUS     PIC S9(8)  COMP VALUE +0.

       77  EVENTBINDING-NAME           PIC X(32)       VALUE SPACES.
       77  EVENTBINDING-ENABLE-STATUS  PIC S9(8)  COMP VALUE +0.
       77  EVENTBINDING-ADAPTER-NAME   PIC X(32)       VALUE SPACES.
       77  EVENTBINDING-ADAPTSET-NAME  PIC X(32)       VALUE SPACES.
       77  EVENTBINDING-ADAPTER-RES    PIC S9(8)  COMP VALUE +0.

       77  CAPTURESPEC-NAME            PIC X(32)       VALUE SPACES.
       77  CAPTURESPEC-CAPTUREPOINT    PIC X(25)       VALUE SPACES.
       77  CAPTURESPEC-PTYPE           PIC S9(8)  COMP VALUE +0.
       77  CAPTURESPEC-EVENT-NAME      PIC X(32)       VALUE SPACES.
       77  CAPTURESPEC-CURRPGM         PIC X(8)        VALUE SPACES.
       77  CAPTURESPEC-CURRPGMOP       PIC S9(8)  COMP VALUE +0.
       77  CAPTURESPEC-CURRTRANID      PIC X(4)        VALUE SPACES.
       77  CAPTURESPEC-CURRTRANIDOP    PIC S9(8)  COMP VALUE +0.
       77  CAPTURESPEC-CURRUSERID      PIC X(8)        VALUE SPACES.
       77  CAPTURESPEC-CURRUSERIDOP    PIC S9(8)  COMP VALUE +0.
       77  OPERATOR-CVDA               PIC S9(8)  COMP VALUE +0.
           EJECT
      *****************************************************************
      ***  Total fields                                             ***
      *****************************************************************
       77  EPADAPTER-TOTAL             PIC S9(9)  COMP-3 VALUE +0.
       77  EVENTBINDING-TOTAL          PIC S9(9)  COMP-3 VALUE +0.
       77  CAPTURESPEC-TOTAL           PIC S9(9)  COMP-3 VALUE +0.
           EJECT
      *****************************************************************
      ***  Report print line definitions                            ***
      *****************************************************************
       01  PRINT-LINE.
           03  PRINT-CONTROL           PIC X.
           03  PP1-132.
               05  PP1-16.
                   07  PP1-13.
                       09  PP1-12.
                           11  PP1-10  PIC X(10).
                           11  FILLER  PIC XX.
                       09  FILLER      PIC X.
                   07  FILLER          PIC XXX.
               05  FILLER              PIC X(25).
               05  PP42-51             PIC ZZ,ZZZ,ZZ9.
               05  FILLER              PIC X(81).
           03 FILLER REDEFINES PP1-132.
               05  FILLER              PIC XX.
               05  PP3-39              PIC X(37).
               05  FILLER              PIC XX.
               05  PP42-55             PIC ZZ,ZZZ,ZZZ,ZZ9.
               05  FILLER              PIC X(77).
           03 FILLER REDEFINES PP1-132.
               05  PP1-21              PIC X(21).
               05  FILLER              PIC XX.
               05  FILLER              PIC X(14).
               05  FILLER              PIC X(4).
               05  PP42-73.
                   07  PP42-49         PIC X(8).
                   07  FILLER          PIC X(24).
               05  FILLER              PIC X(59).
           03 FILLER REDEFINES PP1-132.
               05  FILLER              PIC X(6).
               05  PP7-38              PIC X(32).
               05  FILLER              PIC XX.
               05  PP41-67             PIC X(27).
               05  FILLER              PIC XX.
               05  PP70-80             PIC ZZZ,ZZZ,ZZ9.
               05  FILLER              PIC XX.
               05  PP83-89             PIC ZZZ,ZZ9.
               05  FILLER              PIC XX.
               05  PP92-123            PIC X(32).
               05  FILLER              PIC X(9).
           03 FILLER REDEFINES PP1-132.
               05  FILLER              PIC XX.
               05  PP3-132.
                   07  PP3-102.
                       09  PP3-72.
                           11  PP3-37  PIC X(35).
                           11  PP38-72 PIC X(35).
                       09  PP73-102    PIC X(30).
                   07  PP103-132       PIC X(30).
           03 FILLER REDEFINES PP1-132.
               05  FILLER              PIC X(2).
               05  PP3-77.
                   07  PP3-34          PIC X(32).
                   07  FILLER          PIC X(4).
                   07  PP39-41         PIC X(3).
                   07  FILLER          PIC X(4).
                   07  PP46-54         PIC X(9).
                   07  FILLER          PIC X(4).
                   07  PP59-63         PIC X(5).
                   07  FILLER          PIC X(4).
                   07  PP68-77         PIC ZZ,ZZZ,ZZ9.
               05  FILLER              PIC X(55).
          03 FILLER REDEFINES PP1-132.
               05  FILLER              PIC X(44).
               05  PP45-67             PIC X(23).
               05  FILLER              PIC XX.
               05  PP70-77             PIC X(8).
               05  FILLER              PIC XX.
               05  PP80-106            PIC X(26).
               05  FILLER              PIC XX.
               05  PP109-127           PIC X(19).
               05  FILLER              PIC X(5) .
           EJECT
       LINKAGE SECTION.
           EJECT
      *****************************************************************
      ***  Statistics Sample Programs Commarea.                     ***
      *****************************************************************
       01  DFHCOMMAREA.
           COPY DFH0STCM.
           EJECT
      *****************************************************************
      *** Data structures for Dispatcher Global statistics          ***
      *** (See the CICS Data Areas manual)                          ***
      *****************************************************************
           COPY DFHDSGDS.
           EJECT
      *****************************************************************
      *** Data structures for CAPTURESPEC Resource statistics       ***
      *** (See the CICS Data Areas manual)                          ***
      *****************************************************************
           COPY DFHECCDS.
           EJECT
      *****************************************************************
      *** Data structures for EVENTBINDING Global statistics        ***
      *** (See the CICS Data Areas manual)                          ***
      *****************************************************************
           COPY DFHECGDS.
           EJECT
      *****************************************************************
      *** Data structures for EVENTBINDING Resource statistics      ***
      *** (See the CICS Data Areas manual)                          ***
      *****************************************************************
           COPY DFHECRDS.
           EJECT
      *****************************************************************
      *** Data structures for EPADAPTER Resource statistics         ***
      *** (See the CICS Data Areas manual)                          ***
      *****************************************************************
           COPY DFHEPRDS.
           EJECT
      *****************************************************************
      *** Data structures for EVENTPROCESS Global statistics        ***
      *** (See the CICS Data Areas manual)                          ***
      *****************************************************************
           COPY DFHEPGDS.
           EJECT
      *****************************************************************
      *** Data structures for ASYNCSERVICE Global statistics        ***
      *** (See the CICS Data Areas manual)                          ***
      *****************************************************************
           COPY DFHASGDS.
           EJECT
      *****************************************************************
      ***                                                           ***
      ***           CICS Collect and print statistics               ***
      ***                                                           ***
      *****************************************************************
       PROCEDURE DIVISION.

      *****************************************************************
      *** MAIN-PROCESSING                                           ***
      ***     Initialise the totals fields                          ***
      ***     Get CICS system information                           ***
      ***     Print the statistics reports                          ***
      ***     Return to DFH0STLK                                    ***
      *****************************************************************

       MAIN-PROCESSING SECTION.

           PERFORM TOTALS-INITIALISE.

           PERFORM PRINT-STATISTICS.

           EXEC CICS RETURN
           END-EXEC.

       MAIN-PROCESSING-EXIT.
           GOBACK.
           EJECT
      *****************************************************************
      *****************************************************************
      ***         Collect and Print the CICS Statistics             ***
      *****************************************************************
      *****************************************************************
      ***                                                           ***
      *** 1. Print the statistics in the following order:-          ***
      ***    - Event Processing                                     ***
      ***    - EPADAPTER Resources                                  ***
      ***    - EVENTBINDING Resources                               ***
      ***    - CAPTURESPEC Resources                                ***
      ***    - ASYNCSERVICE                                         ***
      ***                                                           ***
      *****************************************************************
      *****************************************************************

       PRINT-STATISTICS SECTION.

           IF SELECT-EVENT-PROCESS = 'Y' OR 'y' THEN
               PERFORM EVENT-PROCESS-STATISTICS
           END-IF.

           IF SELECT-EPADAPTERS = 'Y' OR 'y' THEN
               PERFORM EPADAPTER-STATISTICS
           END-IF.

           IF SELECT-EVENTBINDINGS = 'Y' OR 'y' THEN
               PERFORM EVENTBINDING-STATISTICS
           END-IF.

           IF SELECT-CAPTURESPECS = 'Y' OR 'y' THEN
               PERFORM CAPTURESPEC-STATISTICS
           END-IF.

           IF SELECT-ASYNCSERVICE = 'Y' OR 'y' THEN
               PERFORM ASYNCSERVICE-STATISTICS
           END-IF.

       PRINT-STATISTICS-EXIT.
           EXIT.
           EJECT
      *****************************************************************
      *** EVENT-PROCESS-STATISTICS                                  ***
      ***   Print heading and Event processing statistics.          ***
      *****************************************************************
       EVENT-PROCESS-STATISTICS SECTION.

           PERFORM PAGE-HEADINGS.
           MOVE PAGENO TO EVENT-PROCESS-PAGENO.

           MOVE '-'                TO PRINT-CONTROL.
           MOVE 'Event Processing' TO PP1-16.
           PERFORM WRITE-OUTPUT.
           MOVE '+'     TO PRINT-CONTROL.
           MOVE ALL '_' TO PP1-16.
           PERFORM WRITE-OUTPUT.

           EXEC CICS INQUIRE EVENTPROCESS
               EPSTATUS(EVENT-PROCESS-STATUS)
           END-EXEC.

           MOVE '0' TO PRINT-CONTROL.
           MOVE 'Event Processing Status . . . . . . :' TO PP3-39.
           EVALUATE EVENT-PROCESS-STATUS
               WHEN DFHVALUE(STARTED)
                   MOVE 'Started ' TO PP42-49
               WHEN DFHVALUE(DRAINING)
                   MOVE 'Draining' TO PP42-49
               WHEN DFHVALUE(STOPPED)
                   MOVE 'Stopped ' TO PP42-49
               WHEN OTHER
                   CONTINUE
           END-EVALUATE.
           PERFORM WRITE-OUTPUT.

           EXEC CICS EXTRACT STATISTICS EVENTPROCESS
               SET(ADDRESS OF DFHEPGDS)
               NOHANDLE
           END-EXEC

           MOVE '0'       TO PRINT-CONTROL.
           MOVE 'Put Events. . . . . . . . . . . . . :' TO PP3-39.
           MOVE EPG-PUT-EVENTS                          TO PP42-51.
           PERFORM WRITE-OUTPUT.

           MOVE 'Commit forward events . . . . . . . :' TO PP3-39.
           MOVE EPG-COMMIT-FORWARD-EVENTS               TO PP42-51.
           PERFORM WRITE-OUTPUT.

           MOVE 'Commit backward events. . . . . . . :' TO PP3-39.
           MOVE EPG-COMMIT-BACKWARD-EVENTS              TO PP42-51.
           PERFORM WRITE-OUTPUT.

           MOVE '0'       TO PRINT-CONTROL.
           MOVE 'Current event capture queue . . . . :' TO PP3-39.
           MOVE EPG-CURRENT-EVC-QUEUE                   TO PP42-51.
           PERFORM WRITE-OUTPUT.

           MOVE 'Peak event capture queue. . . . . . :' TO PP3-39.
           MOVE EPG-PEAK-EVC-QUEUE                      TO PP42-51.
           PERFORM WRITE-OUTPUT.

           MOVE 'Current transactional queue . . . . :' TO PP3-39.
           MOVE EPG-CURRENT-TRANS-QUEUE                 TO PP42-51.
           PERFORM WRITE-OUTPUT.

           MOVE 'Peak transactional queue. . . . . . :' TO PP3-39.
           MOVE EPG-PEAK-TRANS-QUEUE                    TO PP42-51.
           PERFORM WRITE-OUTPUT.

           MOVE '0'       TO PRINT-CONTROL.
           MOVE 'Async normal events . . . . . . . . :' TO PP3-39.
           MOVE EPG-ASYNC-NORMAL-EVENTS                 TO PP42-51.
           PERFORM WRITE-OUTPUT.

           MOVE 'Async priority events . . . . . . . :' TO PP3-39.
           MOVE EPG-ASYNC-PRIORITY-EVENTS               TO PP42-51.
           PERFORM WRITE-OUTPUT.

           MOVE 'Transactional events. . . . . . . . :' TO PP3-39.
           MOVE EPG-TRANS-EVENTS                        TO PP42-51.
           PERFORM WRITE-OUTPUT.

           MOVE 'Transactional events discarded. . . :' TO PP3-39.
           MOVE EPG-TRANS-EVENTS-DISCARDED              TO PP42-51.
           PERFORM WRITE-OUTPUT.

           MOVE 'Synchronous events. . . . . . . . . :' TO PP3-39.
           MOVE EPG-SYNC-EVENTS                         TO PP42-51.
           PERFORM WRITE-OUTPUT.

           MOVE 'Synchronous events failed . . . . . :' TO PP3-39.
           MOVE EPG-SYNC-EVENTS-FAILED                  TO PP42-51.
           PERFORM WRITE-OUTPUT.

           MOVE '0'       TO PRINT-CONTROL.
           MOVE 'Number of dispatcher attaches . . . :' TO PP3-39.
           MOVE EPG-DISPATCHERS-ATTACHED                TO PP42-51.
           PERFORM WRITE-OUTPUT.

           MOVE 'Current dispatcher tasks. . . . . . :' TO PP3-39.
           MOVE EPG-CURRENT-DISPATCHERS                 TO PP42-51.
           PERFORM WRITE-OUTPUT.

           MOVE 'Peak dispatcher tasks . . . . . . . :' TO PP3-39.
           MOVE EPG-PEAK-DISPATCHERS                    TO PP42-51.
           PERFORM WRITE-OUTPUT.

           MOVE '0'       TO PRINT-CONTROL.
           MOVE 'Events to WebSphere MQ EP adapter . :' TO PP3-39.
           MOVE EPG-WMQ-ADAPTER-EVENTS                  TO PP42-51.
           PERFORM WRITE-OUTPUT.

           MOVE 'Events to Transaction EP adapter. . :' TO PP3-39.
           MOVE EPG-TRANS-ADAPTER-EVENTS                TO PP42-51.
           PERFORM WRITE-OUTPUT.

           MOVE 'Events to Tdqueue EP adapter. . . . :' TO PP3-39.
           MOVE EPG-TDQUEUE-ADAPTER-EVENTS              TO PP42-51.
           PERFORM WRITE-OUTPUT.

           MOVE 'Events to Tsqueue EP adapter. . . . :' TO PP3-39.
           MOVE EPG-TSQUEUE-ADAPTER-EVENTS              TO PP42-51.
           PERFORM WRITE-OUTPUT.

           MOVE 'Events to Custom EP adapter . . . . :' TO PP3-39.
           MOVE EPG-CUSTOM-ADAPTER-EVENTS               TO PP42-51.
           PERFORM WRITE-OUTPUT.

           MOVE 'Events to HTTP EP adapter . . . . . :' TO PP3-39.
           MOVE EPG-HTTP-ADAPTER-EVENTS                 TO PP42-51.
           PERFORM WRITE-OUTPUT.

           MOVE '0'       TO PRINT-CONTROL.
           MOVE 'Events lost (dispatcher) - config . :' TO PP3-39.
           MOVE EPG-DISPATCH-FAILURE-CONFIG             TO PP42-51.
           PERFORM WRITE-OUTPUT.

           MOVE 'Events lost (dispatcher) - other. . :' TO PP3-39.
           MOVE EPG-DISPATCH-FAILURE-OTHER              TO PP42-51.
           PERFORM WRITE-OUTPUT.

           MOVE '0'       TO PRINT-CONTROL.
           MOVE 'Events lost (adapter) - config. . . :' TO PP3-39.
           MOVE EPG-ADAPTER-FAILURE-CONFIG              TO PP42-51.
           PERFORM WRITE-OUTPUT.

           MOVE 'Events lost (adapter) - other. .  . :' TO PP3-39.
           MOVE EPG-ADAPTER-FAILURE-OTHER               TO PP42-51.
           PERFORM WRITE-OUTPUT.

           MOVE 'Events lost - adapter unavailable . :' TO PP3-39.
           MOVE EPG-EVENTS-ADAPTER-UNAVAIL              TO PP42-51.
           PERFORM WRITE-OUTPUT.

      *****************************************************************

           MOVE '-'             TO PRINT-CONTROL.
           MOVE 'Event Capture' TO PP1-13.
           PERFORM WRITE-OUTPUT.
           MOVE '+'     TO PRINT-CONTROL.
           MOVE ALL '_' TO PP1-13.
           PERFORM WRITE-OUTPUT.

           EXEC CICS EXTRACT STATISTICS EVENTBINDING
               SET(ADDRESS OF DFHECGDS)
               NOHANDLE
           END-EXEC.

           MOVE '0' TO PRINT-CONTROL.
           MOVE 'Event Filtering operations. . . . . :' TO PP3-39.
           MOVE ECG-EB-EVENT-FILTER-OPS                 TO PP42-55.
           PERFORM WRITE-OUTPUT.

           MOVE 'Events with disabled EVENTBINDING . :' TO PP3-39.
           MOVE ECG-EB-EVENTS-DISABLED                  TO PP42-55.
           PERFORM WRITE-OUTPUT.

           MOVE 'Events captured . . . . . . . . . . :' TO PP3-39.
           MOVE ECG-EB-EVENTS-CAPTURED                  TO PP42-55.
           PERFORM WRITE-OUTPUT.

           MOVE 'System Events captured . . . .  . . :' TO PP3-39.
           MOVE ECG-SYS-EVENTS-CAPTURED                 TO PP42-55.
           PERFORM WRITE-OUTPUT.

           MOVE '0' TO PRINT-CONTROL.
           MOVE 'Filter operations failed. . . . . . :' TO PP3-39.
           MOVE ECG-FILTER-OPS-FAILED                   TO PP42-55.
           PERFORM WRITE-OUTPUT.

           MOVE 'Capture operations failed . . . . . :' TO PP3-39.
           MOVE ECG-CAPTURE-OPS-FAILED                  TO PP42-55.
           PERFORM WRITE-OUTPUT.

       EVENT-PROCESS-STATISTICS-EXIT.
           EXIT.
           EJECT
       EPADAPTER-STATISTICS SECTION.

           PERFORM PAGE-HEADINGS.
           MOVE PAGENO TO EPADAPTERS-PAGENO.

           MOVE '-'             TO PRINT-CONTROL.
           MOVE 'EPADAPTERs'    TO PP1-10.
           PERFORM WRITE-OUTPUT.
           MOVE '+'     TO PRINT-CONTROL.
           MOVE ALL '_' TO PP1-10.
           PERFORM WRITE-OUTPUT.

      *****************************************************************
      ***   Print the EP adapter statistics.                        ***
      *****************************************************************

           MOVE 'Y' TO SUB-HEADINGS.
           MOVE '0' TO PRINT-CONTROL.

           EXEC CICS INQUIRE EPADAPTER START
           END-EXEC.

           EXEC CICS INQUIRE EPADAPTER(EPADAPTER-NAME) NEXT
               ENABLESTATUS(EPADAPTER-ENABLE-STATUS)
               RESP(INQUIRE-RESP)
           END-EXEC.

           PERFORM WITH TEST BEFORE
               UNTIL INQUIRE-RESP = DFHRESP(END)

               IF LINE-COUNT > (LINES-PER-PAGE - 5) THEN
                   PERFORM PAGE-HEADINGS
               END-IF

               IF SUB-HEADINGS = 'Y' THEN
                   PERFORM EPADAPTER-SUB-HEADINGS
               END-IF

               EXEC CICS EXTRACT STATISTICS EPADAPTER
                   RESID(EPADAPTER-NAME)
                   SET(ADDRESS OF DFHEPRDS)
                   NOHANDLE
               END-EXEC

               MOVE '0' TO PRINT-CONTROL

               ADD 1    TO EPADAPTER-TOTAL

               MOVE EPADAPTER-NAME     TO PP3-34

               EVALUATE EPADAPTER-ENABLE-STATUS
                   WHEN DFHVALUE(DISABLED)
                       MOVE 'No '      TO PP39-41
                   WHEN DFHVALUE(ENABLED)
                       MOVE 'Yes'      TO PP39-41
                   WHEN OTHER
                       CONTINUE
               END-EVALUATE

               EVALUATE TRUE
                   WHEN EPR-ATYPE-CUSTOM
                       MOVE 'Custom   ' TO PP46-54
                   WHEN EPR-ATYPE-WMQ
                       MOVE 'WMQ      ' TO PP46-54
                   WHEN EPR-ATYPE-TRANSTART
                       MOVE 'Transtart' TO PP46-54
                   WHEN EPR-ATYPE-TDQUEUE
                       MOVE 'Tdqueue  ' TO PP46-54
                   WHEN EPR-ATYPE-TSQUEUE
                       MOVE 'Tsqueue  ' TO PP46-54
                   WHEN EPR-ATYPE-HTTP
                       MOVE 'HTTP     ' TO PP46-54
                   WHEN OTHER
                       CONTINUE
               END-EVALUATE

               EVALUATE TRUE
                   WHEN EPR-EMODE-SYNC
                       MOVE 'Sync ' TO PP59-63
                   WHEN EPR-EMODE-ASYNC
                       MOVE 'Async' TO PP59-63
                   WHEN OTHER
                       CONTINUE
               END-EVALUATE

               MOVE EPR-PUT-EVENTS     TO PP68-77

               PERFORM WRITE-OUTPUT

               EXEC CICS INQUIRE EPADAPTER(EPADAPTER-NAME) NEXT
                   ENABLESTATUS(EPADAPTER-ENABLE-STATUS)
                   RESP(INQUIRE-RESP)
               END-EXEC

           END-PERFORM.

           EXEC CICS INQUIRE EPADAPTER END
           END-EXEC.

       EPADAPTER-STATISTICS-EXIT.
           EXIT.
           EJECT
       EPADAPTER-SUB-HEADINGS SECTION.

           MOVE '-' TO PRINT-CONTROL.
           MOVE 'EP adapter name                   E' TO PP3-37.
           MOVE 'nabled  Type       Emit mode  Put E' TO PP38-72.
           MOVE 'vents                         '      TO PP73-102.
           PERFORM WRITE-OUTPUT.
           MOVE '+'     TO PRINT-CONTROL.
           MOVE ALL '_' TO PP3-37
                           PP38-72.
           MOVE '_____                         ' TO PP73-102.
           PERFORM WRITE-OUTPUT.

           MOVE '0'     TO PRINT-CONTROL.
           MOVE 'N'     TO SUB-HEADINGS.

       EPADAPTER-SUB-HEADINGS-EXIT.
           EXIT.
           EJECT
       EVENTBINDING-STATISTICS SECTION.

           PERFORM PAGE-HEADINGS.
           MOVE PAGENO TO EVENTBINDINGS-PAGENO.

           MOVE '-'             TO PRINT-CONTROL.
           MOVE 'EVENTBINDINGs' TO PP1-13.
           PERFORM WRITE-OUTPUT.
           MOVE '+'     TO PRINT-CONTROL.
           MOVE ALL '_' TO PP1-13.
           PERFORM WRITE-OUTPUT.

      *****************************************************************
      ***   Print the Eventbinding statistics.                      ***
      *****************************************************************

           MOVE '0'       TO PRINT-CONTROL.

           EXEC CICS INQUIRE EVENTBINDING START
           END-EXEC.

           EXEC CICS INQUIRE EVENTBINDING(EVENTBINDING-NAME) NEXT
               ENABLESTATUS(EVENTBINDING-ENABLE-STATUS)
               EPADAPTER(EVENTBINDING-ADAPTER-NAME)
               EPADAPTERSET(EVENTBINDING-ADAPTSET-NAME)
               EPADAPTERRES(EVENTBINDING-ADAPTER-RES)
               RESP(INQUIRE-RESP)
           END-EXEC.

           PERFORM WITH TEST BEFORE
               UNTIL INQUIRE-RESP = DFHRESP(END)

               IF LINE-COUNT > (LINES-PER-PAGE - 6) THEN
                   PERFORM PAGE-HEADINGS
               END-IF

               EXEC CICS EXTRACT STATISTICS EVENTBINDING
                   RESID(EVENTBINDING-NAME)
                   SET(ADDRESS OF DFHECRDS)
                   NOHANDLE
               END-EXEC

               MOVE '0' TO PRINT-CONTROL

               ADD 1    TO EVENTBINDING-TOTAL

               MOVE 'EVENTBINDING Name . . . . . . . . . :' TO PP3-39
               MOVE EVENTBINDING-NAME                       TO PP42-73
               PERFORM WRITE-OUTPUT

               EVALUATE EVENTBINDING-ADAPTER-RES
                   WHEN DFHVALUE(EPADAPTER)
                       MOVE 'EPADAPTER Name. . . . . . . . . . . :'
                                   TO PP3-39
                   WHEN DFHVALUE(EPADAPTERSET)
                       MOVE 'EPADAPTERSET Name. .. . . . . . . . :'
                                   TO PP3-39
                   WHEN OTHER
                       CONTINUE
               END-EVALUATE
               MOVE ECR-EPADAPTER-NAME                      TO PP42-73
               PERFORM WRITE-OUTPUT

               MOVE 'Enable Status . . . . . . . . . . . :' TO PP3-39
               EVALUATE EVENTBINDING-ENABLE-STATUS
                   WHEN DFHVALUE(DISABLED)
                       MOVE 'Disabled' TO PP42-49
                   WHEN DFHVALUE(ENABLED)
                       MOVE 'Enabled ' TO PP42-49
                   WHEN OTHER
                       CONTINUE
               END-EVALUATE
               PERFORM WRITE-OUTPUT

               MOVE '0' TO PRINT-CONTROL
               MOVE ALL '-' TO PP3-132
               PERFORM WRITE-OUTPUT

               EXEC CICS INQUIRE EVENTBINDING(EVENTBINDING-NAME) NEXT
                   ENABLESTATUS(EVENTBINDING-ENABLE-STATUS)
                   EPADAPTER(EVENTBINDING-ADAPTER-NAME)
                   EPADAPTERSET(EVENTBINDING-ADAPTSET-NAME)
                   EPADAPTERRES(EVENTBINDING-ADAPTER-RES)
                   RESP(INQUIRE-RESP)
               END-EXEC

           END-PERFORM.

           EXEC CICS INQUIRE EVENTBINDING END
           END-EXEC.

       EVENTBINDING-STATISTICS-EXIT.
           EXIT.
           EJECT
       CAPTURESPEC-STATISTICS SECTION.

           PERFORM PAGE-HEADINGS.
           MOVE PAGENO TO CAPTURESPECS-PAGENO.

           MOVE '-'            TO PRINT-CONTROL.
           MOVE 'CAPTURESPECs' TO PP1-12.
           PERFORM WRITE-OUTPUT.
           MOVE '+'     TO PRINT-CONTROL.
           MOVE ALL '_' TO PP1-12.
           PERFORM WRITE-OUTPUT.

      *****************************************************************
      ***   Print the Capturespec statistics.                       ***
      *****************************************************************

           EXEC CICS INQUIRE EVENTBINDING START
           END-EXEC.

           EXEC CICS INQUIRE EVENTBINDING(EVENTBINDING-NAME) NEXT
               ENABLESTATUS(EVENTBINDING-ENABLE-STATUS)
               EPADAPTER(EVENTBINDING-ADAPTER-NAME)
               EPADAPTERSET(EVENTBINDING-ADAPTSET-NAME)
               EPADAPTERRES(EVENTBINDING-ADAPTER-RES)
               RESP(INQUIRE-RESP)
           END-EXEC.

           PERFORM WITH TEST BEFORE
               UNTIL INQUIRE-RESP = DFHRESP(END)

               IF LINE-COUNT > (LINES-PER-PAGE - 12) THEN
                   PERFORM PAGE-HEADINGS
               END-IF

               MOVE '0' TO PRINT-CONTROL

               MOVE 'EVENTBINDING Name . . . . . . . . . :' TO PP3-39
               MOVE EVENTBINDING-NAME                       TO PP42-73
               PERFORM WRITE-OUTPUT

               EVALUATE EVENTBINDING-ADAPTER-RES
                   WHEN DFHVALUE(EPADAPTER)
                       MOVE 'EPADAPTER Name. . . . . . . . . . . :'
                                   TO PP3-39
                       MOVE EVENTBINDING-ADAPTER-NAME TO PP42-73
                   WHEN DFHVALUE(EPADAPTERSET)
                       MOVE 'EPADAPTERSET Name. .. . . . . . . . :'
                                   TO PP3-39
                       MOVE EVENTBINDING-ADAPTSET-NAME TO PP42-73
                   WHEN OTHER
                       CONTINUE
               END-EVALUATE
               PERFORM WRITE-OUTPUT

               MOVE 'Enable Status . . . . . . . . . . . :' TO PP3-39
               EVALUATE EVENTBINDING-ENABLE-STATUS
                   WHEN DFHVALUE(DISABLED)
                       MOVE 'Disabled' TO PP42-49
                   WHEN DFHVALUE(ENABLED)
                       MOVE 'Enabled ' TO PP42-49
                   WHEN OTHER
                       CONTINUE
               END-EVALUATE
               PERFORM WRITE-OUTPUT

               PERFORM BROWSE-CAPTURESPECS

               MOVE '0' TO PRINT-CONTROL
               MOVE ALL '-' TO PP3-132
               PERFORM WRITE-OUTPUT

               EXEC CICS INQUIRE EVENTBINDING(EVENTBINDING-NAME) NEXT
                   ENABLESTATUS(EVENTBINDING-ENABLE-STATUS)
                   EPADAPTER(EVENTBINDING-ADAPTER-NAME)
                   EPADAPTERSET(EVENTBINDING-ADAPTSET-NAME)
                   EPADAPTERRES(EVENTBINDING-ADAPTER-RES)
                   RESP(INQUIRE-RESP)
               END-EXEC

           END-PERFORM.

           EXEC CICS INQUIRE EVENTBINDING END
           END-EXEC.

       CAPTURESPEC-STATISTICS-EXIT.
           EXIT.
           EJECT
      *****************************************************************
      *** ASYNCSERVICE-STATISTICS                                   ***
      ***   Print heading and asynchronous service statistics.      ***
      *****************************************************************
       ASYNCSERVICE-STATISTICS SECTION.

           PERFORM PAGE-HEADINGS.
           MOVE PAGENO TO ASYNCSERVICE-PAGENO.

           MOVE '-'                TO PRINT-CONTROL.
           MOVE 'Asynchronous services' TO PP1-21.
           PERFORM WRITE-OUTPUT.
           MOVE '+'     TO PRINT-CONTROL.
           MOVE ALL '_' TO PP1-21.
           PERFORM WRITE-OUTPUT.

           EXEC CICS EXTRACT STATISTICS ASYNCSERVICE
               SET(ADDRESS OF DFHASGDS)
               NOHANDLE
           END-EXEC

           MOVE '0'       TO PRINT-CONTROL.
           MOVE 'RUN commands. . . . . . . . . . . . :' TO PP3-39.
           MOVE ASG-RUN-COUNT                           TO PP42-51.
           PERFORM WRITE-OUTPUT.

           MOVE 'FETCH commands. . . . . . . . . . . :' TO PP3-39.
           MOVE ASG-FETCH-COUNT                         TO PP42-51.
           PERFORM WRITE-OUTPUT.

           MOVE 'FREE commands . . . . . . . . . . . :' TO PP3-39.
           MOVE ASG-FREE-COUNT                          TO PP42-51.
           PERFORM WRITE-OUTPUT.

           MOVE 'Current active children . . . . . . :' TO PP3-39.
           MOVE ASG-CHILDREN-CUR                        TO PP42-51.
           PERFORM WRITE-OUTPUT.

           MOVE 'Peak active children. . . . . . . . :' TO PP3-39.
           MOVE ASG-CHILDREN-PEAK                       TO PP42-51.
           PERFORM WRITE-OUTPUT.

           MOVE 'Times RUN commands being delayed. . :' TO PP3-39.
           MOVE ASG-RUN-DELAY-COUNT                     TO PP42-51.
           PERFORM WRITE-OUTPUT.

           MOVE 'Current parents being delayed . . . :' TO PP3-39.
           MOVE ASG-PARENTS-DELAYED-CUR                 TO PP42-51.
           PERFORM WRITE-OUTPUT.

           MOVE 'Peak parents being delayed. . . . . :' TO PP3-39.
           MOVE ASG-PARENTS-DELAYED-PEAK                TO PP42-51.
           PERFORM WRITE-OUTPUT.

       ASYNCSERVICE-STATISTICS-EXIT.
           EXIT.
           EJECT
      *****************************************************************
      *** BROWSE-CAPTURESPECS                                       ***
      ***   Browse and print the Capturespecs for an Eventbinding.  ***
      *****************************************************************
       BROWSE-CAPTURESPECS SECTION.

           MOVE 'Y' TO SUB-HEADINGS.

           EXEC CICS INQUIRE CAPTURESPEC
               EVENTBINDING(EVENTBINDING-NAME) START
           END-EXEC.

           EXEC CICS INQUIRE CAPTURESPEC(CAPTURESPEC-NAME) NEXT
               CAPTUREPOINT(CAPTURESPEC-CAPTUREPOINT)
               CAPTUREPTYPE(CAPTURESPEC-PTYPE)
               CURRPGM(CAPTURESPEC-CURRPGM)
               CURRPGMOP(CAPTURESPEC-CURRPGMOP)
               CURRTRANID(CAPTURESPEC-CURRTRANID)
               CURRTRANIDOP(CAPTURESPEC-CURRTRANIDOP)
               CURRUSERID(CAPTURESPEC-CURRUSERID)
               CURRUSERIDOP(CAPTURESPEC-CURRUSERIDOP)
               EVENTNAME(CAPTURESPEC-EVENT-NAME)
               RESP(INQUIRE-CAPTURESPEC-RESP)
           END-EXEC.

           PERFORM WITH TEST BEFORE
               UNTIL INQUIRE-CAPTURESPEC-RESP = DFHRESP(END)

               IF LINE-COUNT > (LINES-PER-PAGE - 9) THEN
                   PERFORM PAGE-HEADINGS
               END-IF

               IF SUB-HEADINGS = 'Y' THEN
                   PERFORM CAPTURESPEC-SUB-HEADINGS
               END-IF

               EXEC CICS EXTRACT STATISTICS EVENTBINDING
                   RESID(EVENTBINDING-NAME)
                   SUBRESTYPE(DFHVALUE(CAPTURESPEC))
                   SUBRESID(CAPTURESPEC-NAME)
                   SET(ADDRESS OF DFHECCDS)
               END-EXEC

               ADD 1    TO CAPTURESPEC-TOTAL

               MOVE '0' TO PRINT-CONTROL

               MOVE CAPTURESPEC-NAME      TO PP7-38

               EVALUATE CAPTURESPEC-PTYPE
                   WHEN DFHVALUE(PRECOMMAND)
                       STRING 'PRE:'
                              CAPTURESPEC-CAPTUREPOINT
                           DELIMITED BY SIZE
                           INTO PP41-67
                   WHEN DFHVALUE(POSTCOMMAND)
                       STRING 'POST:'
                              CAPTURESPEC-CAPTUREPOINT
                           DELIMITED BY SIZE
                           INTO PP41-67
                   WHEN DFHVALUE(PROGRAMINIT)
                       MOVE CAPTURESPEC-CAPTUREPOINT TO PP41-67
                   WHEN DFHVALUE(SYSTEM)
                       MOVE CAPTURESPEC-CAPTUREPOINT TO PP41-67
                   WHEN OTHER
                       CONTINUE
               END-EVALUATE

               MOVE ECC-EVENTS-CAPTURED      TO PP70-80
               MOVE ECC-CAPTURE-FAILURES     TO PP83-89
               MOVE CAPTURESPEC-EVENT-NAME   TO PP92-123

               PERFORM WRITE-OUTPUT

               MOVE 'Current Program . . . :'    TO PP45-67
               MOVE CAPTURESPEC-CURRPGM          TO PP70-77
               MOVE 'Current Program Op . . . :' TO PP80-106

               MOVE CAPTURESPEC-CURRPGMOP TO OPERATOR-CVDA
               PERFORM EVALUATE-OPERATOR

               PERFORM WRITE-OUTPUT

               MOVE 'Current Transaction . :'    TO PP45-67
               STRING CAPTURESPEC-CURRTRANID
                      '    '
                      DELIMITED BY SIZE
                      INTO PP70-77
               MOVE 'Current Transaction Op . :' TO PP80-106
               MOVE CAPTURESPEC-CURRTRANIDOP TO OPERATOR-CVDA
               PERFORM EVALUATE-OPERATOR
               PERFORM WRITE-OUTPUT

               MOVE 'Current Userid  . . . :'    TO PP45-67
               MOVE CAPTURESPEC-CURRUSERID       TO PP70-77
               MOVE 'Current Userid Op  . . . :' TO PP80-106
               MOVE CAPTURESPEC-CURRUSERIDOP TO OPERATOR-CVDA
               PERFORM EVALUATE-OPERATOR
               PERFORM WRITE-OUTPUT

               EXEC CICS INQUIRE CAPTURESPEC(CAPTURESPEC-NAME) NEXT
                   CAPTUREPOINT(CAPTURESPEC-CAPTUREPOINT)
                   CAPTUREPTYPE(CAPTURESPEC-PTYPE)
                   CURRPGM(CAPTURESPEC-CURRPGM)
                   CURRPGMOP(CAPTURESPEC-CURRPGMOP)
                   CURRTRANID(CAPTURESPEC-CURRTRANID)
                   CURRTRANIDOP(CAPTURESPEC-CURRTRANIDOP)
                   CURRUSERID(CAPTURESPEC-CURRUSERID)
                   CURRUSERIDOP(CAPTURESPEC-CURRUSERIDOP)
                   EVENTNAME(CAPTURESPEC-EVENT-NAME)
                   RESP(INQUIRE-CAPTURESPEC-RESP)
               END-EXEC

           END-PERFORM.

           EXEC CICS INQUIRE CAPTURESPEC END
           END-EXEC.

       BROWSE-CAPTURESPECS-EXIT.
           EXIT.
           EJECT
      *****************************************************************
      *** EVALUATE-OPERATOR                                         ***
      *** Map CICS CVDA to same strings as used by Event binding    ***
      **  editor                                                    ***
      *****************************************************************
       EVALUATE-OPERATOR SECTION.

           EVALUATE OPERATOR-CVDA
               WHEN DFHVALUE(ALLVALUES)
                   MOVE 'All                ' TO PP109-127
               WHEN DFHVALUE(EQUALS)
                   MOVE 'Equals             ' TO PP109-127
               WHEN DFHVALUE(DOESNOTEQUAL)
                   MOVE 'Does Not Equal     ' TO PP109-127
               WHEN DFHVALUE(STARTSWITH)
                   MOVE 'Starts With        ' TO PP109-127
               WHEN DFHVALUE(DOESNOTSTART)
                   MOVE 'Does Not Start With' TO PP109-127
               WHEN DFHVALUE(LESSTHAN)
                   MOVE 'Less Than          ' TO PP109-127
               WHEN DFHVALUE(ISNOTLESS)
                   MOVE 'Not Less Than      ' TO PP109-127
               WHEN DFHVALUE(GREATERTHAN)
                   MOVE 'Greater Than       ' TO PP109-127
               WHEN DFHVALUE(ISNOTGREATER)
                   MOVE 'Not Greater Than   ' TO PP109-127
               WHEN OTHER
                   CONTINUE
           END-EVALUATE.

       EVALUATE-OPERATOR-EXIT.
           EXIT.
           EJECT

       CAPTURESPEC-SUB-HEADINGS SECTION.

           MOVE '0' TO PRINT-CONTROL.
           MOVE '                                   ' TO PP38-72.
           MOVE ' Events   Capture             '      TO PP73-102.
           PERFORM WRITE-OUTPUT.
           MOVE '    Capturespec name               ' TO PP3-37.
           MOVE '   Capture point                   ' TO PP38-72.
           MOVE 'Captured Failures  Event name '      TO PP73-102.
           PERFORM WRITE-OUTPUT.
           MOVE '+'     TO PRINT-CONTROL.
           MOVE '    _______________________________' TO PP3-37.
           MOVE ALL '_' TO PP38-72
                           PP73-102.
           MOVE '_____________________         '      TO PP103-132.
           PERFORM WRITE-OUTPUT.

           MOVE '0'     TO PRINT-CONTROL.
           MOVE 'N'     TO SUB-HEADINGS.

       CAPTURESPEC-SUB-HEADINGS-EXIT.
           EXIT.
           EJECT
      *****************************************************************
      *** TOTALS-INITIALISE                                         ***
      *****************************************************************
       TOTALS-INITIALISE SECTION.

           MOVE 0 TO CAPTURESPEC-TOTAL
                     EVENTBINDING-TOTAL
                     EPADAPTER-TOTAL.

       TOTALS-INITIALISE-EXIT.
           EXIT.
           EJECT
      *****************************************************************
      *** PAGE-HEADINGS                                             ***
      ***   Increment page                                          ***
      ***   Write new heading line to spool                         ***
      *****************************************************************
       PAGE-HEADINGS SECTION.

           ADD 1       TO PAGENO.
           MOVE PAGENO TO PAGE-NUMBER.
           MOVE 1      TO LINE-COUNT.

           MOVE '1'          TO PRINT-CONTROL.
           MOVE HEADING-LINE TO PP1-132.
           PERFORM WRITE-OUTPUT.
           MOVE '+'          TO PRINT-CONTROL.
           MOVE ALL '_'      TO PP1-132.
           PERFORM WRITE-OUTPUT.

           MOVE 'Y' TO SUB-HEADINGS.

       PAGE-HEADINGS-EXIT.
           EXIT.
           EJECT
      *****************************************************************
      *** WRITE-OUTPUT                                              ***
      ***   Write current print line to report output destination.  ***
      *****************************************************************
       WRITE-OUTPUT SECTION.

           PERFORM WRITE-SPOOL.

       WRITE-OUTPUT-EXIT.
           EXIT.
           EJECT
      *****************************************************************
      *** WRITE-SPOOL                                               ***
      *** Write current print line to spool                         ***
      *** Increment line-count                                      ***
      *** IF CICS exceptional condition is raised THEN              ***
      ***    call error routine                                     ***
      *****************************************************************
       WRITE-SPOOL SECTION.

           EXEC CICS SPOOLWRITE TOKEN(OUTPUT-TOKEN)
               FROM(PRINT-LINE) FLENGTH(LINE-LENGTH)
               LINE
               NOHANDLE
           END-EXEC.

           EVALUATE PRINT-CONTROL
               WHEN ' '
                   ADD 1 TO LINE-COUNT
               WHEN '0'
                   ADD 2 TO LINE-COUNT
               WHEN '-'
                   ADD 3 TO LINE-COUNT
               WHEN '+'
                   ADD 0 TO LINE-COUNT
               WHEN '1'
                   MOVE 1 TO LINE-COUNT
           END-EVALUATE.

      *                                       Check return code
           IF EIBRESP NOT = DFHRESP(NORMAL) THEN
               MOVE 'SPOOLWRITE' TO CICS-COMMAND
               PERFORM ERROR-ROUTINE
           ELSE
               MOVE ' '    TO PRINT-CONTROL
               MOVE SPACES TO PP1-132
           END-IF.

       WRITE-SPOOL-EXIT.
           EXIT.
           EJECT
      *****************************************************************
      ***  ERROR ROUTINE                                            ***
      ***  Error routine produces appropriate responses to CICS     ***
      ***  spool commands. To ensure this the resp and resp2 values ***
      ***  are returned to the main program DFH0STAT for appropriate***
      ***  outputing of the messages.                               ***
      *****************************************************************
       ERROR-ROUTINE SECTION.

      *  If an error occurs which is not due to the users input or if
      *  the program is not being run from a terminal then a general
      *  message is sent to the screen/console and the RESP and RESP2
      *  fields are given along with the spool command which failed.
           MOVE 'Y'      TO ERROR-FOUND.
           MOVE EIBRESP  TO STCM-RESP.
           MOVE EIBRESP2 TO STCM-RESP2.

      *  Whatever happens ensure we return to DFH0STAT quickly.
           EXEC CICS RETURN
           END-EXEC.

       ERROR-ROUTINE-EXIT.
           EXIT.
